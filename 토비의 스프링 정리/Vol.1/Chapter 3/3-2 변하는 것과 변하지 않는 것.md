# 3.2 λ³€ν•λ” κ²ƒκ³Ό λ³€ν•μ§€ μ•λ” κ²ƒ

3.2.1 JDBC trt/catch/finally μ½”λ“μ λ¬Έμ μ 

- μ½”λ“κ°€ λ„λ¬΄ λ‚μ΅ν•¨
- close()λ¥Ό μ λ€λ΅ ν•μ§€ μ•μΌλ©΄ λ¦¬μ†μ¤ λ¬Έμ  λ°μƒ
- μμ •ν•  μ½”λ“λ¥Ό μ°Ύλ” κ²ƒμ΄ μ–΄λ ¤μ›€
- μμ™Έμƒν™©μ„ μ²λ¦¬ν•λ” ν…μ¤νΈ μ½”λ“λ¥Ό λ§λ“¤κΈ° νλ“¦(μΈν„°νμ¤νΈ κµ¬ν„μ²΄λ¥Ό λ§λ“¤μ–΄μ•Ό ν•κΈ° λ•λ¬Έ)

<aside>
π’΅ λ‚μ΅ν• μ½”λ“λ¥Ό ν•΄κ²°ν•κΈ° μ„ν•΄ λ³€ν•λ” κ²ƒκ³Ό λ³€ν•μ§€ μ•λ” κ²ƒμ„ λ¶„λ¦¬ν•μ—¬ λ¦¬ν©ν† λ§ ν•΄μ•Όν•¨

</aside>

3.2.2 λ¶„λ¦¬

- λ³€ν•λ” κ²ƒκ³Ό λ³€ν•μ§€ μ•λ” κ²ƒμ„ λ¶„λ¦¬
- deleteAll()μ—μ„ ps λ§μ΄ λ³€ν•λ” λ¶€λ¶„μ„
- λ³€ν•λ” λ¶€λ¶„λ§ λ©”μ†λ“ μ¶”μ¶ν•λ©΄ μ¶”μ¶ν• λ©”μ†λ“λ¥Ό λ‹¤λ¥Έκ³³μ— μ¬μ‚¬μ©ν•  μ μμ–΄μ•Ό ν•λ”λ°, μ΄μ™€ λ°λ€λ΅ μ¶”μ¶λ λ©”μ†λ“λ§ μ¬μ‚¬μ©μ΄ ν•„μ”ν• λ¶€λ¶„μΌλ΅ λ³€κ²½λ¨

```java
public void deleteAll() throws SQLException {
        PreparedStatement ps = null;
        Connection c = null;
        try {
			      c = dataSource.getConnection();
            ps = makeStatement(c);
            ps.executeUpdate();
        } catch (SQLException e) {
            throw e;
        } finally {
            ...
        }
    }
    
private PreparedStatement makeStatement(Connection c) throws SQLException{
    PreparedStatement ps = c.prepareStatement("delete from users");
    return ps;
}
```

3.2.3 ν…ν”λ¦Ώ λ©”μ†λ“ ν¨ν„΄μ μ μ©

- ν…ν”λ¦Ώ λ©”μ†λ“λ” μƒμ†μ„ ν†µν•΄ κΈ°λ¥μ„ ν™•μ¥ν•΄μ„ μ‚¬μ©ν•λ” ν¨ν„΄μ„
- **λ³€ν•μ§€ μ•λ” λ¶€λ¶„**μ€ μνΌν΄λμ¤μ— λ‘κ³  **λ³€ν•λ” λ¶€λ¶„**μ€ μ¶”μƒ λ©”μ†λ“λ¥Ό μ •μν•΄ λ‘¬μ„ μ„λΈν΄λμ¤μ—μ„ μ¤λ²„λΌμ΄λ“ν•μ—¬ μƒλ΅­κ² μ •μν•λ„λ΅ μ‚¬μ©ν•λ©΄ λ¨
- UserDao ν΄λμ¤λ¥Ό μ¶”μƒ ν΄λμ¤λ΅ λ§λ“¤κ³  λ³€ν•λ” λ¶€λ¶„μΈ makeStatement()λ¥Ό μ¶”μƒ λ©”μ„λ“λ΅ ν•΄μ„ μƒμ†μ„ λ°›μ„ ν΄λμ¤λ¥Ό λ§λ“¤λ©΄ λ¨
- ν•μ§€λ§, ν…ν”λ¦Ώ λ©”μ†λ“ ν¨ν„΄μΌλ΅ μ ‘κ·Όν•λ©΄ DAO λ΅μ§λ§λ‹¤ **μƒμ†**μ„ ν†µν•΄ μƒλ΅μ΄ ν΄λμ¤λ¥Ό λ§λ“¤μ–΄μ•Ό ν•λ―€λ΅ λ‹¨μ μ΄ λ§¤μ° νΌ

![https://media.vlpt.us/images/devsigner9920/post/d968f64e-1ed2-4f24-9433-86581a799e62/78F817E2-8E88-4C36-B299-B7533B8CE215.png](https://media.vlpt.us/images/devsigner9920/post/d968f64e-1ed2-4f24-9433-86581a799e62/78F817E2-8E88-4C36-B299-B7533B8CE215.png)

```java
public abstract class UserDao {
		...
		public abstract PreparedStatement makeStatement(Connection c) throws SQLException;
}

public class UserDaoDeleteAll extends UserDao{
    @Override
    public PreparedStatement makeStatement(Connection c) throws SQLException {
        PreparedStatement ps = c.prepareStatement("delete from users");
        return ps;
    }
}
```

3.2.4 μ „λµ ν¨ν„΄μ μ μ©

- μ „λµ ν¨ν„΄μ€ μΈν„°νμ΄μ¤λ¥Ό μ‚¬μ©ν•μ—¬ ν…ν”λ¦Ώ λ©”μ†λ“ ν¨ν„΄λ³΄λ‹¤ μ μ—°ν•¨
- μ¤λΈμ νΈλ¥Ό λ‘λ΅ λ¶„λ¦¬ν•κ³  ν΄λμ¤ λ λ²¨μ—μ„λ” μΈν„°νμ΄μ¤λ¥Ό ν†µν•΄μ„λ§ μμ΅΄ν•λ” ν¨ν„΄
- ν™•μ¥ κΈ°λ¥μ€ μΈν„°νμ΄μ¤λ¥Ό ν†µν•΄ μ™Έλ¶€μ λ…λ¦½λ μ „λµ ν΄λμ¤μ— μ„μ„
- μ „λµ ν¨ν„΄μ κµ¬μ΅°μ— λ”°λΌ `PreparedStatement`λ¥Ό λ§λ“¤μ–΄μ¤„ μΈν„°νμ΄μ¤λ¥Ό νΈμ¶ν•λ©΄ λ¨
- κ·Έλ¦Ό 3-2μ—μ„ λ³€ν•μ§€ μ•λ” λ¶€λ¶„μ€ contextMethod() λ¶€λ¶„μ„
- ν•μ§€λ§, ν„μ¬λ” UserDaoκ°€ ν΄λμ¤ λ λ²¨μ—μ„ μ΄λ―Έ κµ¬μ²΄μ μΌλ΅ μ–΄λ–¤ μ „λµμ„ μ“Έμ§€(new DeleteAllStatement()) κ³ μ •λμ–΄ μκΈ° λ•λ¬Έμ— ν΄λΌμ΄μ–ΈνΈμ—κ² μ±…μ„μ„ λ„κΉ€

![https://media.vlpt.us/images/devsigner9920/post/d550d8e9-63d6-40e4-9c12-d4334a6ca4d0/1A7A8A34-FA98-4B39-B559-020A1BE1EA2F.png](https://media.vlpt.us/images/devsigner9920/post/d550d8e9-63d6-40e4-9c12-d4334a6ca4d0/1A7A8A34-FA98-4B39-B559-020A1BE1EA2F.png)

```java
public interface StatementStrategy {
    PreparedStatement makePrepareStatement(Connection c) throws SQLException;
}

public class DeleteAllStatement implements StatementStrategy{
    @Override
    public PreparedStatement makePrepareStatement(Connection c) throws SQLException {
        PreparedStatement ps = c.prepareStatement("delete from users");
        return ps;
    }
}

public void deleteAll() throws SQLException {
        PreparedStatement ps = null;
        Connection c = null;
        try {
            c = dataSource.getConnection();
            StatementStrategy strategy = new DeleteAllStatement();
            ps = strategy.makePrepareStatement(c);
            ps.executeUpdate();
        } catch (SQLException e) {
            throw e;
        } finally {
            ...
        }
    }
```

3.2.5 DI μ μ©μ„ μ„ν• ν΄λΌμ΄μ–ΈνΈ/μ»¨ν…μ¤νΈ λ¶„λ¦¬

- ν΄λΌμ΄μ–ΈνΈκ°€ μ–΄λ–¤ μ „λµμ„ μ‚¬μ©ν• μ§€ κ²°μ •(new DeleteAllStatement())ν•κ³ , ν•΄λ‹Ή κ²°κ³Όλ¥Ό μ»¨ν…μ¤νΈ(UserDao)μ—κ² μ „λ‹¬
- κ²°κµ­ μ΄ κµ¬μ΅°μ—μ„ μ „λµ μ¤λΈμ νΈ μƒμ„±κ³Ό μ»¨ν…μ¤νΈλ΅μ μ „λ‹¬μ„ λ‹΄λ‹΄ν•λ” μ±…μ„μ„ λ¶„λ¦¬ν•λ” κ²ƒμ΄ ObjectFactoryμ΄λ©°, μ΄λ¥Ό μΌλ°ν™”ν• κ²ƒμ΄ DIμ„
- κ²°κµ­ DIλ€, μ΄λ¬ν• μ „λµ ν¨ν„΄μ μ¥μ μ„ μΌλ°μ μΌλ΅ ν™μ©ν•  μ μλ„λ΅ λ§λ“  κµ¬μ΅°μ„
- μ κ³µλ°›μ€ μ „λµ μ¤λΈμ νΈλ” `PreparedStatement` μƒμ„±μ΄ ν•„μ”ν• μ‹μ μ— νΈμ¶ν•΄μ„ μ‚¬μ©

![https://leejaedoo.github.io/assets/img/%EC%A0%84%EB%9E%B5%ED%8C%A8%ED%84%B4_client.jpeg](https://leejaedoo.github.io/assets/img/%EC%A0%84%EB%9E%B5%ED%8C%A8%ED%84%B4_client.jpeg)

```java
public void jdbcContextWithStatementStrategy(StatementStrategy stmt) throws SQLException {
        PreparedStatement ps = null;
        Connection c = null;
        try {
            c = dataSource.getConnection();
            ps = stmt.makePrepareStatement(c);
            ps.executeUpdate();
        } catch (SQLException e) {
            throw e;
        } finally {
            ...
        }
    }
```

3.2.6 λ§μ΄ν¬λ΅ DI

- DIμ κ°€μ¥ μ¤‘μ”ν• κ°λ…μ€ μ  3μμ λ„μ›€μ„ ν†µν•΄ λ‘ μ¤λΈμ νΈ μ‚¬μ΄μ μ μ—°ν• κ΄€κ³„κ°€ μ„¤μ •λλ„λ΅ ν•λ” κ²ƒμ„
- μΌλ°μ μΈ DIλ” λ‘κ°μ μ¤λΈμ νΈ, DI μ»¨ν…μ΄λ„, ν΄λΌμ΄μ–ΈνΈλΌλ” 4κ°μ μ¤λΈμ νΈ μ‚¬μ΄μ—μ„ λ°μƒλ¨
- μ›μ‹μ μΈ μ „λµ ν¨ν„΄μ κ²½μ° ν΄λΌμ΄μ–ΈνΈκ°€ DI μ»¨ν…μ΄λ„μ μ—­ν• λ„ ν•¨
- λν•, ν΄λΌμ΄μ–ΈνΈμ™€ μ „λµ(μμ΅΄ μ¤λΈμ νΈ)κ°€ κ²°ν•©λ  μλ„ μκ³ , λ‘κ°μ μ¤λΈμ νΈ λ¨λ‘ ν•λ‚μ ν΄λμ¤ μ•μ— λ‹΄κΈΈ μλ„ μμ
- DI κ°€ λ§¤μ° μ‘μ€ λ‹¨μ„μ μ½”λ“μ™€ λ©”μ†λ“ μ‚¬μ΄μ— λ°μƒν•κΈ°λ„ ν•¨
- μ–Όν•λ³΄λ©΄ DI κ°™μ•„ λ³΄μ΄μ§„ μ•μ§€λ§, μ„Έλ°€κ² κ΄€μ°°ν•΄ λ³΄λ©΄ μ‘μ€ λ‹¨μ„μ DIκ°€ λ°μƒν•κ³  μμ
- μ΄λ ‡κ² DIμ μ¥μ μ„ λ‹¨μν™”ν•΄μ„ IoC μ»¨ν…μ΄λ„μ λ„μ›€μ—†μ΄ μ½”λ“ λ‚΄μ—μ„ μ μ©ν• κ²½μ°λ¥Ό **λ§μ΄ν¬λ΅ DI** λΌκ³  ν•¨
- λ§μ΄ν¬λ΅ DIλ” μ½”λ“μ— μν• DI λ€ μλ―Έλ΅, μλ™ DIλΌκ³  λ¶€λ¥Ό μ μμ