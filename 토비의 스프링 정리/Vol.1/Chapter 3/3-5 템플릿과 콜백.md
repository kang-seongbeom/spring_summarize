# 3.5 ν…ν”λ¦Ώκ³Ό μ½λ°±

3.5.1 ν…ν”λ¦Ώ(template)

- μ–΄λ–¤ λ©μ μ„ μ°ν•΄ λ―Έλ¦¬ λ§λ“¤μ–΄λ‘” λ¨μ–‘μ΄ μλ” ν‹€
- κ³ μ •λ ν‹€ μ•μ— λ°”κΏ€μ μλ” λ¶€λ¶„μ„ λ„£μ–΄μ„ μ‚¬μ©ν•λ” κ²½μ°λ¥Ό ν…ν”λ¦Ώμ΄λΌ ν•¨
- λ³€ν•λ” κ²ƒκ³Ό λ³€ν•μ§€ μ•λ” κ²ƒμ„ λ¶„λ¦¬
- κ³ μ •λ ν‹€μ λ΅μ§μ„ κ°–λ” ν…ν”λ¦Ώ λ©”μ†λ“λ¥Ό μνΌν΄λμ¤μ— λ‘κ³ , λ°”λ€λ” λ¶€λ¶„μ„ μ„λΈν΄λμ¤μ λ©”μ†λ“μ— λ‘λ” κµ¬μ΅°

3.5.2 μ½λ°±(Callback)

- **μ‹¤ν–‰λλ” κ²ƒμ„ λ©μ **μΌλ΅ λ‹¤λ¥Έ μ¤λΈμ νΈμ λ©”μ†λ“μ— μ „λ‹¬λλ” **μ¤λΈμ νΈ**
- νλΌλ―Έν„°λ¬ μ „λ‹¬λμ§€λ§, κ°’μ„ μ°Έμ΅°ν•λ” κ²ƒμ΄ μ•„λ‹ νΉμ • λ΅μ§μ„ λ‹΄μ€ λ©”μ†λ“ μ‹¤ν–‰μ„ λ©μ 
- μλ°”μ—μ„λ” λ©”μ†λ“ μμ²΄λ¥Ό μ „λ‹¬ν•λ” λ°©λ²•μ΄ μ—†κΈ° λ•λ¬Έμ— **λ©”μ†λ“κ°€ λ‹΄κΈ΄ μ¤λΈμ νΈ**λ¥Ό μ „λ‹¬
- μ΄λ¥Ό, **ν‘μ…”λ„ μ¤λΈμ νΈ(Functional Object)**λΌ ν•¨

3.5.3 ν…ν”λ¦Ώ/μ½λ°±

- **ν…ν”λ¦Ώ**μ€ μ‘μ—… νλ¦„μ„ κ°€μ§„ μ½”λ“λ¥Ό **μ¬μ‚¬μ©**ν•λ‹¤λ” μλ―Έμ—μ„ λ¶™μΈ μ΄λ¦„μ΄λ©°, **μ½λ°±**μ€ ν…ν”λ¦Ώ μ•μ—μ„ **νΈμ¶**λλ” κ²ƒμ„ λ©μ μΌλ΅ λ§λ“¤μ–΄μ§„ μ¤λΈμ νΈ
- λ³΄ν†µ, **μ „λµ ν¨ν„΄(ν…ν”λ¦Ώ)** λ° **μµλ… λ‚΄λ¶€ ν΄λμ¤(μ½λ°±)**λ¥Ό κ°™μ΄ μ‚¬μ©ν•¨
- μ—¬λ¬ κ°μ λ©”μ†λ“λ¥Ό μ§€λ‹ μΌλ°μ  μ „λµ ν¨ν„΄κ³Ό λ‹¬λ¦¬, ν…ν”λ¦Ώ/μ½λ°±μ€ λ‹¨μΌ λ©”μ†λ“ μΈν„°νμ΄μ¤ μ‚¬μ©
- μ½λ°± μΈν„°νμ΄μ¤ λ©”μ†λ“μ νλΌλ―Έν„°λ” μ»¨ν…μ¤νΈ μ •λ³΄(DB Connection)λ¥Ό λ°›μ„ λ• μ‚¬μ©

3.5.4 ν…ν”λ¦Ώ/μ½λ°± λ©”μ†λ“μ μ‘μ—…νλ¦„

- μ‘μ—…νλ¦„
    1. ν΄λΌμ΄μ–ΈνΈμ μ—­ν• μ€ ν…ν”λ¦Ώ μ•μ—μ„ **μ½λ°± μ¤λΈμ νΈ(ν‘μ…”λ„ μ¤λΈμ νΈ)**λ¥Ό λ§λ“¤κ³ , μ½λ°±μ΄ μ°Έμ΅°ν•  μ •λ³΄ μ κ³µ. λ§λ“¤μ–΄μ§„ μ½λ°±μ€ ν΄λΌμ΄μ–ΈνΈκ°€ **ν…ν”λ¦Ώμ λ©”μ†λ“λ¥Ό νΈμ¶**ν•  λ• νλΌλ―Έν„°λ΅ μ „λ‹¬
    2. ν…ν”λ¦Ώμ€ **μ •ν•΄μ§„ μ‘μ—… νλ¦„**μ„ λ”°λΌ μ‘μ—…μ„ μ§„ν–‰ν•λ‹¤κ°€ λ‚΄λ¶€μ—μ„ μƒμ„±ν• μ°Έμ΅°μ •λ³΄λ¥Ό κ°€μ§€κ³  **μ½λ°± μ¤λΈμ νΈμ λ©”μ†λ“λ¥Ό νΈμ¶**. μ½λ°± μ‘μ—… μν–‰ ν›„ κ²°κ³Όλ¥Ό ν…ν”λ¦Ώμ— μ „λ‹¬
    
    <aside>
    π’΅ μ¦‰, μ „λ‹¬λ°›μ€ ν‘μ…”λ„ μ¤λΈμ νΈλ” ν…ν”λ¦Ώμ—μ„ μ‚¬μ©λ  λ• νΈμ¶λ¨
    
    </aside>
    
    1. ν…ν”λ¦Ώμ€ μ½λ°± μ‘μ—… μν–‰ κ²°κ³Όλ¥Ό μ‚¬μ©ν•΄ μ‘μ—…μ„ λ§μ € μν–‰. μµμΆ… κ²°κ³Όλ¥Ό ν΄λΌμ΄μ–ΈνΈμ—κ² μ „λ‹¬ν•΄ μ£ΌκΈ°λ„ ν•¨
- ν΄λΌμ΄μ–ΈνΈκ°€ ν…ν”λ¦Ώμ„ νΈμ¶ν•λ©΄μ„ μ½λ°± μ¤λΈμ νΈλ¥Ό μ „λ‹¬ν•λ” κ²ƒμ€ λ©”μ†λ“ λ λ²¨μ DI
- ν…ν”λ¦Ώ/μ½λ°± λ°©μ‹μ€ λ§¤λ² λ©”μ†λ“ λ‹¨μ„λ΅ μ‚¬μ©ν•  μ¤λΈμ νΈλ¥Ό μƒλ΅­κ² μ „λ‹¬
- μ½λ°± μ¤λΈμ νΈλ” (μµλ…)λ‚΄λ¶€ ν΄λμ¤λ΅μ„, ν΄λΌμ΄μ–ΈνΈ λ‚΄ λ©”μ†λ“μ λ©¤λ²„λ¥Ό μ§μ ‘ μ°Έμ΅°κ°€λ¥
- ν΄λΌμ΄μ–ΈνΈμ™€ μ½λ°±μ΄ **κ°•ν•κ² κ²°ν•©**λλ‹¤λ” νΉμ§•μ΄ μμ
- μ¦‰, ν…ν”λ¦Ώ/μ½λ°± λ°©μ‹μ€ μ „λµ ν¨ν„΄κ³Ό DIμ μ¥μ μ„ μµλ… λ‚΄λ¶€ ν΄λμ¤λ¥Ό μ‚¬μ©ν• μ „λµκ³Ό κ²°ν•©ν• λ…νΉν• ν™μ©λ²•μ„

![https://vvhiteboard.github.io/assets/img/posts/2017-09-25-toby%20spring-chapter3_3_1.JPG](https://vvhiteboard.github.io/assets/img/posts/2017-09-25-toby%20spring-chapter3_3_1.JPG)

3.5.5 JdbcContextμ— μ μ©λ ν…ν”λ¦Ώ/μ½λ°±

- ν…ν”λ¦Ώκ³Ό ν΄λΌμ΄μ–ΈνΈκ°€ λ©”μ†λ“ λ‹¨μ„μΈκ²ƒμ΄ νΉμ§•μ„
- ν…ν”λ¦Ώμ λ¦¬ν„΄ κ°’μ΄ μ—†μ

![https://leejaedoo.github.io/assets/img/%ED%85%9C%ED%94%8C%EB%A6%BF_%EC%BD%9C%EB%B0%B1_%EC%82%AC%EC%9A%A9%EC%98%88%EC%8B%9C.jpeg](https://leejaedoo.github.io/assets/img/%ED%85%9C%ED%94%8C%EB%A6%BF_%EC%BD%9C%EB%B0%B1_%EC%82%AC%EC%9A%A9%EC%98%88%EC%8B%9C.jpeg)

3.5.6 μ½λ°±μ λ¶„λ¦¬μ™€ μ¬ν™μ©

- ν„μ¬ ν…ν”λ¦Ώ/μ½λ°± λ°©μ‹μ€ μƒλ€μ μΌλ΅ μ½”λ“ μ‘μ„±ν•κ³  μ½κΈ° λ¶νΈ
- λ³µμ΅ν• μµλ… λ‚΄λ¶€ ν΄λμ¤μ μ‚¬μ© μµμ†ν™”
- deleteAll()μ—μ„ λ³€ν•λ” κ²ƒμ€ SQL μ‹¤ν–‰ λ¬Έμ¥λΏμ„
- λ³€ν•μ§€ μ•λ” λ¶€λ¶„μ„ executeSql()λ΅ μ¶”μ¶ν•κ³ , JdbcContextμ— μ®κΉ€
- κµ¬μ²΄μ  κµ¬ν„, λ‚΄λ¶€μ μ „λµ ν¨ν„΄, μ½”λ“μ— μν• DI, μµλ… λ‚΄λ¶€ ν΄λμ¤ λ“±μ κΈ°μ μ€ κ°μ¶”κ³ , μ™Έλ¶€μ— κΌ­ ν•„μ”ν• κΈ°λ¥λ§ μ κ³µν•λ” λ‹¨μ λ©”μ†λ“λ§ λ…Έμ¶
- κ°€λ³€μΈμ(String... str)λ¥Ό ν†µν•΄ λ¶€κ°€ μ •λ³΄λ¥Ό λ°›μ(μ±…μ— κ°€λ³€μΈμ λ¶€λ¶„ μ½”λ“κ°€ λ‚μ™€μμ§€ μ•μ)

![https://leejaedoo.github.io/assets/img/%EC%BD%9C%EB%B0%B1%EC%9E%AC%ED%99%9C%EC%9A%A9.jpeg](https://leejaedoo.github.io/assets/img/%EC%BD%9C%EB%B0%B1%EC%9E%AC%ED%99%9C%EC%9A%A9.jpeg)

```java
public class UserDao {
	public void add(final User user) throws SQLException {
		String id = user.getId();
		String name = user.getName();
		String password = user.getPassword();
		String query = "insert into users(id, name, password) value (?,?,?)";
		this.jdbcContext.executeSql(query, id, name, password);
    }

	public void deleteAll() throws SQLException{
		String query = "delete from users";
		this.jdbcContext.executeSql(query);
    }
}

public class JdbcContext {
	public void executeSql(final String query, final String... str) throws SQLException {
        workWithStatementStrategy(new StatementStrategy() {
            public PreparedStatement makePrepareStatement(Connection c) throws SQLException {
                PreparedStatement ps = c.prepareStatement(query);
                for (int i = 0; i < str.length; i++)
                    ps.setString(i + 1, str[i]);
                return ps;
            }
        });
    }
}
```

3.5.7 ν…ν”λ¦Ώ/μ½λ°±μ μ‘μ©

- ν…ν”λ¦Ώ/μ½λ°± ν¨ν„΄μ€ μ¤ν”„λ§μ΄ μ κ³µν•λ” λ…μ μ μΈ κΈ°μ μ΄ μ•„λ‹
- ν•μ§€λ§, λ§μ€ μ¤ν”„λ§ APIλ‚ κΈ°λ¥λ“¤μ€ ν…ν”λ¦Ώ/μ½λ°± ν¨ν„΄μ„ μ μ©ν•κ³  μμ
- ν…ν”λ¦Ώ/μ½λ°± ν¨ν„΄λ„ DIμ™€ κ°μ²΄μ§€ν–¥ μ„¤κ³„λ¥Ό μ κ·Ήμ μΌλ΅ μ‘μ©ν• κ²°κ³Ό
- κ³ μ •λ μ‘μ—…μ νλ¦„μ„ κ°€μ§€λ©΄μ„, λ°λ³µλλ” μ½”λ“κ°€ μμΌλ©΄ λ¶„λ¦¬
- μ „ν•μ  ν…ν”λ¦Ώ/μ½λ°± ν¨ν„΄μ ν›„λ³΄λ” try/catch/finallyμ„(μ½”λ“μ—μ„ λ°λ³µλκΈ° λ•λ¬Έ)

3.5.8 ν…μ¤νΈμ™€ νμΌ λ‚΄λ¶€ κ°’ κ³„μ‚°

- νμΌ ν•λ‚λ¥Ό μ—΄μ–΄μ„ λ¨λ“  λΌμΈμ μ«μλ¥Ό λ”ν•΄μ£Όλ” μ½”λ“

```java
public class CalcSumTest {
    @Test
    public void sumOfNumber() throws IOException {
        Calculator calculator = new Calculator();
        int sum = calculator.calcSum(getClass().
                getResource("numbers.txt").getPath());
        assertThat(sum, is(10));
    }
}

public class Calculator {
    public Integer calcSum(String filePath) throws IOException {
        BufferedReader br = new BufferedReader(new FileReader(filePath));
        Integer sum = 0;
        String line = null;
        while ((line = br.readLine()) != null) {
            sum += Integer.valueOf(line);
        }
        br.close();
        return sum;

    }
}
```

3.5.9 try/catch/finally μ μ©

- brμ„ λ‹«μ„ λ•, nullμ•„λ©΄ μμ™Έ λ°μƒν•λ―€λ΅ nullμ²λ¦¬ ν•΄μ•Όν•¨

```java
public class Calculator {
    public Integer calcSum(String filePath) throws IOException {
        BufferedReader br = null;
        try {
            br = new BufferedReader(new FileReader(filePath));
            Integer sum = 0;
            String line = null;
            while ((line = br.readLine()) != null) {
                sum += Integer.valueOf(line);
            }
            return sum;
        } catch (IOException e) {
            System.out.println(e.getMessage());
            throw e;
        } finally {
            if (br != null) {
                try {
                    br.close();
                } catch (IOException e) {
                    System.out.println(e.getMessage());
                }
            }
        }
    }
}
```

3.5.10 ν…ν”λ¦Ώ/μ½λ°± μ„¤κ³„

- κ³±ν•κΈ° κΈ°λ¥κ³Ό κ°™μ΄ κΈ°μ΅΄μ μ½”λ“μ™€ μ μ‚¬ν• κΈ°λ¥ μ¶”κ°€μ‹ μ„Έλ² μ΄μƒ λ°λ³µλλ©΄ μ½”λ“λ¥Ό κ°μ„ ν•΄μ•Ό ν•¨
- ν…ν”λ¦Ώ/μ½λ°±μ„ μ μ©ν•  λ• ν…ν”λ¦Ώμ΄ μ½λ°±μ—κ² μ „λ‹¬ν•΄μ¤„ λ‚΄λ¶€μ μ •λ³΄, μ½λ°±μ΄ ν…ν”λ¦Ώμ—κ² λλ ¤μ¤„ μ •λ³΄, ν…ν”λ¦Ώ μ‘μ—… μ™„λ£ν›„ ν΄λΌμ΄μ–ΈνΈμ—κ² λ°ν™ν•΄μ•Ό ν•λ” μ •λ³΄ λ“±μ„ κ³ λ ¤
- λ³€ν•μ§€ μ•λ” κ²ƒκ³Ό λ³€ν•λ” κ²ƒμ„ κµ¬λ¶„
    - λ³€ν•μ§€ μ•λ” κ²ƒ : br λ° try/catch/finally κµ¬μ΅°
    - λ³€ν•λ” κ²ƒ : κ³„μ‚° λ¶€λ¶„
- μΈν„°νμ΄μ¤λ¥Ό λ§λ“¤μ–΄ μ½λ°± κµ¬ν„ν•κ² ν•¨
- κ³„μ‚° λ¶€λ¶„μ„ sum(br)λ΅ μ¶”μ¶
- λ³€ν•μ§€ μ•λ” κ²ƒμ„ fileReaderTemplate(filepath)λ΅ μ¶”μ¶
- μ½λ°±μ„ μ„ν•΄ `BufferdReaderCallback` μΈν„°νμ΄μ¤ μƒμ„±
- μΈν„°νμ΄μ¤μ— doSomethingWithReader(br) μƒμ„±
- fileReaderTemplate(filepath)μ νλΌλ―Έν„°μ— ν‘μ…”λ„ μ¤λΈμ νΈ(BufferdReaderCallback)λ¥Ό μ¶”κ°€ν•κ³ , μ½λ°± λ©”μ†λ“λ¥Ό κ³„μ‚° λ¶€λ¶„(sum(br))μ— λ€μ²΄
- κΈ°μ΅΄μ— μλ calcSum ν•¨μμ—μ„ `BufferdReaderCallback` μ„ κµ¬ν„ν• sumCallback() μƒμ„± λ° λ¦¬ν„΄μΌλ΅ fileReaderTemplate(filepath, sumCallback) μΌλ΅ ν…ν”λ¦Ώ νΈμ¶

```java
public interface BufferedReaderCallback {
    Integer doSomethingWithReader(BufferedReader br) throws IOException;
}

public class Calculator {
    public Integer calcSum(String filePath) throws IOException {
        BufferedReaderCallback sumCallback = new BufferedReaderCallback() {
            @Override
            public Integer doSomethingWithReader(BufferedReader br) throws IOException {
                Integer sum = 0;
                String line = null;
                while ((line = br.readLine()) != null) {
                    sum += Integer.valueOf(line);
                }
                return sum;
            }
        };
        return fileReadTemplate(filePath, sumCallback);
    }

    private Integer fileReadTemplate(String filePath, BufferedReaderCallback callback)
            throws IOException {
        BufferedReader br = null;
        try {
            br = new BufferedReader(new FileReader(filePath));
            return callback.doSomethingWithReader(br);
        } catch (IOException e) {
            System.out.println(e.getMessage());
            throw e;
        } finally {
            if (br != null) {
                try {
                    br.close();
                } catch (IOException e) {
                    System.out.println(e.getMessage());
                }
            }
        }
    }
}
```

3.5.11 κΈ°λ¥ μ¶”κ°€

- κ³±ν•κΈ° κΈ°λ¥ μ¶”κ°€
- ν…μ¤νΈμ—μ„ κ³µν†µ νμΌμ„ λ‹¤λ£¨κΈ° λ•λ¬Έμ— @Beforeμ—μ„ μ²λ¦¬

```java
public class CalcSumTest {
    Calculator calculator;
    String numFilePath;
    @Before
    public void setUp(){
        calculator = new Calculator();
        numFilePath = getClass().getResource("numbers.txt").getPath();
    }
    @Test
    public void multiplyOfNumbers() throws IOException {
        assertThat(this.calculator.calcMultiply(this.numFilePath),is(24));
    }
    @Test
    public void sumOfNumber() throws IOException {
        assertThat(this.calculator.calcSum(this.numFilePath), is(10));
    }
}

public class Calculator {
		...
    public Object calcMultiply(String filePath) throws IOException {
        BufferedReaderCallback multiplyCallback = new BufferedReaderCallback() {
            @Override
            public Integer doSomethingWithReader(BufferedReader br) throws IOException {
                Integer multiply = 1;
                String line = null;
                while ((line = br.readLine()) != null) {
                    multiply *= Integer.valueOf(line);
                }
                return multiply;
            }
        };
        return fileReadTemplate(filePath, multiplyCallback);
    }
}
```

3.5.12 ν…ν”λ¦Ώ/μ½λ°±μ μ¬μ„¤κ³„

- λ§μ…, κ³±μ…μ μ½λ°± λ¶€λ¶„μ΄ μƒλ‹Ήν μ μ‚¬ν•¨
- λ³€ν•μ§€ μ•λ” λ¶€λ¶„κ³Ό λ³€ν•λ” λ¶€λ¶„μ„ λ¶„λ¥
    - λ³€ν•μ§€ μ•λ” λ¶€λ¶„ : νμΌμ„ λ°λ³µν•΄μ„ μ½λ” λ¶€λ¶„
    - λ³€ν•λ” λ¶€λ¶„ : μ΄κΈ° λ³€μ, κ³„μ‚°μ„ ν•λ” λ¶€λ¶„
- λ³€ν•μ§€ μ•λ” λ¶€λ¶„μ„ ν…ν”λ¦Ώμ— μ¶”κ°€
- κΈ°μ΅΄μ μ½”λ“λ¥Ό μ΄λ¦„ λ° νλΌλ―Έν„°λ§ λ°”κΎΈκ³  μ¬ν™μ©

```java
public interface LineCallback {
    Integer doSomethingWithLine(String line, Integer value) throws IOException;
}

public class Calculator {
    public Integer calcSum(String filePath) throws IOException {
        LineCallback sumCallback = new LineCallback() {
            @Override
            public Integer doSomethingWithLine(String line, Integer value) throws IOException {
                return value + Integer.valueOf(line);
            }
        };
        return lineReadTemplate(filePath, sumCallback, 0);
    }

    public Object calcMultiply(String filePath) throws IOException {
        LineCallback multiplyCallback = new LineCallback() {
            @Override
            public Integer doSomethingWithLine(String line, Integer value) throws IOException {
                return value * Integer.valueOf(line);
            }
        };
        return lineReadTemplate(filePath, multiplyCallback, 1);
    }

    private Integer lineReadTemplate(String filePath, LineCallback callback, Integer initValue)
            throws IOException {
        BufferedReader br = null;
        try {
            br = new BufferedReader(new FileReader(filePath));
            Integer res = initValue;
            String line = null;
            while ((line = br.readLine()) != null) {
                res = callback.doSomethingWithLine(line, res);
            }
            return res;
        } catch (IOException e) {
            System.out.println(e.getMessage());
            throw e;
        } finally {
            if (br != null) {
                try {
                    br.close();
                } catch (IOException e) {
                    System.out.println(e.getMessage());
                }
            }
        }
    }
}
```

3.5.13 μ λ„¤λ¦­μ¤λ¥Ό μ΄μ©ν• μΈν„°νμ΄μ¤

- LineCallbackκ³Ό lineReadTemplate()μ€ νƒ€μ…μ΄ Integerλ΅ κ³ μ •λμ–΄ μμ
- μ λ„¤λ¦­μ¤λ¥Ό μ΄μ©ν•λ©΄ λ‹¤μ–‘ν• μ¤λΈμ νΈλ¥Ό μ§€μ›ν•λ” μΈν„°νμ΄μ¤λ‚ λ©”μ†λ“ μ •μ κ°€λ¥
- μ½λ°±μ„ μ •μν•  λ• μ‚¬μ©ν•  νƒ€μ… μ§€μ •

```java
public class CalcSumTest {
		...
		@Test
    public void concatenateStrings() throws IOException {
        assertThat(calculator.concatenate(this.numFilePath), is("1234"));
    }
}

public interface LineCallback<T> {
    T doSomethingWithLine(String line, T value) throws IOException;
}

public class Calculator {
		private <T> T lineReadTemplate(String filePath, 
                                   LineCallback<T> callback, T initValue)
            throws IOException {
        BufferedReader br = null;
        try {
            br = new BufferedReader(new FileReader(filePath));
            T res = initValue;
            String line = null;
						...
		}
		...
		public String concatenate(String filePath) throws IOException {
        LineCallback<String> concatenateCallback = new LineCallback<String>() {
            @Override
            public String doSomethingWithLine(String line, String value) throws IOException {
                return value + Integer.valueOf(line);
            }
        };
        return lineReadTemplate(filePath, concatenateCallback, "");
    }
}
```