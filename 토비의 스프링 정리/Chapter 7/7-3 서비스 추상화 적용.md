# 7.3 ì„œë¹„ìŠ¤ ì¶”ìƒí™” ì ìš©

7.3.1 JaxbXmlSqlReader ê°œì„  ê³¼ì œ

- JaxbXmlSqlReaderë¥¼ ê°œì„ í•  **ë‘ ê°€ì§€** ê³¼ì œë¥¼ ìƒê°í•  ìˆ˜ ìˆìŒ
    1. JAXB ì´ì™¸ì˜ XMLê³¼ ìë°” ì˜¤ë¸Œì íŠ¸ ë§¤í•‘ ê¸°ìˆ 
    2. XML íŒŒì¼ì„ ë‹¤ì–‘í•œ ì†ŒìŠ¤ì—ì„œ ê°€ì ¸ì˜¤ê²Œ í•¨
        
        <aside>
        ğŸ’¡ í´ë˜ìŠ¤ íŒ¨ìŠ¤, íŒŒì¼ ì‹œìŠ¤í…œ, ì›¹ ë“± ë‹¤ì–‘í•œ ìœ„ì¹˜ì—ì„œ ê°€ì ¸ì˜¤ê²Œ í•¨
        
        </aside>
        
    

7.3.2 OXM ì„œë¹„ìŠ¤ ì¶”ìƒí™”

- OXM(Object-XML Mapping)ì€ XML ê³¼ ìë°” ì˜¤ë¸Œì íŠ¸ë¥¼ ë§¤í•‘í•´ì„œ ìƒí˜¸ ë³€í™˜í•˜ëŠ” ê¸°ìˆ ì„
- ìë°”ì—ëŠ” JAXB ì™¸ì— ìì£¼ ì‚¬ìš©ë˜ëŠ” XMLê³¼ ìë°” ì˜¤ë¸Œì íŠ¸ ë§¤í•‘ ê¸°ìˆ ì´ ì¡´ì¬í•¨
    1. Castor XML
        - ì„¤ì •íŒŒì¼ì´ í•„ìš”ì—†ëŠ” ì¸íŠ¸ë¡œìŠ¤í™ì…˜ ëª¨ë“œë¥¼ ì§€ì›í•˜ê¸°ë„ í•˜ëŠ” ê°„ê²°í•˜ê³  ê°€ë²¼ìš´ ë°”ì¸ë”© í”„ë ˆì„ì›Œí¬
    2. JiBX
        - ë›°ì–´ë‚œ í¼í¬ë¨¼ìŠ¤ë¥¼ ìë‘í•˜ëŠ” XML ë°”ì¸ë”© ê¸°ìˆ 
    3. XmlBeans
        - ì•„íŒŒì¹˜ XML í”„ë¡œì íŠ¸ì˜ í•˜ë‚˜. XMLì˜ ì •ë³´ì…‹ì„ íš¨ê³¼ì ìœ¼ë¡œ ì œê³µ
    4. Xstream
        - ê´€ë¡€ë¥¼ ì´ìš©í•´ ì„¤ì •ì´ ì—†ëŠ” ë°”ì¸ë”©ì„ ì§€ì›í•˜ëŠ” XML ë°”ì¸ë”© ê¸°ìˆ ì˜ í•˜ë‚˜
- JAXBë¥¼ í¬í•¨í•´ì„œ ë‹¤ì„¯ ê°€ì§€ ê¸°ìˆ  ëª¨ë‘ **ìœ ì‚¬í•œ ê¸°ëŠ¥**ê³¼ **API**ë¥¼ ì œê³µí•¨
- ìœ ì‚¬í•œ ê¸°ëŠ¥ê³¼ APIë¥¼ ì œê³µí•˜ê¸° ë•Œë¬¸ì—, ì´ë¥¼ ì¶”ìƒí™” í•˜ëŠ” **ì„œë¹„ìŠ¤ ì¶”ìƒí™”**í•  ìˆ˜ ìˆìŒ
- ìŠ¤í”„ë§ì—ì„œ íŠ¸ëœì­ì…˜, ë©”ì¼ ì „ì†¡ë¿ ì•„ë‹ˆë¼ OXMì— ëŒ€í•´ ì„œë¹„ìŠ¤ ì¶”ìƒí™” ê¸°ëŠ¥ì„ ì œê³µí•¨

7.3.3 OXM ì„œë¹„ìŠ¤ ì¸í„°í˜ì´ìŠ¤

- OXM ì¶”ìƒí™” ì„œë¹„ìŠ¤ ì¸í„°í˜ì´ìŠ¤ëŠ” ìë°” ì˜¤ë¸Œì íŠ¸ë¥¼ XMLë¡œ ë³€í™˜í•˜ëŠ” Marshallerì™€, XMLì„ ìë°” ì˜¤ë¸Œì íŠ¸ë¡œ ë³€í™˜í•˜ëŠ” Unmarsharllerê°€ ìˆìŒ
- XMLì—ì„œ ë°ì´í„°ë¥¼ ì½ì–´ì˜¤ëŠ” ì„œë¹„ìŠ¤ ì¶”ìƒí™” ê¸°ëŠ¥ì„ ì‚¬ìš©í•  ê²ƒì´ê¸° ë•Œë¬¸ì— Unmarsharllerì„ ì‚¬ìš©í•  ê²ƒì„
- OXM ê¸°ìˆ ì— ë”°ë¼ Unmarsharller ì¸í„°í˜ì´ìŠ¤ë¥¼ êµ¬í˜„í•œ **ë‹¤ì„¯ ê°€ì§€** í´ë˜ìŠ¤ê°€ ìˆìŒ

7.3.4 JAXB êµ¬í˜„ í…ŒìŠ¤íŠ¸

- JAXBë¥¼ ì´ìš©í•˜ë„ë¡ ë§Œë“¤ì–´ì§„ Unmarsharller êµ¬í˜„ í´ë˜ìŠ¤ëŠ” `Jaxb2Marsharller`ì„
- ì´ë¦„ì´ `Jaxb2Marsharller`ì¸ ì´ìœ ëŠ”, Marsharllerì™€ Unmarsharllerë¥¼ ëª¨ë‘ êµ¬í˜„í•˜ê³  ìˆê¸° ë•Œë¬¸ì„
- `Jaxb2Marsharller`ëŠ” í”„ë¡œí¼í‹°ì¸ contextPathë§Œ ë„£ìœ¼ë©´ ë¨
- í…ŒìŠ¤íŠ¸ë¥¼ ìœ„í•´ OxmTest-context.xml íŒŒì¼ì„ ë§Œë“¤ê³  ë¹ˆì„ ì„¤ì •í•¨
- í…ŒìŠ¤íŠ¸ ì½”ë“œëŠ” OXM ì¶”ìƒí™” APIë¥¼ ì‚¬ìš©í–ˆìœ¼ë¯€ë¡œ XMLì„ ì½ì–´ì„œ ì˜¤ë¸Œì íŠ¸ë¡œ ë³€í™˜í•˜ëŠ” ë‘ ì¤„ì´ë©´ ì¶©ë¶„í•¨
- ë³€ìˆ˜ë¥¼ ì œê±°í•˜ë©´ í•œ ì¤„ë¡œ ë§Œë“¤ ìˆ˜ ìˆìŒ
- OXM ì„œë¹„ìŠ¤ ì¶”ìƒí™” APIë¥¼ ì‚¬ìš©í–ˆê¸° ë•Œë¬¸ì—, í…ŒìŠ¤íŠ¸ ì½”ë“œì— JAXBë¼ëŠ” êµ¬ì²´ì ì¸ ê¸°ìˆ ì— ì˜ì¡´í•˜ëŠ” ë¶€ë¶„ì´ ì—†ìŒ

```groovy
implementation group: 'org.springframework', name: 'spring-oxm', version: '3.0.4.RELEASE'
```

```xml
<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xsi:schemaLocation="http://www.springframework.org/schema/beans
                            http://www.springframework.org/schema/beans/spring-beans-3.0.xsd">

    <bean id="unmarshaller" class="org.springframework.oxm.jaxb.Jaxb2Marshaller">
        <!--í”„ë¡œì íŠ¸ ë‚´ ì´ì „ì— ë§Œë“  jaxb íŒ¨í‚¤ì§€ ê²½ë¡œ-->
        <property name="contextPath" value="com.ksb.spring.jaxb" />
    </bean>
</beans>
```

```java
//import ì£¼ì˜!
import org.springframework.oxm.Unmarshaller;

@RunWith(SpringJUnit4ClassRunner.class)
@ContextConfiguration(locations = "/OxmTest-context.xml")
public class OxmTest {
    //unmarshaller íƒ€ì…ì˜ ë¹ˆì„ ì°¾ì•„ì„œ ë„£ì–´ì¤Œ
    @Autowired
    Unmarshaller unmarshaller;

    @Test
    public void unmarshallSqlMap() throws XmlMappingException, IOException {
        Source xmlSource = new StreamSource(
                getClass().getResourceAsStream("sqlmap.xml"));

        Sqlmap sqlmap = (Sqlmap) this.unmarshaller.unmarshal(xmlSource);

        List<SqlType> sqlList = sqlmap.getSql();

        assertThat(sqlList.size(), is(6));
				...
    }
}
```

7.3.5 Castor êµ¬í˜„ í…ŒìŠ¤íŠ¸

- Castorìš© ë§¤í•‘ ì •ë³´ë§Œ ì¤€ë¹„í•˜ê³  unmashaller ë¹ˆ ì„¤ì •ë§Œ ë³€ê²½í•˜ë©´ JAXBì—ì„œ ì‰½ê²Œ ë³€ê²½ ê°€ëŠ¥
- CastorëŠ” ì—¬ëŸ¬ XML/ì˜¤ë¸Œì íŠ¸ ë³€í™˜ ë°©ë²•ì„ ì§€ì›í•˜ëŠ”ë°, XML ë§¤í•‘ íŒŒì¼ì„ ì´ìš©í•  ê²ƒì„
- ë§¤í•‘ì •ë³´ë§Œ ì ì ˆíˆ ë§Œë“¤ì–´ ì£¼ë©´, ì–´ë–¤ í´ë˜ìŠ¤ì™€ í•„ë“œë¡œë„ ë§¤í•‘ì´ ê°€ëŠ¥í•˜ê¸° ë•Œë¬¸ì— JAXB ì»´íŒŒì¼ëŸ¬ê°€ ë§Œë“  Sqlmap, SqlType í´ë˜ìŠ¤ë¥¼ Castor ë§¤í•‘ìš©ìœ¼ë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆìŒ
- Castorìš© ë§¤í•‘ XMLì€ mapping.xml

<aside>
ğŸ’¡ í˜„ì¬ ì´ ì½”ë“œëŠ” ë™ì‘í•˜ì§€ ì•ŠìŒ. ìŠ¤í”„ë§ 4.3.13 ë¶€í„° [CastorMarshallerëŠ” Deprecated](https://docs.spring.io/spring-framework/docs/5.0.1.RELEASE_to_5.0.2.RELEASE/Spring%20Framework%205.0.2.RELEASE/org/springframework/oxm/castor/CastorMarshaller.html) ë˜ì—ˆê¸° ë•Œë¬¸ì¸ ë“¯ ì‹¶ìŒ.

</aside>

```xml
<!--mapping.xml-->
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapping PUBLIC "-//EXOLAB/Castor Object Mapping DTD Version 1.0//EN"
        "http://castor.org/mapping.dtd">
<mapping>
    <class name="com.ksb.spring.jaxb.Sqlmap">
        <map-to xml="sqlmap"/>
        <field name="sql" type="com.ksb.spring.jaxb.SqlType"
               required="true" collection="arraylist">
            <bind-xml name="sql" node="element"/>
        </field>
    </class>
    <class name="com.ksb.spring.jaxb.SqlType">
        <map-to xml="sql"/>
        <field name="key" type="string" required="true">
            <bind-xml name="key" node="attribute"/>
        </field>
        <field name="value" type="string" required="true">
            <bind-xml node="text"/>
        </field>
    </class>
</mapping>
```

```xml
<bean id="unmarshaller" class="org.springframework.oxm.castor.CastorMarshaller">
    <property name="mappingLocation" value="/mapping.xml" />
</bean>
```

7.3.6 ë©¤ë²„ í´ë˜ìŠ¤ë¥¼ ì°¾ì¡°í•˜ëŠ” í†µí•© í´ë˜ìŠ¤

- OXM ì¶”ìƒí™” ê¸°ëŠ¥ì„ ì´ìš©í•˜ëŠ” SqlServiceì˜ ì´ë¦„ì„ OxmSqlServiceë¡œ ëª…ëª…í•¨
- SqlReaderëŠ” ìŠ¤í”„ë§ì˜ OXM Unmarshallerë¥¼ ì´ìš©í•˜ë„ë¡ OxmSqlServiceì— **ê³ ì •**í•´ì•¼í•¨
- ì¦‰, SqlReaderë¥¼ OxmlSqlService ë‚´ë¶€ì— êµ¬í˜„í•˜ì—¬ **ìŠ¤íƒœí‹± ë©¤ë²„ í´ë˜ìŠ¤**ë¡œ ë§Œë“¦
- ì´ë ‡ê²Œ í•˜ëŠ” ì´ìœ ëŠ”, SQLì„ ì½ëŠ” ë°©ë²•ì„ OXMìœ¼ë¡œ **ì œí•œ**í•˜ì—¬ **ì‚¬ìš©ì„±ì„ ê·¹ëŒ€í™”** í•˜ëŠ”ê²ƒì´ ëª©ì 

![https://blog.kakaocdn.net/dn/lULRT/btqS4Lw9qkR/ZQKEw97bcqAuRjDrwV3yt1/img.png](https://blog.kakaocdn.net/dn/lULRT/btqS4Lw9qkR/ZQKEw97bcqAuRjDrwV3yt1/img.png)

- OxmSqlServiceê°€ ë‚´ë¶€ì— OxmSqlReaderë¥¼ í¬í•¨í•˜ë©´ì„œ, ë©¤ë²„ë¡œ ê°–ê³  ìˆê¸° ë•Œë¬¸ì— ë¹ˆì˜ ë“±ë¡ì€ OxmlSqlServiceë§Œ í•˜ë©´ ë¨
- ì´ë ‡ê²Œ ë¹ˆì˜ ê°œìˆ˜ë¥¼ ì¤„ì¼ ìˆ˜ ìˆìŒ
- í•˜ì§€ë§Œ, OxmSqlReaderì˜ ê²½ìš° ì™¸ë¶€ì— ë…¸ì¶œë˜ì§€ ì•Šì§€ë§Œ, ìŠ¤ìŠ¤ë¡œ ë¹ˆìœ¼ë¡œ ë“±ë¡ë  ìˆ˜ ì—†ìŒ
- ë•Œë¬¸ì— ë¹ˆì˜ í”„ë¡œí¼í‹°ë¡œ ì œê³µë°›ëŠ” ê°’ì´ ìˆì„ ê²½ìš° OxmlSqlServiceì—ì„œ ë°›ì•„ OxmlSqlReaderë¡œ ì œê³µí•´ì•¼ í•¨
- ì¦‰, OxmlSqlReaderëŠ” OxmlSqlServiceì˜ ê³µê°œëœ í”„ë¡œí¼í‹°ë¥¼ í†µí•´ ê°„ì ‘ì  DIë¥¼ ë°›ì•„ì•¼ í•¨

[https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2FbuA1Ce%2FbtqS9ZPct9K%2FuUrhB10K2Q6iu34U61qOv1%2Fimg.png](https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2FbuA1Ce%2FbtqS9ZPct9K%2FuUrhB10K2Q6iu34U61qOv1%2Fimg.png)

- OxmlSqlReaderëŠ” OXMì„ ì‚¬ìš©í•˜ë¯€ë¡œ Unmarshallerê°€ í•„ìš”í•˜ê³ , ë§¤í•‘ íŒŒì¼ ì´ë¦„ë„ ì™¸ë¶€ì—ì„œ ì§€ì •í•´ì•¼ í•˜ê¸° ë•Œë¬¸ì— ë‘ ê°€ì§€ ì •ë³´ê°€ í•„ìš”í•¨
- ì´ ë‘ ê°€ì§€ ì •ë³´ë¥¼ OxmlSqlServiceì˜ í”„ë¡œí¼í‹°ë¡œ ë°›ê³  OxmlSqlReaderì—ê²Œ ì „ë‹¬í•´ì•¼ í•¨

7.3.7 OxmSqlService

- OxmSqlServiceëŠ” ë‚´ë¶€ì— OxmlSqlReaderë¥¼ êµ¬í˜„í•˜ê³  ìƒì„±í•´ì„œ ë©¤ë²„ë¡œ ê°€ì§
- ë˜í•œ, ë‘ ê°€ì§€ ì •ë³´ë¥¼ DI ë°›ì•„ OxmSqlReaderì—ê²Œ ì „ë‹¬í•¨
- SqlRegistryì˜ ê²½ìš° ì´ì „ì— ë§Œë“  HashMapSqlRegistryë¥¼ **ë””í´íŠ¸**ë¡œ ì‚¬ìš©í•¨

```java
import org.springframework.oxm.Unmarshaller;
...
public class OxmSqlService implements SqlService{
    private final OxmSqlReader oxmSqlReader = new OxmSqlReader();

    private SqlRegistry sqlRegistry = new HashMapSqlRegistry();

    public void setSqlRegistry(SqlRegistry sqlRegistry){
        this.sqlRegistry = sqlRegistry;
    }

    //DI ë°›ì€ ê²ƒì„ oxmSqlReaderë¡œ ì „ë‹¬
    public void setUnmarshaller(Unmarshaller unmarshaller){
        oxmSqlReader.setUnmarshaller(unmarshaller);
    }

    public void setSqlmapFile(String sqlmapFile){
        oxmSqlReader.setSqlmap(sqlmap);
    }

    @PostConstruct
    public void loadSql() {
        this.oxmSqlReader.read(this.sqlRegistry);
    }

    @Override
    public String getSql(String key) throws SqlRetrievalFailException {
        try{
            return this.sqlRegistry.findSql(key);
        }catch (SqlRetrievalFailException e){
            throw new RuntimeException(e);
        }
    }

    private class OxmSqlReader implements SqlReader{
        private Unmarshaller unmarshaller;
        private final static String DEFAULT_SQLMAP_FILE = "/sqlmap.xml";
        private String sqlmapFile = DEFAULT_SQLMAP_FILE;

        public void setUnmarshaller(Unmarshaller unmarshaller) {
            this.unmarshaller = unmarshaller;
        }

        public void setSqlmapFile(String sqlmapFile) {
            this.sqlmapFile = sqlmapFile;
        }

        @Override
        public void read(SqlRegistry sqlRegistry) {
            try{
                Source source = new StreamSource(
                        getClass().getResourceAsStream(this.sqlmapFile)
                );
                Sqlmap sqlmap = (Sqlmap)this.unmarshaller.unmarshal(source);

                for(SqlType sql : sqlmap.getSql())
                    sqlRegistry.registrySql(sql.getKey(), sql.getValue());
            }catch (IOException e){
                throw new IllegalArgumentException(this.sqlmapFile +
                        "ì„ ê°€ì ¸ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤."+e);
            }
        }
    }

}
```

```xml
<beans>
		...
    <bean id="sqlService" class="com.ksb.spring.OxmSqlService">
        <property name="unmarshaller" ref="unmarshaller"/>
    </bean>

    <bean id="unmarshaller" class="org.springframework.oxm.jaxb.Jaxb2Marshaller">
        <property name="contextPath" value="com.ksb.spring.jaxb"/>
    </bean>
</beans>
```

7.3.8 ìœ„ì„ì„ ì´ìš©í•œ BaseSqlServiceì˜ ì¬ì‚¬ìš©

- `OxmSqlService`ì˜ loadSql()ê³¼ getSql()ì´ `BaseSqlService`ì™€ ë™ì¼í•¨
- ì¬ì‚¬ìš©í•œë‹¤ê³  `BaseSqlService`ì„ ìƒì† ë°›ìœ¼ë©´ `OxmSqlService`ë¥¼ ìƒì„±í•˜ëŠ” ì½”ë“œë¥¼ ë„£ê¸° ì• ë§¤í•¨
- loadSql()ê³¼ getSql()ì„ `BaseSqlService`ì— ë‘ê³ , `OxmSqlService`ì—ì„œ `BaseSqlService`ë¡œ ìœ„ì„í•¨
- ìœ„ì„ì˜ ê²½ìš° í”„ë¡ì‹œë¥¼ ë§Œë“¤ ë•Œ ì‚¬ìš©í•´ ë´¤ìŒ
- í”„ë¡ì‹œì˜ ê²½ìš° ì• í”Œë¦¬ì¼€ì´ì…˜ ì „ë°˜ì ìœ¼ë¡œ ì ìš©í•´ì•¼ í•˜ê¸° ë•Œë¬¸ì— ê°ê° ë¹ˆìœ¼ë¡œ ë“±ë¡ì„ í–ˆìŒ
- í•˜ì§€ë§Œ, `BaseSqlService`ì™€ `OxmSqlService`ì˜ ê²½ìš° í•œ ë²ˆë§Œ ì‚¬ìš©í•  ê²ƒì´ê¸° ë•Œë¬¸ì— ë‘ ì˜¤ë¸Œì íŠ¸ë¥¼ ë¹ˆìœ¼ë¡œ ë“±ë¡í•˜ê¸°ì— ë¶ˆí¸í•¨
- ë”°ë¼ì„œ `OxmSqlService`ë‚´ë¶€ì—ì„œ `BaseSqlService`ì„ êµ¬í˜„í•˜ê³ , loadSql()ê³¼ getSql()ì„ ìœ„ì„í•¨

[https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2FDcy6Q%2FbtqTjDqJyRe%2FKnQKk0fT9Q0vXnmeaHtw9k%2Fimg.png](https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2FDcy6Q%2FbtqTjDqJyRe%2FKnQKk0fT9Q0vXnmeaHtw9k%2Fimg.png)

```java
public class OxmSqlService implements SqlService{
    private final BaseSqlService baseSqlService = new BaseSqlService();
		...

    @PostConstruct
    public void loadSql() {
        this.baseSqlService.setSqlReader(this.oxmSqlReader);
        this.baseSqlService.setSqlRegistry(this.sqlRegistry);

        this.baseSqlService.loadSql();
    }

    @Override
    public String getSql(String key) throws SqlRetrievalFailException {
        return this.baseSqlService.getSql(key);
    }
		...
}
```

7.3.9 ë¦¬ì†ŒìŠ¤

- í˜„ì¬ SQL ì •ë³´ëŠ” í”„ë¡œì íŠ¸ ë‚´ë¶€ ë¦¬ì†ŒìŠ¤(Resource)ì¸ xml íŒŒì¼ì—ì„œë§Œ ê°€ì ¸ì˜¬ ìˆ˜ ìˆìŒ
    
    ```java
    private final static String DEFAULT_SQLMAP_FILE = "/sqlmap.xml";
    ```
    
- ë•Œë¬¸ì—, ì›¹ê³¼ ê°™ì€ í”„ë¡œì íŠ¸ ì™¸ë¶€ì˜ ë¦¬ì†ŒìŠ¤ë¥¼ ë¶ˆëŸ¬ ì˜¤ë ¤ë©´ ì½”ë“œë¥¼ ìˆ˜ì •í•´ì•¼ í•¨
- ìë°”ì—ì„œ ë‹¤ì–‘í•œ ìœ„ì¹˜ì— ì¡´ì¬í•˜ëŠ” ë¦¬ì†ŒìŠ¤ì— ëŒ€í•œ ë‹¨ì¼í™”ëœ ì ‘ê·¼ ì¸í„°í˜ì´ìŠ¤ë¥¼ ì œê³µí•˜ì§€ ì•ŠìŒ
- `ClassLoader` í´ë˜ìŠ¤ì˜ ê²½ìš° `ClassLoader`ì˜ getResourceAsStream()ì„ ì‚¬ìš©í•´ì•¼ í•˜ê³ , `URL` í´ë˜ìŠ¤ì˜ ê²½ìš° `URL`ì˜ getResourceAsStream()ë¥¼ ì‚¬ìš©í•´ì•¼ í•˜ê³ , `ServletContext` í´ë˜ìŠ¤ì˜ ê²½ìš° `ServletContext` í´ë˜ìŠ¤ì˜ getResourceAsStream()ì„ ì‚¬ìš©í•´ì•¼ í•¨
- ì´ë ‡ê²Œ ë‹¤ë¥¸ í´ë˜ìŠ¤ì´ë”ë¼ë„ ê°™ì€ ëª©ì ì„ ì‚¬ìš©í•˜ê¸° ë•Œë¬¸ì— **ì„œë¹„ìŠ¤ ì¶”ìƒí™”**ë¥¼ ì‚¬ìš©í•˜ì—¬ í”„ë¡œì íŠ¸ì— ë§ëŠ” í´ë˜ìŠ¤ë¥¼ DI í•˜ëŠ” ë°©ë²•ì„ ê³ ë ¤í•  ìˆ˜ ìˆìŒ
- í•˜ì§€ë§Œ, Resourceì˜ ê²½ìš° ìŠ¤í”„ë§ì—ì„œ **ë¹ˆ**ì´ì•„ë‹Œ **ê°’**ìœ¼ë¡œ ì·¨ê¸‰ë˜ì–´ ì˜¤ë¸Œì íŠ¸ DIê°€ ë¶ˆê°€ëŠ¥ í•¨
- ì¦‰, ë¹ˆ propertyì˜ valueì— ê°’ì´ ê°ì²´ì¼ ê²½ìš° ìë™ìœ¼ë¡œ ì˜¤ë¸Œì íŠ¸ë¡œ ë³€í™˜ í•˜ëŠ”ë°, Resourceì˜ ê²½ìš°ì—ëŠ” ê°ì²´ê°€ ì•„ë‹Œ **ìŠ¤íŠ¸ë§ ê°’**ìœ¼ë¡œ ì·¨ê¸‰í•¨

7.3.10 ë¦¬ì†ŒìŠ¤ ë¡œë”

- ìŠ¤í”„ë§ì—ì„œ Resourceì˜ ë¬¸ì œë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ **ì ‘ë‘ì–´**ë¥¼ ì´ìš©í•œ Resource ì˜¤ë¸Œì íŠ¸ë¥¼ ì„ ì–¸í•˜ëŠ” ë°©ë²•ì„ ì œê³µí•¨
- ë¹ˆ propertyì˜ valueì— ì ‘ë‘ì–´ë¥¼ ë¶™ì´ë©´ ìŠ¤í”„ë§ì—ì„œ Resource ì˜¤ë¸Œì íŠ¸ë¡œ ì¸ì‹í•˜ê²Œ í•  ìˆ˜ ìˆìŒ

| ì ‘ë‘ì–´ | ì˜ˆ | ì„¤ëª… |
| --- | --- | --- |
| file: | file:/C:/temp/file.txt | íŒŒì¼ ì‹œìŠ¤í…œì—ì„œ íŒŒì¼ì„ ì§€ì •í•¨ |
| classpath: | classpath:file.txt | í´ë˜ìŠ¤íŒ¨ìŠ¤ì— ë£¨íŠ¸ì— ì¡´ì¬í•˜ëŠ” íŒŒì¼ì„ ì§€ì •í•¨ |
| ì—†ìŒ | WEB-INF/test.dat | ì ‘ë‘ì–´ê°€ ì—†ëŠ” ê²½ìš° ResourceLoader êµ¬í˜„ì— ë”°ë¼ ë¦¬ì†ŒìŠ¤ ìœ„ì¹˜ê°€ ê²°ì •ë¨ |
| http: | http://www.ksb.com/test.dat | http í”„ë¡œí† ì½œì„ ì‚¬ìš©í•´ ì›¹ ìƒì˜ ë¦¬ì†ŒìŠ¤ë¥¼ ì§€ì •í•¨. ftp:ë„ ì‚¬ìš©ê°€ëŠ¥ |

7.3.11 Resourceë¥¼ ì´ìš©í•´ XML íŒŒì¼ ê°€ì ¸ì˜¤ê¸°

- sqlmapFileì˜ í”„ë¡œí¼í‹°ë¥¼ Resource íƒ€ì…ìœ¼ë¡œ ë³€ê²½í•´ì•¼ í•¨
- ê¼­ íŒŒì¼ì„ ì½ì–´ì˜¤ëŠ” ê²ƒì´ ì•„ë‹ ìˆ˜ ìˆê¸° ë•Œë¬¸ì— sqlmapìœ¼ë¡œ ì´ë¦„ ë³€ê²½

```java
import javax.xml.transform.Source;
import javax.xml.transform.stream.StreamSource;

public class OxmSqlService implements SqlService{
    ...
    public void setSqlmapFile(Resource sqlmap){
        oxmSqlReader.setSqlmap(sqlmap);
    }

    private class OxmSqlReader implements SqlReader{
        private Resource sqlmap = new ClassPathResource("/sqlmap.xml",
                UserDao.class);
        ...

        @Override
        public void read(SqlRegistry sqlRegistry) {
            try{
                Source source = new StreamSource(sqlmap.getInputStream());
                Sqlmap sqlmap = (Sqlmap)this.unmarshaller.unmarshal(source);

                for(SqlType sql : sqlmap.getSql())
                    sqlRegistry.registrySql(sql.getKey(), sql.getValue());
            }catch (IOException e){
                throw new IllegalArgumentException(this.sqlmap.getFilename() +
                        "ì„ ê°€ì ¸ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤."+e);
            }
        }
    }

}
```

```xml
<bean id="sqlService" class="com.ksb.spring.OxmSqlService">
    <property name="unmarshaller" ref="unmarshaller"/>
		<!--classpathëŠ” ë””í´íŠ¸ì´ë¯€ë¡œ ìƒëµ ê°€ëŠ¥-->
    <property name="sqlmap" value="classpath:/sqlmap.xml"/>
</bean>
```