# 7.6 ìŠ¤í”„ë§ 3.1ì˜ DI

7.6.1 ì• ë…¸í…Œì´ì…˜ì˜ ë©”íƒ€ì •ë³´ í™œìš©

- ì´ˆê¸° ë¦¬í”Œë ‰ì…˜ APIëŠ” ìë°” ì½”ë“œë‚˜ ì»´í¬ë„ŒíŠ¸ë¥¼ ì‘ì„±í•˜ëŠ”ë° ì‚¬ìš©ë˜ëŠ” íˆ´ì„ ê°œë°œí•  ë•Œ ì´ìš©í•˜ë„ë¡ ë§Œë“¤ì–´ì¡ŒìŒ
- ì´í›„, ìë°” ì½”ë“œì˜ **ë©”íƒ€ì •ë³´**ë¥¼ ë°ì´í„°ë¥¼ í™œìš©í•˜ëŠ” ìŠ¤íƒ€ì¼ì˜ í”„ë¡œê·¸ë˜ë° ë°©ì‹ì—ì„œ ë¦¬í”Œë ‰ì…˜ APIë¥¼ í™œìš©í•˜ë„ë¡ ë³€í™”ë¨
- í•´ë‹¹ í”„ë¡œê·¸ë˜ë° ë°©ì‹ì˜ ì ˆì •ì´ **ì• ë…¸í…Œì´ì…˜**ì„
- ë¦¬í”„ë ‰ì…˜ APIë¥¼ ì´ìš©í•´ ì• ë…¸í…Œì´ì…˜ì˜ ë©”íƒ€ì •ë³´ë¥¼ ì¡°íšŒí•˜ê³  ê°€ì ¸ì˜¤ëŠ” ë°©ë²•ì´ ì „ë¶€ì„
- ì• ë…¸í…Œì´ì…˜ ìì²´ê°€ í´ë˜ìŠ¤ì˜ íƒ€ì…ì— ì˜í–¥ì„ ì£¼ì§€ ëª»í•˜ê³ , ì½”ë“œì—ì„œ í™œìš©ë ìˆ˜ ì—†ì–´ OOP ìŠ¤íƒ€ì¼ì˜ ì½”ë“œë‚˜ íŒ¨í„´ì„ ì ìš©í•  ìˆ˜ ì—†ìŒ
- í•˜ì§€ë§Œ, ì• ë…¸í…Œì´ì…˜ì€ ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ **í•µì‹¬ ë¡œì§**ê³¼ ì´ë¥¼ ì§€ì›í•˜ëŠ” **Ioc í”„ë ˆì„ì›Œí¬**ì™€ ì˜ ì–´ìš¸ë¦¼
- ì• ë…¸í…Œì´ì…˜ì€ Ioc í”„ë ˆì„ì›Œí¬ê°€ **ì°¸ì¡°**í•˜ëŠ” **ë©”íƒ€ì •ë³´**ë¡œ ì‚¬ìš©ë˜ê¸° ë•Œë¬¸ì— ì• ë…¸í…Œì´ì…˜ì˜ í™œìš©ë„ê°€ ì¦ê°€í•˜ê³  ìˆìŒ
- í”„ë ˆì„ì›Œí¬ì—ì„œ XMLì„ DIìš© **ë©”íƒ€ì •ë³´**ë¡œ í™œìš©í•˜ê¸° ë•Œë¬¸ì—, ê°„ê²°í•œ ì½”ë”©ì´ ê°€ëŠ¥í–ˆìŒ
- í•˜ì§€ë§Œ, XMLì€ í‘œí˜„í•˜ë ¤ëŠ” ì •ë³´ë¥¼ ëª¨ë‘ ëª…ì‹œì ìœ¼ë¡œ ë‚˜íƒ€ë‚´ì•¼ í•¨
    
    ```xml
    <x:special target="type" class="com.mycompany.myproject.MyClass" />
    ```
    
- ì´ì™€ ëŒ€ì¡°ì ìœ¼ë¡œ ì• ë…¸í…Œì´ì…˜ì„  ì¶”ê°€í•˜ëŠ” ê²ƒ ë§Œìœ¼ë¡œ ë¦¬í”Œë ‰ì…˜ APIë¥¼ í™œìš©í•´ íŒ¨í‚¤ì§€, í´ë˜ìŠ¤ ì´ë¦„, ì ‘ê·¼ ì œí•œì, êµ¬í˜„ ì¸í„°í˜ì´ìŠ¤ ë“±ì˜ ì—¬ëŸ¬ ì •ë³´ë¥¼ ì–»ì„ ìˆ˜ ìˆìŒ
    
    ```java
    @Special
    public class MyClass{...}
    ```
    
- ë¬¼ë¡ , ì• ë…¸í…Œì´ì…˜ì—ë„ ë‹¨ì ì´ ì¡´ì¬í•¨
- XML ë³€ê²½ ì‹œ  ë¹Œë“œ ê³¼ì •ì„ ìƒëµí•´ë„ ë˜ì§€ë§Œ, ì• ë…¸í…Œì´ì…˜ì€ ìë°” ì½”ë“œì— ì¡´ì¬í•˜ë¯€ë¡œ ë¹Œë“œë¥¼ ìƒˆë¡œ í•´ ì¤˜ì•¼ í•¨
- **ìë°” ê°œë°œ íë¦„**ì€ ì ì°¨ XML ê°™ì€ í…ìŠ¤íŠ¸ í˜•íƒœì˜ ë©”íƒ€ì •ë³´ë¥¼ í™œìš©ì„ ìë°” ì½”ë“œì— ë‚´ì¥ëœ ì• ë…¸í…Œì´ì…˜ì„ ëŒ€ì²´í•˜ëŠ” ìª½ìœ¼ë¡œ ê°€ê³  ìˆìŒ**[Spring-Boot]**
- ìŠ¤í”„ë§ 2.5 ë²„ì „ì—ì„œ ë¶€í„° ìŠ¤í”„ë§ ì¼ë¶€ì— ì• ë…¸í…Œì´ì…˜ì„ ì ìš©í•˜ê¸° ì‹œì‘í–ˆìŒ
- 3.0ê¹Œì§€ XMLì„ ì™„ì „íˆ ë°°ì œí•˜ëŠ” ê²ƒì´ ë¶ˆê°€ëŠ¥ í–ˆì§€ë§Œ, 3.1 ë¶€í„° ê±°ì˜ ëª¨ë“  ì˜ì—­ì— XML ëŒ€ì‹  ì• ë…¸í…Œì´ì…˜ìœ¼ë¡œ ëŒ€ì²´í•  ìˆ˜ ìˆê²Œ ë³€ê²½ë¨

7.6.2 ì •ì±…ê³¼ ê´€ë¡€ë¥¼ ì´ìš©í•œ í”„ë¡œê·¸ë˜ë°

- ì• ë…¸í…Œì´ì…˜ ê°™ì€ ë©”íƒ€ì •ë³´ë¥¼ í™œìš©í•˜ëŠ” í”„ë¡œê·¸ë˜ë° ë°©ì‹ì€ ëª…ì‹œì ìœ¼ë¡œ ë™ì‘ ì½”ë“œë¥¼ ê¸°ìˆ í•˜ëŠ” ëŒ€ì‹ , ì½”ë“œ ì—†ì´ë„ ë¯¸ë¦¬ ì•½ì†ëœ **ê·œì¹™** ë˜ëŠ” **ê´€ë¡€**ë¥¼ ë”°ë¼ í”„ë¡œê·¸ë¨ì´ ë™ì‘í•˜ë„ë¡ í•¨
- ë¯¸ë¦¬ ì•½ì†ëœ ê·œì¹™ê³¼ ê´€ë¡€ì— ë”°ë¼ í”„ë ˆì„ì›Œí¬ê°€ ì‘ì—…ì„ ìˆ˜í–‰í•˜ê¸° ë•Œë¬¸ì—, ë§ì€ ì½”ë“œì˜ ë‚´ìš©ì„  ìƒëµí•  ìˆ˜ ìˆìŒ
- í•˜ì§€ë§Œ, ë¯¸ë¦¬ ì •ì˜ëœ ê·œì¹™ê³¼ ê´€ë¡€ë¥¼ ê¸°ì–µ í•´ì•¼í•˜ëŠ” ë¶€ë‹´ì´ ìˆìŒ
- ìŠ¤í”„ë§ì€ ë£¨ë¹„ ì–¸ì–´ë¥¼ ê¸°ë°˜ìœ¼ë¡œí•œ RoR **í”„ë ˆì„ì›Œí¬**ì— ì˜í–¥ì„ ë°›ì•˜ìŒ
- ìŠ¤í”„ë§ì€ XML ë˜ëŠ” ì• ë…¸í…Œì´ì…˜ì˜ **ë©”íƒ€ì •ë³´**ë¥¼ í™œìš©í•œ í”„ë ˆì„ì›Œí¬ì´ê¸° ë•Œë¬¸ì—, ì½”ë“œê°€ ë§¤ìš° ê°„ëµí•  ìˆ˜ ìˆìŒ
- ìŠ¤í”„ë§ì€ ì• ë…¸í…Œì´ì…˜ìœ¼ë¡œ ë©”íƒ€ì •ë³´ë¥¼ í™œìš©í•˜ëŠ” ë°©ì‹ì„ ì ê·¹ ë„ì…í•˜ê³  ìˆìŒ

7.6.3 ì§€ê¸ˆ ê¹Œì§€ ë§Œë“  XML

```xml
<?xml version="1.0" encoding="UTF-8"?>
<beans >

    <tx:annotation-driven/>

    <context:annotation-config/>

    <jdbc:embedded-database id="embeddedDatabase" type="HSQL">
        <jdbc:script location="schema.sql"/>
    </jdbc:embedded-database>

    <bean id="testUserService"
          class="com.ksb.spring.UserServiceImpl$TestUserService"
          parent="userService">
    </bean>

    <bean id="userService" class="com.ksb.spring.UserServiceImpl">
        <property name="userDao" ref="userDao"/>
        <property name="mailSender" ref="mailSender"/>
    </bean>

    <bean id="mailSender"
          class="com.ksb.spring.DummyMailSender">
        <property name="host" value="mail.server.com"/>
    </bean>

    <bean id="transactionManager"
          class="org.springframework.jdbc.datasource.DataSourceTransactionManager">
        <property name="dataSource" ref="dataSource"/>
    </bean>

    <bean id="userDao" class="com.ksb.spring.UserDaoJdbc">
        <property name="dataSource" ref="dataSource"/>
        <property name="sqlService" ref="sqlService"/>
    </bean>

    <bean id="sqlService" class="com.ksb.spring.OxmSqlService">
        <property name="unmarshaller" ref="unmarshaller"/>
				<!--ë””í´íŠ¸-->
        <!--<property name="sqlmap" value="classpath:/sqlmap.xml"/>-->
        <property name="sqlRegistry" ref="sqlRegistry"/>
    </bean>

    <bean id="sqlRegistry" class="com.ksb.spring.EmbeddedDbSqlRegistry">
        <property name="dataSource" ref="embeddedDatabase"/>
    </bean>

    <bean id="unmarshaller" class="org.springframework.oxm.jaxb.Jaxb2Marshaller">
        <property name="contextPath" value="com.ksb.spring.jaxb"/>
    </bean>

    <bean id="dataSource" class="org.springframework.jdbc.datasource.SimpleDriverDataSource">
        <property name="driverClass" value="com.mysql.cj.jdbc.Driver"/>
        <property name="url" value="jdbc:mysql://localhost/toby?serverTimezone=UTC"/>
        <property name="username" value="root"/>
        <property name="password" value="1234"/>
    </bean>
</beans>
```

7.6.4 í…ŒìŠ¤íŠ¸ ì»¨í…ìŠ¤íŠ¸ ë³€ê²½

- ì• ë…¸í…Œì´ì…˜ê³¼ ìë°”ì½”ë“œë¡œ ê¸°ì¡´ì˜ XMLë¡œ ë§Œë“  ì„¤ì •ì •ë³´ë¥¼ ëŒ€ì²´í•  ê²ƒì„
- XMLì„ ë” ì´ìƒ ì‚¬ìš©í•˜ì§€ ì•Šê²Œ í•˜ëŠ” ê²ƒì´ **ìµœì¢… ëª©ì **ì„
- ìŠ¤í”„ë§ 3.1ì€ ìë°” ì½”ë“œ ì„¤ì • ì •ë³´ì—ì„œ XMLê³¼ ìë°” ì½”ë“œë¡œ ë§Œë“¤ì–´ì§„ DIì„ ë™ì‹œì— ì‚¬ìš©í•  ë°©ë²•ì„ ì œê³µí•˜ê³  ìˆìŒ
- @ImportResourceê°€ ë°”ë¡œ ê·¸ê²ƒì„
    
    ```java
    /*ì• ë…¸í…Œì´ì…˜ì„ í™œìš©í•œ ìë°” ì½”ë“œ ì„¤ì • ì •ë³´ë¥¼ ë§Œë“¦.
      ì•„ì§ ì•„ë¬´ëŸ° ì„¤ì • ì •ë³´ê°€ ì—†ê¸° ë•Œë¬¸ì—, XMLì˜ ì„¤ì • ì •ë³´ë¥¼ ê°€ì ¸ì˜´
    */
    @Configuration
    @ImportResource("/applicationContext.xml")
    public class TestApplicationContext {
    }
    ```
    
- ì •ìƒì ìœ¼ë¡œ ë™ì‘í•˜ëŠ” ê²ƒì„ í™•ì¸í•˜ê¸° ìœ„í•´ í…ŒìŠ¤íŠ¸ ì½”ë“œë¥¼ ëŒë ¤ë´ì•¼ í•¨
- ê¸°ì¡´ XMLì„ ì‚¬ìš©í•˜ëŠ” í…ŒìŠ¤íŠ¸ì¸ UserDaoTestì™€ UserServiceTestì—ì„œ ì„¤ì • ì •ë³´ë¥¼ ê°€ì ¸ì˜¤ëŠ” ë¶€ë¶„ì„ ìˆ˜ì •í•´ì•¼ í•¨
    
    ```java
    //@ContextConfigurationì—ì„œ XMLì•„ë‹Œ ìë°” ì½”ë“œ ì„¤ì •ì •ë³´ë¥¼ ê°€ì ¸ì˜¤ë„ë¡ ìˆ˜ì •
    @RunWith(SpringJUnit4ClassRunner.class)
    @ContextConfiguration(classes = TestApplicationContext.class)
    public class UserDaoTest {
    }
    
    @RunWith(SpringJUnit4ClassRunner.class)
    @ContextConfiguration(classes = TestApplicationContext.class)
    public class UserServiceTest {
    }
    ```
    

7.6.5 <context:annotation-config /> ì œê±°

- <context:annotation-config />ëŠ” @PostConstructë¥¼ ë¶™ì¸ ë©”ì†Œë“œê°€ ë¹ˆì´ ì´ˆê¸°í™”ëœ ì´í›„ì— ìë™ìœ¼ë¡œ ì‹¤í–‰ë˜ë„ë¡ í•¨
- ì¦‰, @PostConstructì™€ ê°™ì€ í‘œì¤€ ì• ë…¸í…Œì´ì…˜ì„ ì¸ì‹í•´ ìë™ìœ¼ë¡œ ë©”ì†Œë„ë¥¼ ì‹¤í–‰ì‹œí‚´
- ì˜ˆë¥¼ ë“¤ì–´, `OxmSqlService`ì˜ loadsql() ë©”ì†Œë“œëŠ” `OxmSqlService`ê°€ ì˜¬ë°”ë¥´ê²Œ ë™ì‘í•˜ê¸° ìœ„í•´ ë¯¸ë¦¬ ì‹¤í–‰ë¼ì•¼ í•˜ë¯€ë¡œ @PostConstructë¥¼ ë¶€ì—¬í–ˆìŒ
- XMLì— ë‹´ê¸´ DI ì •ë³´ë¥¼ ì´ìš©í•˜ëŠ” ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆë¥¼ ì‚¬ìš©í•˜ëŠ” ê²½ìš°ì— @PostConstructì™€ ê°™ì€ ì• ë…¸í…Œì´ì…˜ì˜ ê¸°ëŠ¥ì´ í•„ìš”í•˜ë©´ ë°˜ë“œì‹œ <context:annotation-config />ë¥¼ í¬í•¨í•´ í•„ìš”í•œ **ë¹ˆ í›„ì²˜ë¦¬ê¸°**ê°€ **ë“±ë¡**ë˜ê²Œ ë§Œë“¤ì–´ì•¼ í•¨
- ë°˜ë©´ì—, XMLì´ ì•„ë‹Œ **@Configaration**ì´ ë¶™ì€ **ì„¤ì • í´ë˜ìŠ¤**ë¥¼ ì‚¬ìš©í•˜ëŠ” ê²½ìš° <context:annotation-config />ê°€ í•„ìš” ì—†ìŒ
- ì´ìœ ëŠ”, ì»¨í…Œì´ë„ˆê°€ ì§ì ‘ @PostConstruct ì• ë…¸í…Œì´ì…˜ì„ ì²˜ë¦¬í•˜ëŠ” ë¹ˆ í›„ì²˜ë¦¬ê¸°ë¥¼ ë“±ë¡í•˜ê¸° ë•Œë¬¸ì„

```xml
<beans>
		<!--ì œê±°-->
		~~<context:annotation-config/>~~
</beans>
```

7.6.6 dataSource ë¹ˆì˜ ì „í™˜

- <bean>ì€ @Beanê³¼ ê±°ì˜ 1:1ë¡œ ë§¤í•‘ë¨
- dataSource ë¹ˆì—ì„œ id ê°’ì€ ë©”ì†Œë“œ ì´ë¦„ì´ê³ , ë¦¬í„´ ê°’ì€ class ê°’ì„
    
    ```xml
    <bean id="dataSource" class="org.springframework.jdbc.datasource.SimpleDriverDataSource">
        <property name="driverClass" value="com.mysql.cj.jdbc.Driver"/>
        <property name="url" value="jdbc:mysql://localhost/toby?serverTimezone=UTC"/>
        <property name="username" value="root"/>
        <property name="password" value="1234"/>
    </bean>
    ```
    
- ë‹¨, **ë¦¬í„´ ê°’**ì€ DIì˜ ì›ë¦¬ì— ë”°ë¼ ë¹ˆì˜ êµ¬í˜„ í´ë˜ìŠ¤ëŠ” ììœ ë¡­ê²Œ ë³€ê²½í•˜ê¸° ë•Œë¬¸ì— ì‹¤ì œ êµ¬í˜„ í´ë˜ìŠ¤ê°€ ì•„ë‹Œ, êµ¬í˜„í•œ **ì¸í„°í˜ì´ìŠ¤**ë¡œ ë°˜í™˜í•˜ëŠ” ê²ƒì´ ì¢‹ìŒ
    
    ```java
    @Bean
    publid DataSource dataSource(){...}
    ```
    
- í•˜ì§€ë§Œ, XMLê³¼ ê°™ì´ í”„ë¡œí¼í‹° ê°’ ì£¼ì…ì„ ìœ„í•´ ì‹¤ì œ ë°˜í™˜ë˜ëŠ” **ë³€ìˆ˜ íƒ€ì…**ì€ ì¸í„°í˜ì´ìŠ¤ë¥¼ êµ¬í˜„í•œ í´ë˜ìŠ¤(`SimpleDriverDataSource`)ë¡œ ì„ ì–¸í•´ì•¼ í•¨
- Datasourceì—ëŠ” getConnection()ë§Œ ìˆê¸° ë•Œë¬¸ì—, í”„ë¡œí¼í‹° ê°’ ì£¼ì…ì„ ìœ„í•´ êµ¬í˜„ í´ë˜ìŠ¤ê°€ í•„ìš”í•¨
    
    ```java
    SimpleDriverDataSource dataSource = new SimpleDriverDataSource();
    ```
    
- ìë°” ì½”ë“œì—ì„œ í”„ë¡œí¼í‹° driverClassì˜ ìŠ¤íŠ¸ë§ ê°’ì„ ìë™ìœ¼ë¡œ ë³€í™˜í•˜ì§€ ì•Šê¸° ë•Œë¬¸ì—, ì ì ˆí•œ íƒ€ì…ìœ¼ë¡œ ë³€í™˜í•´ ì£¼ì–´ì•¼ í•¨
    
    ```java
    dataSource.setDriverClass((Class<? extends Driver>) Class.forName("com.mysql.cj.jdbc.Driver"));
    ```
    
- xml ì‚­ì œ í›„ í…ŒìŠ¤íŠ¸ ì§„í–‰
    
    ```xml
    <!--ì‚­ì œ-->
    ~~<bean id="dataSource" class="org.springframework.jdbc.datasource.SimpleDriverDataSource">~~
        ...
    </bean>
    ```
    
    ```java
    public class TestApplicationContext {
        @Bean
        public DataSource dataSource() public class TestApplicationContext {{
            SimpleDriverDataSource dataSource = new SimpleDriverDataSource();
    
            try {
                dataSource.setDriverClass((Class<? extends Driver>) Class.forName("com.mysql.cj.jdbc.Driver"));
            } catch (ClassNotFoundException e) {
                e.printStackTrace();
            }
            dataSource.setUrl("jdbc:mysql://localhost/toby?serverTimezone=UTC");
            dataSource.setUsername("root");
            dataSource.setPassword("1234");
    
            return dataSource;
        }
    }
    ```
    

7.6.7 transactionManager ë¹ˆì˜ ì „í™˜

- transactionManagerëŠ” í”„ë¡œí¼í‹°ë¡œ dataSource ë¹ˆì„ ì˜ì¡´í•˜ê³  ìˆìŒ
    
    ```xml
    <bean id="transactionManager"
              class="org.springframework.jdbc.datasource.DataSourceTransactionManager">
        <property name="dataSource" ref="dataSource"/>
    </bean>
    ```
    
- ìë°” ì½”ë“œë¥¼ í†µí•œ ë¹ˆì˜ ì˜ì¡´ ê´€ê³„ëŠ” ë¹ˆ ë©”ì†Œë“œë¥¼ ì§ì ‘ í˜¸ì¶œí•´ ë¦¬í„´ ê°’ì„ ìˆ˜ì •ì ë©”ì†Œë“œì— ë„£ìœ¼ë©´ ë¨
    
    ```xml
    ~~<bean id="transactionManager">~~
    ```
    
    ```java
    public class TestApplicationContext {
    		...
    		@Bean
        public PlatformTransactionManager transactionManager() {
            DataSourceTransactionManager tm = new DataSourceTransactionManager();
            tm.setDataSource(dataSource());
            return tm;
        }
    }
    ```
    

7.6.8 ë‚˜ë¨¸ì§€ ë¹ˆì˜ ì „í™˜ - 1 

- userDao, userService, testUserService, mailSender ë¹ˆ ì „í™˜
- testUserServiceëŠ” userServiceì˜ í”„ë¡œí¼í‹° ì •ì˜ ë¶€ë¶„ì„ ê·¸ëŒ€ë¡œ ìƒì†í•˜ê²Œ ë§Œë“¤ì—ˆìŒ
    
    ```xml
    <bean id="testUserService"
          class="com.ksb.spring.UserServiceImpl$TestUserService"
          parent="userService">
    </bean>
    ```
    
- ì´ì „ì— ë§Œë“  `TestUserService` í´ë˜ìŠ¤ëŠ” í…ŒìŠ¤íŠ¸ ìš©ë„ë¡œ ë§Œë“¤ì—ˆê³ , ë‚´ë¶€ì ìœ¼ë¡œ ë¦¬í”Œë ‰ì…˜ APIë¥¼ ì‚¬ìš©í–ˆê¸° ë•Œë¬¸ì— private ì ‘ê·¼ ì œí•œìë¥¼ ì‚¬ìš©í•´ë„ ë¬¸ì œê°€ ì—†ì—ˆìŒ
- í•˜ì§€ë§Œ, ìë°” ì½”ë“œì˜ ì„¤ì • íŒŒì¼ì€ publicë§Œ ì ‘ê·¼í•  ìˆ˜ ìˆê¸° ë•Œë¬¸ì— publicìœ¼ë¡œ ì „í™˜ í•´ ì¤˜ì•¼ í•¨
    
    ```java
    public static class TestUserService extends UserServiceImpl {...}
    ```
    
- ë„¤ ê°œì˜ ë¹ˆ ì „í™˜
    - userDaoì˜ sqlServiceëŠ” ì¼ë‹¨ XMLì—ì„œ ì£¼ì…ë°›ì•„ ì‚¬ìš©í•  ìˆ˜ ìˆê²Œ í•¨
    
    ```xml
    ~~<bean id="userDao" >
    <bean id="sqlService" >
    <bean id="testUserService" >
    <bean id="mailSender" >~~
    ```
    
    ```java
    public class TestApplicationContext {
    		...	
    		@Autowired
        SqlService sqlService;
    
    		@Bean
        public UserDao userDao()  {
            UserDaoJdbc dao = new UserDaoJdbc();
            dao.setDataSource(dataSource());
            dao.setSqlService(this.sqlService);
            return dao;
        }
    
        @Bean
        public UserService userService() {
            UserServiceImpl service = new UserServiceImpl();
            service.setUserDao(userDao());
            service.setMailSender(mailSender());
            return service;
        }
    
        @Bean
        public UserService testUserService(){
            UserServiceImpl.TestUserService testService =
                    new UserServiceImpl.TestUserService();
            testService.setUserDao(userDao());
            testService.setMailSender(mailSender());
            return testService;
        }
    
        @Bean
        public MailSender mailSender(){
            return new DummyMailSender();
        }
    }
    ```
    

7.6.9 ë‚˜ë¨¸ì§€ ë¹ˆì˜ ì „í™˜ - 2

- sqlService, sqlRegistry, unmarshaller ë¹ˆ ì „í™˜
- embeddedDatabaseë¥¼ ì£¼ì… ë°›ì„ ë•Œ @Resource ì• ë…¸í…Œì´ì…˜ ì‚¬ìš©
- @ResourceëŠ” @Autowiredì™€ ìœ ì‚¬í•˜ì§€ë§Œ, @ResourceëŠ” í•„ë“œ ì´ë¦„ì„ ê¸°ì¤€ìœ¼ë¡œ ë¹ˆì„ ì°¾ìŒ
    
    <aside>
    ğŸ’¡ @AutowiredëŠ” íƒ€ì…ì„ ê¸°ì¤€ìœ¼ë¡œ ë¹ˆì„ ì°¾ìŒ
    
    </aside>
    
- ì„¸ ê°œì˜ ë¹ˆ ì „í™˜
    
    ```xml
    ~~<bean id="sqlService" >
    <bean id="sqlRegistry" >
    <bean id="unmarshaller" >~~
    ```
    
    ```java
    public class TestApplicationContext {
    		@Resource
        DataSource embeddedDatabase;
    		...
        @Bean
        public SqlService sqlService(){
            OxmSqlService sqlService = new OxmSqlService();
            sqlService.setUnmarshaller(unmarshaller());
            sqlService.setSqlRegistry(sqlRegistry());
            return sqlService;
        }
    
        @Bean
        public SqlRegistry sqlRegistry(){
            EmbeddedDbSqlRegistry sqlRegistry = new EmbeddedDbSqlRegistry();
            sqlRegistry.setDataSource(this.embeddedDatabase);
            return sqlRegistry;
        }
    
        @Bean
        public Unmarshaller unmarshaller(){
            Jaxb2Marshaller marshaller = new Jaxb2Marshaller();
            marshaller.setContextPath("com.ksb.spring.jaxb");
            return marshaller;
        }
    }
    ```
    
- embeddedDatabase ë¹ˆì˜ ê²½ìš° ì „ìš© íƒœê·¸ë¡œ ë§Œë“¤ì—ˆìŒ
    
    ```xml
    <jdbc:embedded-database id="embeddedDatabase" type="HSQL">
        <jdbc:script location="schema.sql"/>
    </jdbc:embedded-database>
    ```
    
- ì „ìš© íƒœê·¸ë¡œ ë§Œë“¤ì–´ì§€ëŠ” ë¹ˆì´ ì—¬ëŸ¬ ê°œì¼ ìˆ˜ ìˆìŒ
- embeddedDatabaseëŠ” ë‚´ì¥í˜• DBë¡œ EmbeddedDatabaseBuilderë¥¼ ì´ìš©í•˜ë©´ ë¨
    
    ```xml
    ~~<jdbc:embedded-database id="embeddedDatabase" type="HSQL">~~
    ```
    
    ```java
    public class TestApplicationContext {
    		~~@Resource
        DataSource embeddedDatabase;~~
    		...
    		@Bean
        public SqlRegistry sqlRegistry(){
            EmbeddedDbSqlRegistry sqlRegistry = new EmbeddedDbSqlRegistry();
            sqlRegistry.setDataSource(embeddedDatabase());
            return sqlRegistry;
        }
    		~~~~@Bean
        public DataSource embeddedDatabase(){
            return new EmbeddedDatabaseBuilder()
                    .setName("embeddedDatabase")
                    .setType(HSQL)
                    .addScript("schema.sql")
                    .build();
        }
    ~~~~}
    ```
    
- ë§ˆì§€ë§‰ íƒœê·¸ì¸ <tx:annotation-driven/> ëŒ€ì²´
- <tx:annotation-driven/>ì€ @Transactionalì´ ë¶™ì€ ê³³ì— **ì–´ë“œë°”ì´ìŠ¤**ì™€ **í¬ì¸íŠ¸ì»·**ì„ ì ìš©í•˜ëŠ” ê¸°ëŠ¥ì„ í•¨
- ì´ ì—­ì‹œ ì „ìš© íƒœê·¸ë¡œ ê¸°ë³¸ì ìœ¼ë¡œ ë„¤ ê°€ì§€ í´ë˜ìŠ¤ë¥¼ ë¹ˆìœ¼ë¡œ ë“±ë¡í•¨
- í•´ë‹¹ ë„¤ ê°€ì§€ ë¹ˆì„ ë“±ë¡í•˜ê¸° ë²ˆê±°ë¡­ê¸°ë„ í•˜ê³ , ê¸°ì–µí•˜ê¸° í˜ë“¦
- ìŠ¤í”„ë§ 3.1 ë¶€í„° ì „ìš© íƒœê·¸ì— ëŒ€ì‘ë˜ëŠ” ì• ë…¸í…Œì´ì…˜ì„ ì œê³µí•¨
- í•´ë‹¹ ì• ë…¸í…Œì´ì…˜ë“¤ì€ @Enableë¡œ ì‹œì‘í•¨
- <tx:annotation-driven/>ëŠ” @EnableTransactionManagementë¡œ ëŒ€ì²´í•  ìˆ˜ ìˆìŒ
    
    ```xml
    ~~<tx:annotation-driven/>~~
    ```
    
    ```java
    //ëª¨ë“  XML ì„¤ì •ì •ë³´ë¥¼ ëŒ€ì²´í–ˆê¸° ë•Œë¬¸ì—, ImportResource ì‚­ì œ ê°€ëŠ¥
    ~~@ImportResource("/applicationContext.xml")~~
    @EnableTransactionManagement
    public class TestApplicationContext {...}
    ```
    
- ì™„ì„±ëœ ì• ë…¸í…Œì´ì…˜ ê¸°ë°˜ ì„¤ì •ì •ë³´
    
    ```java
    @Configuration
    @EnableTransactionManagement
    public class TestApplicationContext {
    
        @Autowired
        SqlService sqlService;
    
        @Bean
        public DataSource dataSource() {
            SimpleDriverDataSource dataSource = new SimpleDriverDataSource();
    
            try {
                dataSource.setDriverClass((Class<? extends Driver>) Class.forName("com.mysql.cj.jdbc.Driver"));
            } catch (ClassNotFoundException e) {
                e.printStackTrace();
            }
            dataSource.setUrl("jdbc:mysql://localhost/toby?serverTimezone=UTC");
            dataSource.setUsername("root");
            dataSource.setPassword("1234");
    
            return dataSource;
        }
    
        @Bean
        public PlatformTransactionManager transactionManager() {
            DataSourceTransactionManager tm = new DataSourceTransactionManager();
            tm.setDataSource(dataSource());
            return tm;
        }
    
        @Bean
        public UserDao userDao()  {
            UserDaoJdbc dao = new UserDaoJdbc();
            dao.setDataSource(dataSource());
            dao.setSqlService(this.sqlService);
            return dao;
        }
    
        @Bean
        public UserService userService() {
            UserServiceImpl service = new UserServiceImpl();
            service.setUserDao(userDao());
            service.setMailSender(mailSender());
            return service;
        }
    
        @Bean
        public UserService testUserService(){
            UserServiceImpl.TestUserService testService =
                    new UserServiceImpl.TestUserService();
            testService.setUserDao(userDao());
            testService.setMailSender(mailSender());
            return testService;
        }
    
        @Bean
        public MailSender mailSender(){
            return new DummyMailSender();
        }
    
        @Bean
        public SqlService sqlService(){
            OxmSqlService sqlService = new OxmSqlService();
            sqlService.setUnmarshaller(unmarshaller());
            sqlService.setSqlRegistry(sqlRegistry());
            return sqlService;
        }
    
        @Bean
        public SqlRegistry sqlRegistry(){
            EmbeddedDbSqlRegistry sqlRegistry = new EmbeddedDbSqlRegistry();
            sqlRegistry.setDataSource(embeddedDatabase());
            return sqlRegistry;
        }
    
        @Bean
        public Unmarshaller unmarshaller(){
            Jaxb2Marshaller marshaller = new Jaxb2Marshaller();
            marshaller.setContextPath("com.ksb.spring.jaxb");
            return marshaller;
        }
    
        @Bean
        public DataSource embeddedDatabase(){
            return new EmbeddedDatabaseBuilder()
                    .setName("embeddedDatabase")
                    .setType(HSQL)
                    .addScript("schema.sql")
                    .build();
        }
    
    }
    ```
    

<aside>
ğŸ’¡ ì§€ê¸ˆê¹Œì§€ XML ì„¤ì •ì„ ê±°ì˜ 1:1ë¡œ ìë°” ì½”ë“œë¡œ ì „í™˜í•˜ëŠ” ì‘ì—…ì„ í–ˆìŒ

ì•ìœ¼ë¡œ ìë°” ì½”ë“œë¡œ ë§Œë“¤ì–´ì§„ ì„¤ì •ì •ë³´ë¥¼ ì• ë…¸í…Œì´ì…˜ì„ ì´ìš©í•´ ê°„ëµí™” í•  ê²ƒì„

</aside>

7.6.10 @Autowiredë¥¼ ì´ìš©í•œ ìë™ì™€ì´ì–´ë§

- @AutowiredëŠ” íŒŒë¼ë¯¸í„° **íƒ€ì…**ì„ í†µí•´ ì£¼ì… ê°€ëŠ¥í•œ ë¹ˆì„ ì°¾ì•„ ì£¼ì…í•¨
    
    <aside>
    ğŸ’¡ ê°™ì€ íƒ€ì…ì˜ ë¹ˆì´ ì—¬ëŸ¬ê°œë©´ í•„ë“œ ì´ë¦„ê³¼ ì¼ì¹˜í•˜ëŠ” ë¹ˆì„ ì°¾ì•„ ì£¼ì…í•¨
    
    </aside>
    
- **ìˆ˜ì •ì ë©”ì†Œë“œ**ë‚˜ **í•„ë“œ**ì— ìë™ìœ¼ë¡œ ì¡°ê±´ì— ë§ëŠ” ë¹ˆì„ ì£¼ì…í•¨
- userDaoJdbcëŠ” dataSourceì™€ sqlService ë‘ ê°œì— ì˜ì¡´í•¨
    
    ```java
    @Bean
    public UserDao userDao()  {
        UserDaoJdbc dao = new UserDaoJdbc();
        dao.setDataSource(dataSource());
        dao.setSqlService(this.sqlService);
        return dao;
    }
    ```
    
- dataSource ìˆ˜ì •ì ë©”ì†Œë“œì— @Autowired ì ìš©
    
    ```java
    ~~dao.setDataSource(dataSource());~~
    ```
    
    ```java
    public class UserDaoJdbc implements UserDao {
    		@Autowired
        public void setDataSource(DataSource dataSource) {
            this.jdbcTemplate = new JdbcTemplate(dataSource);
        }
    }
    ```
    
    <aside>
    ğŸ’¡ dataSourceë¥¼ ì£¼ì… ë°›ì•„ jdbcTemplateë¥¼ ë§Œë“¤ê¸° ë•Œë¬¸ì— í•„ë“œë¡œ ì£¼ì…ë°›ìœ¼ë©´ ì•ˆë¨
    
    </aside>
    
- sqlService í•„ë“œì— @Autowired ì ìš©
    
    ```java
    ~~dao.setSqlService(this.sqlService);~~
    ```
    
    ```java
    public class UserDaoJdbc implements UserDao {
        @Autowired
        private SqlService sqlService;
    
        public void setSqlService(SqlService sqlService){
            this.sqlService = sqlService;
        }
    }
    ```
    
- @Autowired ì ìš© í›„ userDao ë¹ˆ
    
    ```java
    ~~@Autowired
    SqlService sqlService;~~
    
    @Bean
    public UserDao userDao()  {
        return new UserDaoJdbc();
    }
    ```
    

7.6.11 @Componentë¥¼ ì´ìš©í•œ ìë™ ë¹ˆ ë“±ë¡ - userDao

- @Componentê°€ ë¶™ì€ **í´ë˜ìŠ¤**ëŠ” **ë¹ˆ ìŠ¤ìºë„ˆ**ë¥¼ í†µí•´ ìë™ìœ¼ë¡œ ë¹ˆìœ¼ë¡œ ë“±ë¡ ë¨
- userDao ë¹ˆì€ ê°„ë‹¨í•œ ì˜¤ë¸Œì íŠ¸ ìƒì„± ì½”ë“œë§Œ ë‚¨ì•˜ìŒ
    
    ```java
    @Bean
    public UserDao userDao()  {
        return new UserDaoJdbc();
    }
    ```
    
- ì¼ë‹¨ userDao ë¹ˆì„ ì œê±°í•˜ê³ , @Autowiredë¡œ ì£¼ì… ë°›ìŒ
    
    ```java
    ~~@Bean
    public UserDao userDao()  {...}~~
    ```
    
    ```java
    public class TestApplicationContext {
    		@Autowired
        UserDao userDao;
    
        @Bean
        public UserService userService() {
            UserServiceImpl service = new UserServiceImpl();
            service.setUserDao(this.userDao);
            service.setMailSender(mailSender());
            return service;
        }
    
        @Bean
        public UserService testUserService(){
            UserServiceImpl.TestUserService testService =
                    new UserServiceImpl.TestUserService();
            testService.setUserDao(this.userDao);
            testService.setMailSender(mailSender());
            return testService;
        }
    ```
    
- UserDaoJdbcì— @Component ì ìš©í•˜ë©´, í•´ë‹¹ í´ë˜ìŠ¤ë¥¼ ë¹ˆìœ¼ë¡œ ë“±ë¡í•˜ê² ë‹¤ëŠ” **ì„¤ì •ì •ë³´**ì„
    
    ```java
    @Component
    public class UserDaoJdbc implements UserDao {...}
    ```
    
- @Componentê°€ ë¶™ì€ í´ë˜ìŠ¤ë¥¼ ì°¾ì•„ ë¹ˆìœ¼ë¡œ ë“±ë¡í•˜ë ¤ë©´ ë¹ˆ ìŠ¤ìºë„ˆì¸ @ComponentScanì´ í•„ìš”í•¨
- ìŠ¤í”„ë§ì´ ë¹ˆ ìë™ë“±ë¡ì„ ë””í´íŠ¸ë¡œ ì œê³µí•˜ì§€ ì•ŠëŠ” ì´ìœ ëŠ”, @Componentê°€ ë¶™ì€ ì •ë³´ë¥¼ ì¼ì¼ì´ ì°¾ê¸° ë¶€ë‹´ë˜ê¸° ë•Œë¬¸ì„
- í•´ë‹¹ ë¶€ë‹´ì„ ì¤„ì´ê¸° ìœ„í•´ @ComponentScanì— íŠ¹ì • íŒ¨í‚¤ì§€ë§Œ ê²€ìƒ‰í•˜ë„ë¡ ì§€ì •í•´ì•¼ í•¨
    
    ```java
    @Configuration
    @EnableTransactionManagement
    @ComponentScan(basePackages = "com.ksb.spring")
    public class TestApplicationContext {...}
    ```
    
- @Componentë¡œ ë“±ë¡í•œ ë¹ˆì€ userDaoJdbc ë¹ˆì´ì§€ë§Œ, UserDaoJdbcê°€ UserDaoë¥¼ **êµ¬í˜„**í•˜ê¸° ë•Œë¬¸ì— @Autowiredì— ì˜í•´ ì˜ì¡´ì„± ì£¼ì…ì´ ê°€ëŠ¥ í•œ ê²ƒì„
- í•˜ì§€ë§Œ, @Resourceì™€ ê°™ì´ íƒ€ì…ì´ ì•„ë‹Œ ì´ë¦„ì„ í†µí•´ ì£¼ì…í•˜ëŠ” ê²½ìš° ë¬¸ì œê°€ ë°œìƒí•  ìˆ˜ ìˆìŒ
- ì´ëŸ¬í•œ ì´ìœ ë¡œ @Componentì— ë¹ˆ ì•„ì´ë”” ì„¤ì • ê°€ëŠ¥
    
    ```java
    @Component("userDao")
    public class UserDaoJdbc implements UserDao {...}
    ```
    
- @Component ì• ë…¸í…Œì´ì…˜ ì •ì˜ëŠ” ë‹¤ìŒê³¼ ê°™ìŒ
    
    ```java
    public @interface Component{...}
    ```
    
- ë¹ˆ ìë™ë“±ë¡ì— @Component ì• ë…¸í…Œì´ì…˜ë§Œ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ê²ƒì€ ì•„ë‹˜
- @Componentì„ **ë©”íƒ€ ì• ë…¸í…Œì´ì…˜**ìœ¼ë¡œ ê°–ëŠ” ì• ë…¸í…Œì´ì…˜ì—ì„œë„ ì‚¬ìš©í•  ìˆ˜ ìˆìŒ
    
    ```java
    @Component // ë©”íƒ€ ì• ë…¸í…Œì´ì…˜
    public @interface SnsConnector{...} //ì• ë…¸í…Œì´ì…˜ ì •ì˜
    
    @SnsConnector
    public class FacebookConnector{...}
    ```
    
- ì• ë…¸í…Œì´ì…˜ì€ í´ë˜ìŠ¤ì™€ ë‹¬ë¦¬ ê°™ì€ ì¸í„°í˜ì´ìŠ¤ êµ¬í˜„ì´ë‚˜ ìƒì†ì„ í†µí•´ ì—¬ëŸ¬ ê°œë¥¼ **ê·¸ë£¹í™”** í•  ìˆ˜ ì—†ìŒ
- ë•Œë¬¸ì—, ì• ë…¸í…Œì´ì…˜ì— ê³µí†µì ì¸ ì†ì„±ì„ ë¶€ì—¬í•˜ì—¬ **ê·¸ë£¹í™”**í•˜ê¸° ìœ„í•´ **ë©”íƒ€ ì• ë…¸í…Œì´ì…˜**ì„ ì‚¬ìš©í•¨
- ìŠ¤í”„ë§ì—ì„œ DAO ë¹ˆì„ ìë™ë“±ë¡ ëŒ€ìƒìœ¼ë¡œ ë§Œë“¤ ë•Œ, @Component ëŒ€ì‹  **@Repository**ë¥¼ ì‚¬ìš©í•˜ë„ë¡ ê¶Œì¥í•˜ê³  ìˆìŒ
    
    ```java
    @Repository
    public class UserDaoJdbc implements UserDao {...}
    ```
    

7.6.12 @Componentë¥¼ ì´ìš©í•œ ìë™ ë¹ˆ ë“±ë¡ - userService

- `UserServiceImpl` ë‚´ë¶€ í´ë˜ìŠ¤ë¡œ `TestUserService`ê°€ ìˆê³ , ë‘˜ ë‹¤ userDaoì™€ mailSenderë¥¼ ì˜ì¡´í•˜ê³  ìˆìŒ
    
    ```java
    public class UserServiceImpl implements UserService {
    		...
        public static class TestUserService extends UserServiceImpl {...}
    }
    
    public class TestApplicationContext {
    		@Bean
        public UserService userService() {
            UserServiceImpl service = new UserServiceImpl();
            service.setUserDao(this.userDao);
            service.setMailSender(mailSender());
            return service;
        }
    
        @Bean
        public UserService testUserService(){
            UserServiceImpl.TestUserService testService =
                    new UserServiceImpl.TestUserService();
            testService.setUserDao(this.userDao);
            testService.setMailSender(mailSender());
            return testService;
        }
    }
    ```
    
- ì˜ì¡´ì„ @Autowiredë¡œ ì£¼ì…ë°›ìŒ
    
    ```java
    ~~@Bean
    public UserService userService() {...}~~
    ```
    
    ```java
    @Component
    public class UserServiceImpl implements UserService {
        @Autowired
        private UserDao userDao;
        @Autowired
        private MailSender mailSender;
    		...
    }
    ```
    
- ì—¬ê¸°ì„œ ë¬¸ì œê°€ ìˆìŒ
- `UserServiceImpl` ì™€ `TestUserService`ëŠ” ë‘˜ ë‹¤ UserServiceì˜ íƒ€ì…ì„
- @AutowiredëŠ” í•˜ë‚˜ì˜ ë¹ˆì„ ì°¾ì•„ ì£¼ì…í•˜ì§€ë§Œ, íƒ€ì…ì´ ê°™ì€ ë‘ ê°œì˜ ë¹ˆì´ ìˆê³  ì´ë¦„ì´ ì£¼ì…í•˜ë ¤ëŠ” í•„ë“œì™€ ì¼ì¹˜í•˜ì§€ ì•Šì„ ê²½ìš° ë¬¸ì œê°€ ë°œìƒí•¨
    
    <aside>
    ğŸ’¡ userServiceì˜ ì´ë¦„ì„ ê°€ì§„ ë¹ˆì´ í•„ìš”í•˜ì§€ë§Œ, í˜„ì¬ userServiceImplì™€ testUserServiceë§Œ ì¡´ì¬ í•˜ê³  ìˆëŠ” ê²½ìš°ì„
    
    </aside>
    
- ë¹ˆì˜ ì•„ì´ë””ë¥¼ ì§€ì •í•˜ë©´ì„œ, ì„œë¹„ìŠ¤ ê³„ì¸µ ë¹ˆì€ @Componentë³´ë‹¨ @Serviceë¥¼ ì‚¬ìš©
    
    ```java
    @Service("userService")
    public class UserServiceImpl implements UserService {
        //testUserService ë¹ˆì€ ë°”ë¡œ ë°‘ì¸ í…ŒìŠ¤íŠ¸ ì»¨í…ìŠ¤íŠ¸ì—ì„œ ë¹ˆ ì¶”ê°€í•  ê²ƒì„
        public static class TestUserService extends UserServiceImpl {...}
    		...
    }
    ```
    

7.6.13 í…ŒìŠ¤íŠ¸ìš© ì»¨í…ìŠ¤íŠ¸ ë¶„ë¦¬

- ìë™ ë¹ˆì„ ë“±ë¡í•œ userDaoì™€ userService ë¹ˆ ë° íŠ¸ëœì­ì…˜ ê´€ë¦¬, SQL ì„œë¹„ìŠ¤ëŠ” í•­ìƒ í•„ìš”í•¨
- ê¸°ì¡´ì˜ `TestApplicationContext`ë¥¼ `AppContext`ë¡œ ì´ë¦„ ë³€ê²½
- í•˜ì§€ë§Œ, testUserServiceë‚˜ mailSenderì˜ ê²½ìš° í…ŒìŠ¤íŠ¸ ìš©ì´ê¸° ë•Œë¬¸ì— ìš´ì˜ì—ì„œëŠ” í•„ìš” ì—†ìŒ
- í…ŒìŠ¤íŠ¸ìš© ë¹ˆ ë‘ ê°œë¥¼ ë”°ë¡œ ë¶„ë¦¬í•¨
- í…ŒìŠ¤íŠ¸ìš© ë¹ˆ ë‘ê°œê°€ ì €ì¥ëœ ì„¤ì •ì •ë³´ ìë°” í´ë˜ìŠ¤ ì´ë¦„ì€ `TestAppContext`ë¼ í•¨
    
    ```java
    public class AppContext {
    		~~@Bean
    		public TestUserService testUserService() {...}~~
        ~~@Bean~~
        ~~public MailSender mailSender(){...}~~
    }
    ```
    
    ```java
    @Configuration
    public class TestAppContext {
        @Bean
        public UserService testUserService() {
            return new UserServiceImpl.TestUserService();
        }
    
        @Bean
        public MailSender mailSender(){
            return new DummyMailSender();
        }
    }
    ```
    
- ì„¤ì •ìš© DI í´ë˜ìŠ¤ê°€ ë‘ ê°€ì§€ ëìœ¼ë¯€ë¡œ, ë‘ ì„¤ì •íŒŒì¼ ëª¨ë‘ ì ìš©
    
    ```java
    @RunWith(SpringJUnit4ClassRunner.class)
    @ContextConfiguration(classes = {AppContext.class, TestAppContext.class})
    public class UserDaoTest {...}
    
    @RunWith(SpringJUnit4ClassRunner.class)
    @ContextConfiguration(classes = {AppContext.class, TestAppContext.class})
    public class UserServiceTest {...}
    ```
    

7.6.14 SqlServiceContextë¶„ë¦¬ì™€ @Import

- ìš´ì˜ì™€ í…ŒìŠ¤íŠ¸ì˜ ì»¨í…ìŠ¤íŠ¸ ë¶„ë¦¬ëŠ” í–ˆìŒ
- í•˜ì§€ë§Œ, SQLì˜ ì„œë¹„ìŠ¤ëŠ” ê·¸ ìì²´ë¡œ ë…ë¦½ì ìœ¼ë¡œ ëª¨ë“ˆë¡œ ì·¨ê¸‰ë˜ì•¼ í•˜ê¸° ë•Œë¬¸ì— SQLì˜ ì„œë¹„ìŠ¤ ë¶€ë¶„ë„ ë¶„ë¦¬í•˜ëŠ” ê²ƒì´ ì¢‹ìŒ
    
    <aside>
    ğŸ’¡ SqlServiceì˜ êµ¬í˜„ í´ë˜ìŠ¤ì™€ ì´ë¥¼ ì§€ì›í•˜ëŠ” í´ë˜ìŠ¤ëŠ” ë‹¤ë¥¸ ì• í”Œë¦¬ì¼€ì´ì…˜ êµ¬ì„±ë“¤ê³¼ ë‹¬ë¦¬ ë…ë¦½ì ìœ¼ë¡œ ê°œë°œë˜ê±°ë‚˜ ë³€ê²½ë˜ê¸° ë•Œë¬¸
    
    </aside>
    
- SQLì˜ ì„œë¹„ìŠ¤ ì»¨í…ìŠ¤íŠ¸ì˜ ì´ë¦„ì„ `SqlServiceContext`ë¡œ ì„¤ì •
    
    ```java
    @Configuration
    public class AppContext {
    		...
        ~~@Bean~~
        ~~public SqlService sqlService() {...}~~
        ~~@Bean~~
        ~~public SqlRegistry sqlRegistry() {...}~~
        ~~@Bean~~
        ~~public Unmarshaller unmarshaller() {...}~~
        ~~@Bean~~
        ~~public DataSource embeddedDatabase() {...}~~
    }
    ```
    
    ```java
    @Configuration
    public class SqlServiceContext {
        @Bean
        public SqlService sqlService() {
            OxmSqlService sqlService = new OxmSqlService();
            sqlService.setUnmarshaller(unmarshaller());
            sqlService.setSqlRegistry(sqlRegistry());
            return sqlService;
        }
    
        @Bean
        public SqlRegistry sqlRegistry() {
            EmbeddedDbSqlRegistry sqlRegistry = new EmbeddedDbSqlRegistry();
            sqlRegistry.setDataSource(embeddedDatabase());
            return sqlRegistry;
        }
    
        @Bean
        public Unmarshaller unmarshaller() {
            Jaxb2Marshaller marshaller = new Jaxb2Marshaller();
            marshaller.setContextPath("com.ksb.spring.jaxb");
            return marshaller;
        }
    
        @Bean
        public DataSource embeddedDatabase() {
            return new EmbeddedDatabaseBuilder()
                    .setName("embeddedDatabase")
                    .setType(HSQL)
                    .addScript("schema.sql")
                    .build();
        }
    }
    ```
    
- ìƒˆë¡œìš´ ì„¤ì • ì •ë³´ê°€ ìƒê²¼ìœ¼ë‹ˆ í•´ë‹¹ ì„¤ì •ì •ë³´ë¥¼ ì¶”ê°€í•´ì•¼ í•¨
- ê¸°ì¡´ì˜ ì„¤ì •ì •ë³´ ì¶”ê°€ì¸ @ContextConfigurationì—ì„œ ì¶”ê°€í•˜ëŠ” ê²ƒ ë³´ë‹¤ ë” ì¢‹ì€ ë°©ë²•ì´ ìˆìŒ
    
    ```java
    @ContextConfiguration(classes = {AppContext.class, TestAppContext.class})
    public class UserServiceTest {...}
    ```
    
- `AppContext`ì—ì„œ `SqlServiceContext`ê°€ í•„ìš”í•˜ê¸° ë•Œë¬¸ì— ê¸´ë°€íˆ ì—°ê²°í•˜ëŠ” ê²ƒì´ ì¢‹ìŒ
- @Importë¥¼ ì‚¬ìš©í•˜ë©´ í•œ ì„¤ì •ì •ë³´ì—ì„œ íŠ¹ì • ì„¤ì •ì •ë³´ë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ìˆìŒ
- ê°€ì ¸ì˜¤ëŠ” íŠ¹ì • ì„¤ì •ì •ë³´ë¥¼ ë³´ì¡° ì„¤ì •ì •ë³´ë¡œ ì‚¬ìš©
- `AppContext`ê°€ **ë©”ì¸** ì„¤ì •ì •ë³´ê°€ ë˜ê³  `SqlServiceContext`ëŠ” **ë³´ì¡°** ì„¤ì •ì •ë³´ë¡œ ì‚¬ìš©í•˜ëŠ” ë°©ë²•ì„
    
    ```java
    @Configuration
    @EnableTransactionManagement
    @ComponentScan(basePackages = "com.ksb.spring")
    @Import(SqlServiceContext.class)
    public class AppContext {...}
    ```
    

7.6.15 í”„ë¡œíŒŒì¼

- mailSenderì˜ ê²½ìš° ì‹¤ì œ ë©”ì¼ì´ ì „ì†¡ë˜ì§€ ì•Šë„ë¡ dummyMailSenderì„ ë§Œë“¤ì–´ **í…ŒìŠ¤íŠ¸**ìš©ìœ¼ë¡œë§Œ ì‚¬ìš©í–ˆìŒ
    
    ```java
    @Bean
    public MailSender mailSender(){
        return new DummyMailSender();
    }
    ```
    
- **ìš´ì˜í™˜ê²½**ì—ì„œëŠ” ì‹¤ì œ ë©”ì¼ì´ ì „ì†¡ë˜ì•¼ í•¨
- ìš´ì˜í™˜ê²½ì—ì„œë§Œ í•„ìš”í•œ ë¹ˆì„ ë‹´ì€ ë¹ˆ ì„¤ì • í´ë˜ìŠ¤ì¸ `ProductionAppContext`ë¥¼ ë§Œë“¦
    
    ```java
    @Configuration
    public class ProductionAppContext {
        @Bean
        public MailSender mailSender(){
            JavaMailSenderImpl mailSender = new JavaMailSenderImpl();
            mailSender.setHost("localhost");
            return mailSender;
        }
    }
    ```
    
- í•´ë‹¹ ë¹ˆì„ í…ŒìŠ¤íŠ¸ì—ì„œ ìš´ì˜ìœ¼ë¡œ ë³€ê²°ë  ë•Œ ë§ˆë‹¤, ë§¤ë²ˆ ìš´ì˜í™˜ê²½ì—ì„œ DIê°€ ë³€ê²½ë˜ë„ë¡ ë°”ê¿”ì•¼ í•œë‹¤ëŠ” ë‹¨ì ì´ ìˆìŒ
- **í”„ë¡œíŒŒì¼**ì„ ì ìš©í•˜ë©´ í•´ë‹¹ ë¬¸ì œë¥¼ í•´ê²°í•  ìˆ˜ ìˆìŒ
- í”„ë¡œíŒŒì¼ë¡œ í™œì„± ë° ë¹„í™œì„± ì„¤ì •ì •ë³´ë¥¼ ì§€ì •í•  ìˆ˜ ìˆìŒ
- í”„ë¡œíŒŒì¼ì€ í•˜ë‚˜ì˜ ì„¤ì • í´ë˜ìŠ¤ë§Œ ê°€ì§€ê³  í™˜ê²½ì— ë”°ë¼ ë¹ˆ ì„¤ì • ì¡°í•©ì„ ë§Œë“¤ ìˆ˜ ìˆìŒ
- í”„ë¡œíŒŒì¼ì€ @Profileì„ ì‚¬ìš©í•˜ë©´ ë¨
    
    ```java
    @Configuration
    @Profile("production")
    public class ProductionAppContext {...}
    
    @Configuration
    @Profile("test")
    public class TestAppContext {...}
    ```
    
- í”„ë¡œíŒŒì¼ì„ ì§€ì •í•˜ì§€ ì•Šìœ¼ë©´ ë””í´íŠ¸ ë¹ˆ ì„¤ì •ì •ë³´ë¡œ ì·¨ê¸‰ë˜ì–´ í•­ìƒ ì ìš© ë¨
- í”„ë¡œíŒŒì¼ì„ ì ìš©í•˜ë©´ ëª¨ë“  ì„¤ì • í´ë˜ìŠ¤ë¥¼ ë¶€ë‹´ ì—†ì´ ë©”ì¸ ì„¤ì • í´ë˜ìŠ¤ì— @Importí•  ìˆ˜ ìˆë‹¤ëŠ” ì¥ì ì´ ìˆìŒ
    
    ```java
    @Configuration
    @EnableTransactionManagement
    @ComponentScan(basePackages = "com.ksb.spring")
    @Import({SqlServiceContext.class,
            TestAppContext.class, ProductionAppContext.class})
    public class AppContext {...}
    ```
    
- ë˜í•œ, `AppContext`ê°€ ëª¨ë“  ì„¤ì • íŒŒì¼ì„ ê°€ì§€ê³  ìˆê¸° ë•Œë¬¸ì— @ContextConfigurationì— í•˜ë‚˜ì˜ ì„¤ì •ì •ë³´ë§Œ ë‚¨ê¸¸ ìˆ˜ ìˆìŒ.
- í™œì„± í”„ë¡œíŒŒì¼ì€ @ActiveProfilesì— ì§€ì •í•˜ë©´ ë¨
    
    ```java
    @RunWith(SpringJUnit4ClassRunner.class)
    @ActiveProfiles("test")
    @ContextConfiguration(classes = AppContext.class)
    public class UserServiceTest {...}
    
    @RunWith(SpringJUnit4ClassRunner.class)
    @ActiveProfiles("test")
    @ContextConfiguration(classes = AppContext.class)
    public class UserDaoTest {...}
    ```
    

7.6.15 ì»¨í…Œì´ë„ˆì˜ ë¹ˆ ë“±ë¡ ì •ë³´ í™•ì¸

- í™œì„± í”„ë¡œíŒŒì¼ì´ ì œëŒ€ë¡œ ì ìš©ë˜ì–´ í”„ë¡œíŒŒì¼ì˜ ë¹ˆ ì„¤ì •ë§Œ ì ìš©ë¼ì–´, í•´ë‹¹ ë¹ˆì´ ë§Œë“¤ì–´ì§€ëŠ”ì§€ ì˜ë¬¸ì´ ìˆìŒ
- ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆì— ë“±ë¡ëœ ë¹ˆ ì •ë³´ë¥¼ ì¡°íšŒí•  ìˆ˜ ìˆìŒ
- ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆëŠ” ëª¨ë‘ `BeanFactory`ë¥¼ êµ¬í˜„í•¨
- `BeanFactory`ë¥¼ êµ¬í˜„ í´ë˜ìŠ¤ ì¤‘ `DefaultListableBeanFactory`ë¥¼ í†µí•´ ëŒ€ë¶€ë¶„ì˜ ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆëŠ” ë¹ˆì„ ë“±ë¡ ë° ê´€ë¦¬ í•¨
- í•´ë‹¹ í´ë˜ìŠ¤ì˜ getBeanDefinitionNames()ë¡œ ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆì˜ ëª¨ë“  ë¹ˆì„ ê°€ì ¸ì˜¬ ìˆ˜ ìˆìŒ
    
    ```java
    public class UserServiceTest {  
        @Autowired
        DefaultListableBeanFactory bf;
    		...
        @Test
        public void beans() {
            for (String n : bf.getBeanDefinitionNames())
                System.out.println("ì»¨í…Œì´ë„ˆ ë‚´ë¶€ ë¹ˆ : " + n + 
                        "\t" + bf.getBean(n).getClass().getName());
        }
    }
    ```
    

7.6.16 ì¤‘ì²© í´ë˜ìŠ¤ë¥¼ ì´ìš©í•œ í”„ë¡œíŒŒì¼ ì ìš©

- ì—¬ëŸ¬ ì„¤ì •ì •ë³´ë¥¼ @Importë¡œ ëª¨ì•„ ë©”ì¸ ì„¤ì • í´ë˜ìŠ¤ë§Œìœ¼ë¡œ ì„¤ì •ì´ ê°€ëŠ¥í–ˆìŒ
- ë˜í•œ, í”„ë¡œíŒŒì¼ì„ ì ìš©í•´ í™˜ê²½ì— ë§ëŠ” ë¹ˆë§Œ ì ìš©í•  ìˆ˜ ìˆì—ˆìŒ
- í•˜ì§€ë§Œ, í”„ë¡œíŒŒì¼ì„ ê° í´ë˜ìŠ¤ íŒŒì¼ë¡œ ë¶„ë¦¬í•˜ë‹ˆ íŒŒì¼ì˜ ê°œìˆ˜ê°€ ë§ì•„ì¡ŒìŒ
- ì¤‘ì²© íŒŒì¼ë¡œ í”„ë¡œíŒŒì¼ì— ë”°ë¼ ë‚˜ëˆˆ í´ë˜ìŠ¤ë¥¼ í•˜ë‚˜ì˜ í´ë˜ìŠ¤ íŒŒì¼ë¡œ ëª¨ìœ¼ëŠ” ê²ƒì´ ì¢‹ìŒ
    
    ```java
    @Configuration
    @EnableTransactionManagement
    @ComponentScan(basePackages = "com.ksb.spring")
    @Import({SqlServiceContext.class,
            AppContext.TestAppContext.class, AppContext.ProductionAppContext.class})
    public class AppContext {
    		...
        @Configuration
        @Profile("production")
        public static class ProductionAppContext {...}
    
        @Configuration
        @Profile("test")
        public static class TestAppContext {...}
    
    }
    ```
    
    <aside>
    ğŸ’¡ ë‚´ë¶€ ì„¤ì • ì •ë³´ í´ë˜ìŠ¤ëŠ” staticì„
    
    </aside>
    
- ì¤‘ì²© ë‚´ë¶€ í´ë˜ìŠ¤ëŠ” ë©”ì¸ ì„¤ì •ì •ë³´ì— ìˆê¸° ë•Œë¬¸ì— ìƒëµ ê°€ëŠ¥
    
    ```java
    @Configuration
    @EnableTransactionManagement
    @ComponentScan(basePackages = "com.ksb.spring")
    @Import(SqlServiceContext.class)
    public class AppContext {...}
    ```
    

7.6.16 í”„ë¡œí¼í‹° ì†ŒìŠ¤

- í”„ë¡œíŒŒì¼ì„ í†µí•´ í…ŒìŠ¤íŠ¸ì™€ ìš´ì˜ í™˜ê²½ì—ì„œ ê°ê° ë‹¤ë¥¸ ë¹ˆ ì„¤ì •ì´ ì ìš©ë˜ê²Œ ë§Œë“¤ì—ˆìŒ
- í•˜ì§€ë§Œ, ì•„ì§ `AppContext`ì— í…ŒìŠ¤íŠ¸ í™˜ê²½ì— ì¢…ì†ì ì¸ DB ì—°ê²° ì •ë³´ê°€ ë‚¨ì•„ ìˆìŒ
    
    ```java
    public class AppContext {
        @Bean
        public DataSource dataSource() {
            SimpleDriverDataSource dataSource = new SimpleDriverDataSource();
            try {
                dataSource.setDriverClass((Class<? extends Driver>) Class.forName("com.mysql.cj.jdbc.Driver"));
            } catch (ClassNotFoundException e) {
                e.printStackTrace();
            }
            dataSource.setUrl("jdbc:mysql://localhost/toby?serverTimezone=UTC");
            dataSource.setUsername("root");
            dataSource.setPassword("1234");
            return dataSource;
        }
    		...
    }
    ```
    
- DB ì—°ê²° ì •ë³´ëŠ” ì†ì‰½ê²Œ í¸ì§‘í•˜ê¸° ìœ„í•´ ë¹Œë“œê°€ í•„ìš”í•˜ì§€ ì•ŠëŠ” ì™¸ë¶€ í…ìŠ¤íŠ¸ íŒŒì¼ì—ì„œ í•˜ëŠ”ê²ƒì´ ì˜³ìŒ
- ìë°”ì˜ **í”„ë¡œí¼í‹° íŒŒì¼** í¬ë§·ì„ ì´ìš©í•´, ì´ë¦„ê³¼ ê°’ì˜ ìŒìœ¼ë¡œ êµ¬ì„±ë˜ê²Œ ë§Œë“¦
    
    ```
    db.driverClass=com.mysql.cj.jdbc.Driver
    db.url=jdbc:mysql://localhost/toby?serverTimezone=UTC
    db.username=root
    db.password=1234
    ```
    
    <aside>
    ğŸ’¡ íŒŒì¼ì˜ ì´ë¦„ì„ database.propertiesì´ë¼ ì •í•¨
    
    </aside>
    
- @PropertySourceë¥¼ ì‚¬ìš©í•´ í”„ë¡œí¼í‹° íŒŒì¼ì˜ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ìˆìŒ
    
    ```java
    @Configuration
    @EnableTransactionManagement
    @ComponentScan(basePackages = "com.ksb.spring")
    @Import(SqlServiceContext.class)
    @PropertySource("/database.properties")
    public class AppContext {...}
    ```
    
- í”„ë¡œí¼í‹°ì˜ ê°’ì€ `Environment` íƒ€ì…ì˜ í™˜ê²½ ì˜¤ë¸Œì íŠ¸ì— ì €ì¥ ë¨
    
    ```java
    
    ```