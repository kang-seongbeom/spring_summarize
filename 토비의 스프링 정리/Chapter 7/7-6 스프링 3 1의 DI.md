# 7.6 ìŠ¤í”„ë§ 3.1ì˜ DI

7.6.1 ì• ë…¸í…Œì´ì…˜ì˜ ë©”íƒ€ì •ë³´ í™œìš©

- ì´ˆê¸° ë¦¬í”Œë ‰ì…˜ APIëŠ” ìë°” ì½”ë“œë‚˜ ì»´í¬ë„ŒíŠ¸ë¥¼ ì‘ì„±í•˜ëŠ”ë° ì‚¬ìš©ë˜ëŠ” íˆ´ì„ ê°œë°œí•  ë•Œ ì´ìš©í•˜ë„ë¡ ë§Œë“¤ì–´ì¡ŒìŒ
- ì´í›„, ìë°” ì½”ë“œì˜ **ë©”íƒ€ì •ë³´**ë¥¼ ë°ì´í„°ë¥¼ í™œìš©í•˜ëŠ” ìŠ¤íƒ€ì¼ì˜ í”„ë¡œê·¸ë˜ë° ë°©ì‹ì—ì„œ ë¦¬í”Œë ‰ì…˜ APIë¥¼ í™œìš©í•˜ë„ë¡ ë³€í™”ë¨
- í•´ë‹¹ í”„ë¡œê·¸ë˜ë° ë°©ì‹ì˜ ì ˆì •ì´ **ì• ë…¸í…Œì´ì…˜**ì„
- ë¦¬í”„ë ‰ì…˜ APIë¥¼ ì´ìš©í•´ ì• ë…¸í…Œì´ì…˜ì˜ ë©”íƒ€ì •ë³´ë¥¼ ì¡°íšŒí•˜ê³  ê°€ì ¸ì˜¤ëŠ” ë°©ë²•ì´ ì „ë¶€ì„
- ì• ë…¸í…Œì´ì…˜ ìì²´ê°€ í´ë˜ìŠ¤ì˜ íƒ€ì…ì— ì˜í–¥ì„ ì£¼ì§€ ëª»í•˜ê³ , ì½”ë“œì—ì„œ í™œìš©ë ìˆ˜ ì—†ì–´ OOP ìŠ¤íƒ€ì¼ì˜ ì½”ë“œë‚˜ íŒ¨í„´ì„ ì ìš©í•  ìˆ˜ ì—†ìŒ
- í•˜ì§€ë§Œ, ì• ë…¸í…Œì´ì…˜ì€ ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ **í•µì‹¬ ë¡œì§**ê³¼ ì´ë¥¼ ì§€ì›í•˜ëŠ” **Ioc í”„ë ˆì„ì›Œí¬**ì™€ ì˜ ì–´ìš¸ë¦¼
- ì• ë…¸í…Œì´ì…˜ì€ Ioc í”„ë ˆì„ì›Œí¬ê°€ **ì°¸ì¡°**í•˜ëŠ” **ë©”íƒ€ì •ë³´**ë¡œ ì‚¬ìš©ë˜ê¸° ë•Œë¬¸ì— ì• ë…¸í…Œì´ì…˜ì˜ í™œìš©ë„ê°€ ì¦ê°€í•˜ê³  ìˆìŒ
- í”„ë ˆì„ì›Œí¬ì—ì„œ XMLì„ DIìš© **ë©”íƒ€ì •ë³´**ë¡œ í™œìš©í•˜ê¸° ë•Œë¬¸ì—, ê°„ê²°í•œ ì½”ë”©ì´ ê°€ëŠ¥í–ˆìŒ
- í•˜ì§€ë§Œ, XMLì€ í‘œí˜„í•˜ë ¤ëŠ” ì •ë³´ë¥¼ ëª¨ë‘ ëª…ì‹œì ìœ¼ë¡œ ë‚˜íƒ€ë‚´ì•¼ í•¨
    
    ```xml
    <x:special target="type" class="com.mycompany.myproject.MyClass" />
    ```
    
- ì´ì™€ ëŒ€ì¡°ì ìœ¼ë¡œ ì• ë…¸í…Œì´ì…˜ì„  ì¶”ê°€í•˜ëŠ” ê²ƒ ë§Œìœ¼ë¡œ ë¦¬í”Œë ‰ì…˜ APIë¥¼ í™œìš©í•´ íŒ¨í‚¤ì§€, í´ë˜ìŠ¤ ì´ë¦„, ì ‘ê·¼ ì œí•œì, êµ¬í˜„ ì¸í„°í˜ì´ìŠ¤ ë“±ì˜ ì—¬ëŸ¬ ì •ë³´ë¥¼ ì–»ì„ ìˆ˜ ìˆìŒ
    
    ```java
    @Special
    public class MyClass{...}
    ```
    
- ë¬¼ë¡ , ì• ë…¸í…Œì´ì…˜ì—ë„ ë‹¨ì ì´ ì¡´ì¬í•¨
- XML ë³€ê²½ ì‹œ  ë¹Œë“œ ê³¼ì •ì„ ìƒëµí•´ë„ ë˜ì§€ë§Œ, ì• ë…¸í…Œì´ì…˜ì€ ìë°” ì½”ë“œì— ì¡´ì¬í•˜ë¯€ë¡œ ë¹Œë“œë¥¼ ìƒˆë¡œ í•´ ì¤˜ì•¼ í•¨
- **ìë°” ê°œë°œ íë¦„**ì€ ì ì°¨ XML ê°™ì€ í…ìŠ¤íŠ¸ í˜•íƒœì˜ ë©”íƒ€ì •ë³´ë¥¼ í™œìš©ì„ ìë°” ì½”ë“œì— ë‚´ì¥ëœ ì• ë…¸í…Œì´ì…˜ì„ ëŒ€ì²´í•˜ëŠ” ìª½ìœ¼ë¡œ ê°€ê³  ìˆìŒ**[Spring-Boot]**
- ìŠ¤í”„ë§ 2.5 ë²„ì „ì—ì„œ ë¶€í„° ìŠ¤í”„ë§ ì¼ë¶€ì— ì• ë…¸í…Œì´ì…˜ì„ ì ìš©í•˜ê¸° ì‹œì‘í–ˆìŒ
- 3.0ê¹Œì§€ XMLì„ ì™„ì „íˆ ë°°ì œí•˜ëŠ” ê²ƒì´ ë¶ˆê°€ëŠ¥ í–ˆì§€ë§Œ, 3.1 ë¶€í„° ê±°ì˜ ëª¨ë“  ì˜ì—­ì— XML ëŒ€ì‹  ì• ë…¸í…Œì´ì…˜ìœ¼ë¡œ ëŒ€ì²´í•  ìˆ˜ ìˆê²Œ ë³€ê²½ë¨

7.6.2 ì •ì±…ê³¼ ê´€ë¡€ë¥¼ ì´ìš©í•œ í”„ë¡œê·¸ë˜ë°

- ì• ë…¸í…Œì´ì…˜ ê°™ì€ ë©”íƒ€ì •ë³´ë¥¼ í™œìš©í•˜ëŠ” í”„ë¡œê·¸ë˜ë° ë°©ì‹ì€ ëª…ì‹œì ìœ¼ë¡œ ë™ì‘ ì½”ë“œë¥¼ ê¸°ìˆ í•˜ëŠ” ëŒ€ì‹ , ì½”ë“œ ì—†ì´ë„ ë¯¸ë¦¬ ì•½ì†ëœ **ê·œì¹™** ë˜ëŠ” **ê´€ë¡€**ë¥¼ ë”°ë¼ í”„ë¡œê·¸ë¨ì´ ë™ì‘í•˜ë„ë¡ í•¨
- ë¯¸ë¦¬ ì•½ì†ëœ ê·œì¹™ê³¼ ê´€ë¡€ì— ë”°ë¼ í”„ë ˆì„ì›Œí¬ê°€ ì‘ì—…ì„ ìˆ˜í–‰í•˜ê¸° ë•Œë¬¸ì—, ë§ì€ ì½”ë“œì˜ ë‚´ìš©ì„  ìƒëµí•  ìˆ˜ ìˆìŒ
- í•˜ì§€ë§Œ, ë¯¸ë¦¬ ì •ì˜ëœ ê·œì¹™ê³¼ ê´€ë¡€ë¥¼ ê¸°ì–µ í•´ì•¼í•˜ëŠ” ë¶€ë‹´ì´ ìˆìŒ
- ìŠ¤í”„ë§ì€ ë£¨ë¹„ ì–¸ì–´ë¥¼ ê¸°ë°˜ìœ¼ë¡œí•œ RoR **í”„ë ˆì„ì›Œí¬**ì— ì˜í–¥ì„ ë°›ì•˜ìŒ
- ìŠ¤í”„ë§ì€ XML ë˜ëŠ” ì• ë…¸í…Œì´ì…˜ì˜ **ë©”íƒ€ì •ë³´**ë¥¼ í™œìš©í•œ í”„ë ˆì„ì›Œí¬ì´ê¸° ë•Œë¬¸ì—, ì½”ë“œê°€ ë§¤ìš° ê°„ëµí•  ìˆ˜ ìˆìŒ
- ìŠ¤í”„ë§ì€ ì• ë…¸í…Œì´ì…˜ìœ¼ë¡œ ë©”íƒ€ì •ë³´ë¥¼ í™œìš©í•˜ëŠ” ë°©ì‹ì„ ì ê·¹ ë„ì…í•˜ê³  ìˆìŒ

7.6.3 ì§€ê¸ˆ ê¹Œì§€ ë§Œë“  XML

```xml
<?xml version="1.0" encoding="UTF-8"?>
<beans >

    <tx:annotation-driven/>

    <context:annotation-config/>

    <jdbc:embedded-database id="embeddedDatabase" type="HSQL">
        <jdbc:script location="schema.sql"/>
    </jdbc:embedded-database>

    <bean id="testUserService"
          class="com.ksb.spring.UserServiceImpl$TestUserService"
          parent="userService">
    </bean>

    <bean id="userService" class="com.ksb.spring.UserServiceImpl">
        <property name="userDao" ref="userDao"/>
        <property name="mailSender" ref="mailSender"/>
    </bean>

    <bean id="mailSender"
          class="com.ksb.spring.DummyMailSender">
        <property name="host" value="mail.server.com"/>
    </bean>

    <bean id="transactionManager"
          class="org.springframework.jdbc.datasource.DataSourceTransactionManager">
        <property name="dataSource" ref="dataSource"/>
    </bean>

    <bean id="userDao" class="com.ksb.spring.UserDaoJdbc">
        <property name="dataSource" ref="dataSource"/>
        <property name="sqlService" ref="sqlService"/>
    </bean>

    <bean id="sqlService" class="com.ksb.spring.OxmSqlService">
        <property name="unmarshaller" ref="unmarshaller"/>
				<!--ë””í´íŠ¸-->
        <!--<property name="sqlmap" value="classpath:/sqlmap.xml"/>-->
        <property name="sqlRegistry" ref="sqlRegistry"/>
    </bean>

    <bean id="sqlRegistry" class="com.ksb.spring.EmbeddedDbSqlRegistry">
        <property name="dataSource" ref="embeddedDatabase"/>
    </bean>

    <bean id="unmarshaller" class="org.springframework.oxm.jaxb.Jaxb2Marshaller">
        <property name="contextPath" value="com.ksb.spring.jaxb"/>
    </bean>

    <bean id="dataSource" class="org.springframework.jdbc.datasource.SimpleDriverDataSource">
        <property name="driverClass" value="com.mysql.cj.jdbc.Driver"/>
        <property name="url" value="jdbc:mysql://localhost/toby?serverTimezone=UTC"/>
        <property name="username" value="root"/>
        <property name="password" value="1234"/>
    </bean>
</beans>
```

7.6.4 í…ŒìŠ¤íŠ¸ ì»¨í…ìŠ¤íŠ¸ ë³€ê²½

- ì• ë…¸í…Œì´ì…˜ê³¼ ìë°”ì½”ë“œë¡œ ê¸°ì¡´ì˜ XMLë¡œ ë§Œë“  ì„¤ì •ì •ë³´ë¥¼ ëŒ€ì²´í•  ê²ƒì„
- XMLì„ ë” ì´ìƒ ì‚¬ìš©í•˜ì§€ ì•Šê²Œ í•˜ëŠ” ê²ƒì´ **ìµœì¢… ëª©ì **ì„
- ìŠ¤í”„ë§ 3.1ì€ ìë°” ì½”ë“œ ì„¤ì • ì •ë³´ì—ì„œ XMLê³¼ ìë°” ì½”ë“œë¡œ ë§Œë“¤ì–´ì§„ DIì„ ë™ì‹œì— ì‚¬ìš©í•  ë°©ë²•ì„ ì œê³µí•˜ê³  ìˆìŒ
- @ImportResourceê°€ ë°”ë¡œ ê·¸ê²ƒì„
    
    ```java
    /*ì• ë…¸í…Œì´ì…˜ì„ í™œìš©í•œ ìë°” ì½”ë“œ ì„¤ì • ì •ë³´ë¥¼ ë§Œë“¦.
      ì•„ì§ ì•„ë¬´ëŸ° ì„¤ì • ì •ë³´ê°€ ì—†ê¸° ë•Œë¬¸ì—, XMLì˜ ì„¤ì • ì •ë³´ë¥¼ ê°€ì ¸ì˜´
    */
    @Configuration
    @ImportResource("/applicationContext.xml")
    public class TestApplicationContext {
    }
    ```
    
- ì •ìƒì ìœ¼ë¡œ ë™ì‘í•˜ëŠ” ê²ƒì„ í™•ì¸í•˜ê¸° ìœ„í•´ í…ŒìŠ¤íŠ¸ ì½”ë“œë¥¼ ëŒë ¤ë´ì•¼ í•¨
- ê¸°ì¡´ XMLì„ ì‚¬ìš©í•˜ëŠ” í…ŒìŠ¤íŠ¸ì¸ UserDaoTestì™€ UserServiceTestì—ì„œ ì„¤ì • ì •ë³´ë¥¼ ê°€ì ¸ì˜¤ëŠ” ë¶€ë¶„ì„ ìˆ˜ì •í•´ì•¼ í•¨
    
    ```java
    //@ContextConfigurationì—ì„œ XMLì•„ë‹Œ ìë°” ì½”ë“œ ì„¤ì •ì •ë³´ë¥¼ ê°€ì ¸ì˜¤ë„ë¡ ìˆ˜ì •
    @RunWith(SpringJUnit4ClassRunner.class)
    @ContextConfiguration(classes = TestApplicationContext.class)
    public class UserDaoTest {
    }
    
    @RunWith(SpringJUnit4ClassRunner.class)
    @ContextConfiguration(classes = TestApplicationContext.class)
    public class UserServiceTest {
    }
    ```
    

7.6.5 <context:annotation-config /> ì œê±°

- <context:annotation-config />ëŠ” @PostConstructë¥¼ ë¶™ì¸ ë©”ì†Œë“œê°€ ë¹ˆì´ ì´ˆê¸°í™”ëœ ì´í›„ì— ìë™ìœ¼ë¡œ ì‹¤í–‰ë˜ë„ë¡ í•¨
- ì¦‰, @PostConstructì™€ ê°™ì€ í‘œì¤€ ì• ë…¸í…Œì´ì…˜ì„ ì¸ì‹í•´ ìë™ìœ¼ë¡œ ë©”ì†Œë„ë¥¼ ì‹¤í–‰ì‹œí‚´
- ì˜ˆë¥¼ ë“¤ì–´, `OxmSqlService`ì˜ loadsql() ë©”ì†Œë“œëŠ” `OxmSqlService`ê°€ ì˜¬ë°”ë¥´ê²Œ ë™ì‘í•˜ê¸° ìœ„í•´ ë¯¸ë¦¬ ì‹¤í–‰ë¼ì•¼ í•˜ë¯€ë¡œ @PostConstructë¥¼ ë¶€ì—¬í–ˆìŒ
- XMLì— ë‹´ê¸´ DI ì •ë³´ë¥¼ ì´ìš©í•˜ëŠ” ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆë¥¼ ì‚¬ìš©í•˜ëŠ” ê²½ìš°ì— @PostConstructì™€ ê°™ì€ ì• ë…¸í…Œì´ì…˜ì˜ ê¸°ëŠ¥ì´ í•„ìš”í•˜ë©´ ë°˜ë“œì‹œ <context:annotation-config />ë¥¼ í¬í•¨í•´ í•„ìš”í•œ **ë¹ˆ í›„ì²˜ë¦¬ê¸°**ê°€ **ë“±ë¡**ë˜ê²Œ ë§Œë“¤ì–´ì•¼ í•¨
- ë°˜ë©´ì—, XMLì´ ì•„ë‹Œ **@Configaration**ì´ ë¶™ì€ **ì„¤ì • í´ë˜ìŠ¤**ë¥¼ ì‚¬ìš©í•˜ëŠ” ê²½ìš° <context:annotation-config />ê°€ í•„ìš” ì—†ìŒ
- ì´ìœ ëŠ”, ì»¨í…Œì´ë„ˆê°€ ì§ì ‘ @PostConstruct ì• ë…¸í…Œì´ì…˜ì„ ì²˜ë¦¬í•˜ëŠ” ë¹ˆ í›„ì²˜ë¦¬ê¸°ë¥¼ ë“±ë¡í•˜ê¸° ë•Œë¬¸ì„

```xml
<beans>
		<!--ì œê±°-->
		~~<context:annotation-config/>~~
</beans>
```

7.6.6 dataSource ë¹ˆì˜ ì „í™˜

- <bean>ì€ @Beanê³¼ ê±°ì˜ 1:1ë¡œ ë§¤í•‘ë¨
- dataSource ë¹ˆì—ì„œ id ê°’ì€ ë©”ì†Œë“œ ì´ë¦„ì´ê³ , ë¦¬í„´ ê°’ì€ class ê°’ì„
    
    ```xml
    <bean id="dataSource" class="org.springframework.jdbc.datasource.SimpleDriverDataSource">
        <property name="driverClass" value="com.mysql.cj.jdbc.Driver"/>
        <property name="url" value="jdbc:mysql://localhost/toby?serverTimezone=UTC"/>
        <property name="username" value="root"/>
        <property name="password" value="1234"/>
    </bean>
    ```
    
- ë‹¨, **ë¦¬í„´ ê°’**ì€ DIì˜ ì›ë¦¬ì— ë”°ë¼ ë¹ˆì˜ êµ¬í˜„ í´ë˜ìŠ¤ëŠ” ììœ ë¡­ê²Œ ë³€ê²½í•˜ê¸° ë•Œë¬¸ì— ì‹¤ì œ êµ¬í˜„ í´ë˜ìŠ¤ê°€ ì•„ë‹Œ, êµ¬í˜„í•œ **ì¸í„°í˜ì´ìŠ¤**ë¡œ ë°˜í™˜í•˜ëŠ” ê²ƒì´ ì¢‹ìŒ
    
    ```java
    @Bean
    publid DataSource dataSource(){}
    ```
    
- í•˜ì§€ë§Œ, XMLê³¼ ê°™ì´ í”„ë¡œí¼í‹° ê°’ ì£¼ì…ì„ ìœ„í•´ ì‹¤ì œ ë°˜í™˜ë˜ëŠ” **ë³€ìˆ˜ íƒ€ì…**ì€ ì¸í„°í˜ì´ìŠ¤ë¥¼ êµ¬í˜„í•œ í´ë˜ìŠ¤(`SimpleDriverDataSource`)ë¡œ ì„ ì–¸í•´ì•¼ í•¨
- Datasourceì—ëŠ” getConnection()ë§Œ ìˆê¸° ë•Œë¬¸ì—, í”„ë¡œí¼í‹° ê°’ ì£¼ì…ì„ ìœ„í•´ êµ¬í˜„ í´ë˜ìŠ¤ê°€ í•„ìš”í•¨
    
    ```java
    SimpleDriverDataSource dataSource = new SimpleDriverDataSource();
    ```
    
- ìë°” ì½”ë“œì—ì„œ í”„ë¡œí¼í‹° driverClassì˜ ìŠ¤íŠ¸ë§ ê°’ì„ ìë™ìœ¼ë¡œ ë³€í™˜í•˜ì§€ ì•Šê¸° ë•Œë¬¸ì—, ì ì ˆí•œ íƒ€ì…ìœ¼ë¡œ ë³€í™˜í•´ ì£¼ì–´ì•¼ í•¨
    
    ```java
    dataSource.setDriverClass((Class<? extends Driver>) Class.forName("com.mysql.cj.jdbc.Driver"));
    ```
    
- xml ì‚­ì œ í›„ í…ŒìŠ¤íŠ¸ ì§„í–‰
    
    ```xml
    <!--ì‚­ì œ-->
    ~~<bean id="dataSource" class="org.springframework.jdbc.datasource.SimpleDriverDataSource">~~
        ...
    </bean>
    ```
    
    ```java
    public class TestApplicationContext {
        @Bean
        public DataSource dataSource() public class TestApplicationContext {{
            SimpleDriverDataSource dataSource = new SimpleDriverDataSource();
    
            try {
                dataSource.setDriverClass((Class<? extends Driver>) Class.forName("com.mysql.cj.jdbc.Driver"));
            } catch (ClassNotFoundException e) {
                e.printStackTrace();
            }
            dataSource.setUrl("jdbc:mysql://localhost/toby?serverTimezone=UTC");
            dataSource.setUsername("root");
            dataSource.setPassword("1234");
    
            return dataSource;
        }
    }
    ```
    

7.6.7 transactionManager ë¹ˆì˜ ì „í™˜

- transactionManagerëŠ” í”„ë¡œí¼í‹°ë¡œ dataSource ë¹ˆì„ ì˜ì¡´í•˜ê³  ìˆìŒ
    
    ```xml
    <bean id="transactionManager"
              class="org.springframework.jdbc.datasource.DataSourceTransactionManager">
        <property name="dataSource" ref="dataSource"/>
    </bean>
    ```
    
- ìë°” ì½”ë“œë¥¼ í†µí•œ ë¹ˆì˜ ì˜ì¡´ ê´€ê³„ëŠ” ë¹ˆ ë©”ì†Œë“œë¥¼ ì§ì ‘ í˜¸ì¶œí•´ ë¦¬í„´ ê°’ì„ ìˆ˜ì •ì ë©”ì†Œë“œì— ë„£ìœ¼ë©´ ë¨
    
    ```xml
    ~~<bean id="transactionManager">~~
    ```
    
    ```java
    public class TestApplicationContext {
    		...
    		@Bean
        public PlatformTransactionManager transactionManager() {
            DataSourceTransactionManager tm = new DataSourceTransactionManager();
            tm.setDataSource(dataSource());
            return tm;
        }
    }
    ```
    

7.6.8 ë‚˜ë¨¸ì§€ ë¹ˆì˜ ì „í™˜ - 1 

- userDao, userService, testUserService, mailSender ë¹ˆ ì „í™˜
- testUserServiceëŠ” userServiceì˜ í”„ë¡œí¼í‹° ì •ì˜ ë¶€ë¶„ì„ ê·¸ëŒ€ë¡œ ìƒì†í•˜ê²Œ ë§Œë“¤ì—ˆìŒ
    
    ```xml
    <bean id="testUserService"
          class="com.ksb.spring.UserServiceImpl$TestUserService"
          parent="userService">
    </bean>
    ```
    
- ì´ì „ì— ë§Œë“  `TestUserService` í´ë˜ìŠ¤ëŠ” í…ŒìŠ¤íŠ¸ ìš©ë„ë¡œ ë§Œë“¤ì—ˆê³ , ë‚´ë¶€ì ìœ¼ë¡œ ë¦¬í”Œë ‰ì…˜ APIë¥¼ ì‚¬ìš©í–ˆê¸° ë•Œë¬¸ì— private ì ‘ê·¼ ì œí•œìë¥¼ ì‚¬ìš©í•´ë„ ë¬¸ì œê°€ ì—†ì—ˆìŒ
- í•˜ì§€ë§Œ, ìë°” ì½”ë“œì˜ ì„¤ì • íŒŒì¼ì€ publicë§Œ ì ‘ê·¼í•  ìˆ˜ ìˆê¸° ë•Œë¬¸ì— publicìœ¼ë¡œ ì „í™˜ í•´ ì¤˜ì•¼ í•¨
    
    ```java
    public static class TestUserService extends UserServiceImpl {}
    ```
    
- ë„¤ ê°œì˜ ë¹ˆ ì „í™˜
    - userDaoì˜ sqlServiceëŠ” ì¼ë‹¨ XMLì—ì„œ ì£¼ì…ë°›ì•„ ì‚¬ìš©í•  ìˆ˜ ìˆê²Œ í•¨
    
    ```xml
    ~~<bean id="userDao" >
    <bean id="sqlService" >
    <bean id="testUserService" >
    <bean id="mailSender" >~~
    ```
    
    ```java
    public class TestApplicationContext {
    		...	
    		@Autowired
        SqlService sqlService;
    
    		@Bean
        public UserDao userDao()  {
            UserDaoJdbc dao = new UserDaoJdbc();
            dao.setDataSource(dataSource());
            dao.setSqlService(this.sqlService);
            return dao;
        }
    
        @Bean
        public UserService userService() {
            UserServiceImpl service = new UserServiceImpl();
            service.setUserDao(userDao());
            service.setMailSender(mailSender());
            return service;
        }
    
        @Bean
        public UserService testUserService(){
            UserServiceImpl.TestUserService testService =
                    new UserServiceImpl.TestUserService();
            testService.setUserDao(userDao());
            testService.setMailSender(mailSender());
            return testService;
        }
    
        @Bean
        public MailSender mailSender(){
            return new DummyMailSender();
        }
    }
    ```
    

7.6.9 ë‚˜ë¨¸ì§€ ë¹ˆì˜ ì „í™˜ - 2

- sqlService, sqlRegistry, unmarshaller ë¹ˆ ì „í™˜
- embeddedDatabaseë¥¼ ì£¼ì… ë°›ì„ ë•Œ @Resource ì• ë…¸í…Œì´ì…˜ ì‚¬ìš©
- @ResourceëŠ” @Autowiredì™€ ìœ ì‚¬í•˜ì§€ë§Œ, @ResourceëŠ” í•„ë“œ ì´ë¦„ì„ ê¸°ì¤€ìœ¼ë¡œ ë¹ˆì„ ì°¾ìŒ
    
    <aside>
    ğŸ’¡ @AutowiredëŠ” íƒ€ì…ì„ ê¸°ì¤€ìœ¼ë¡œ ë¹ˆì„ ì°¾ìŒ
    
    </aside>
    
- ì„¸ ê°œì˜ ë¹ˆ ì „í™˜
    
    ```xml
    ~~<bean id="sqlService" >
    <bean id="sqlRegistry" >
    <bean id="unmarshaller" >~~
    ```
    
    ```java
    public class TestApplicationContext {
    		@Resource
        DataSource embeddedDatabase;
    		...
        @Bean
        public SqlService sqlService(){
            OxmSqlService sqlService = new OxmSqlService();
            sqlService.setUnmarshaller(unmarshaller());
            sqlService.setSqlRegistry(sqlRegistry());
            return sqlService;
        }
    
        @Bean
        public SqlRegistry sqlRegistry(){
            EmbeddedDbSqlRegistry sqlRegistry = new EmbeddedDbSqlRegistry();
            sqlRegistry.setDataSource(this.embeddedDatabase);
            return sqlRegistry;
        }
    
        @Bean
        public Unmarshaller unmarshaller(){
            Jaxb2Marshaller marshaller = new Jaxb2Marshaller();
            marshaller.setContextPath("com.ksb.spring.jaxb");
            return marshaller;
        }
    }
    ```
    
- embeddedDatabase ë¹ˆì˜ ê²½ìš° ì „ìš© íƒœê·¸ë¡œ ë§Œë“¤ì—ˆìŒ
    
    ```xml
    <jdbc:embedded-database id="embeddedDatabase" type="HSQL">
        <jdbc:script location="schema.sql"/>
    </jdbc:embedded-database>
    ```
    
- ì „ìš© íƒœê·¸ë¡œ ë§Œë“¤ì–´ì§€ëŠ” ë¹ˆì´ ì—¬ëŸ¬ ê°œì¼ ìˆ˜ ìˆìŒ
- embeddedDatabaseëŠ” ë‚´ì¥í˜• DBë¡œ EmbeddedDatabaseBuilderë¥¼ ì´ìš©í•˜ë©´ ë¨
    
    ```xml
    ~~<jdbc:embedded-database id="embeddedDatabase" type="HSQL">~~
    ```
    
    ```java
    public class TestApplicationContext {
    		~~@Resource
        DataSource embeddedDatabase;~~
    		...
    		@Bean
        public SqlRegistry sqlRegistry(){
            EmbeddedDbSqlRegistry sqlRegistry = new EmbeddedDbSqlRegistry();
            sqlRegistry.setDataSource(embeddedDatabase());
            return sqlRegistry;
        }
    		~~~~@Bean
        public DataSource embeddedDatabase(){
            return new EmbeddedDatabaseBuilder()
                    .setName("embeddedDatabase")
                    .setType(HSQL)
                    .addScript("schema.sql")
                    .build();
        }
    ~~~~}
    ```
    
- ë§ˆì§€ë§‰ íƒœê·¸ì¸ <tx:annotation-driven/> ëŒ€ì²´
- <tx:annotation-driven/>ì€ @Transactionalì´ ë¶™ì€ ê³³ì— **ì–´ë“œë°”ì´ìŠ¤**ì™€ **í¬ì¸íŠ¸ì»·**ì„ ì ìš©í•˜ëŠ” ê¸°ëŠ¥ì„ í•¨
- ì´ ì—­ì‹œ ì „ìš© íƒœê·¸ë¡œ ê¸°ë³¸ì ìœ¼ë¡œ ë„¤ ê°€ì§€ í´ë˜ìŠ¤ë¥¼ ë¹ˆìœ¼ë¡œ ë“±ë¡í•¨
- í•´ë‹¹ ë„¤ ê°€ì§€ ë¹ˆì„ ë“±ë¡í•˜ê¸° ë²ˆê±°ë¡­ê¸°ë„ í•˜ê³ , ê¸°ì–µí•˜ê¸° í˜ë“¦
- ìŠ¤í”„ë§ 3.1 ë¶€í„° ì „ìš© íƒœê·¸ì— ëŒ€ì‘ë˜ëŠ” ì• ë…¸í…Œì´ì…˜ì„ ì œê³µí•¨
- í•´ë‹¹ ì• ë…¸í…Œì´ì…˜ë“¤ì€ @Enableë¡œ ì‹œì‘í•¨
- <tx:annotation-driven/>ëŠ” @EnableTransactionManagementë¡œ ëŒ€ì²´í•  ìˆ˜ ìˆìŒ
    
    ```xml
    ~~<tx:annotation-driven/>~~
    ```
    
    ```java
    //ëª¨ë“  XML ì„¤ì •ì •ë³´ë¥¼ ëŒ€ì²´í–ˆê¸° ë•Œë¬¸ì—, ImportResource ì‚­ì œ ê°€ëŠ¥
    ~~@ImportResource("/applicationContext.xml")~~
    @EnableTransactionManagement
    public class TestApplicationContext {}
    ```
    
- ì™„ì„±ëœ ì• ë…¸í…Œì´ì…˜ ê¸°ë°˜ ì„¤ì •ì •ë³´
    
    ```java
    @Configuration
    @EnableTransactionManagement
    public class TestApplicationContext {
    
        @Autowired
        SqlService sqlService;
    
        @Bean
        public DataSource dataSource() {
            SimpleDriverDataSource dataSource = new SimpleDriverDataSource();
    
            try {
                dataSource.setDriverClass((Class<? extends Driver>) Class.forName("com.mysql.cj.jdbc.Driver"));
            } catch (ClassNotFoundException e) {
                e.printStackTrace();
            }
            dataSource.setUrl("jdbc:mysql://localhost/toby?serverTimezone=UTC");
            dataSource.setUsername("root");
            dataSource.setPassword("1234");
    
            return dataSource;
        }
    
        @Bean
        public PlatformTransactionManager transactionManager() {
            DataSourceTransactionManager tm = new DataSourceTransactionManager();
            tm.setDataSource(dataSource());
            return tm;
        }
    
        @Bean
        public UserDao userDao()  {
            UserDaoJdbc dao = new UserDaoJdbc();
            dao.setDataSource(dataSource());
            dao.setSqlService(this.sqlService);
            return dao;
        }
    
        @Bean
        public UserService userService() {
            UserServiceImpl service = new UserServiceImpl();
            service.setUserDao(userDao());
            service.setMailSender(mailSender());
            return service;
        }
    
        @Bean
        public UserService testUserService(){
            UserServiceImpl.TestUserService testService =
                    new UserServiceImpl.TestUserService();
            testService.setUserDao(userDao());
            testService.setMailSender(mailSender());
            return testService;
        }
    
        @Bean
        public MailSender mailSender(){
            return new DummyMailSender();
        }
    
        @Bean
        public SqlService sqlService(){
            OxmSqlService sqlService = new OxmSqlService();
            sqlService.setUnmarshaller(unmarshaller());
            sqlService.setSqlRegistry(sqlRegistry());
            return sqlService;
        }
    
        @Bean
        public SqlRegistry sqlRegistry(){
            EmbeddedDbSqlRegistry sqlRegistry = new EmbeddedDbSqlRegistry();
            sqlRegistry.setDataSource(embeddedDatabase());
            return sqlRegistry;
        }
    
        @Bean
        public Unmarshaller unmarshaller(){
            Jaxb2Marshaller marshaller = new Jaxb2Marshaller();
            marshaller.setContextPath("com.ksb.spring.jaxb");
            return marshaller;
        }
    
        @Bean
        public DataSource embeddedDatabase(){
            return new EmbeddedDatabaseBuilder()
                    .setName("embeddedDatabase")
                    .setType(HSQL)
                    .addScript("schema.sql")
                    .build();
        }
    
    }
    ```