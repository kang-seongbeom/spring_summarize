# 7.2 ì¸í„°í˜ì´ìŠ¤ì˜ ë¶„ë¦¬ì™€ ìê¸°ì°¸ì¡° ë¹ˆ

7.2.1 JAXB(Java Architecture for XML Binding)

- XMLì— ë‹´ê¸´ ì •ë³´ë¥¼ íŒŒì¼ì— ì½ì–´ì˜¤ëŠ” ë°©ë²• ì¤‘ í•˜ë‚˜
- JAXBëŠ” DOMê³¼ ê³¼ ê°™ì€ ì „í†µì ì¸ XML APIì™€ ë¹„êµí–ˆì„ ë•Œ, XML ë¬¸ì„œì •ë³´ë¥¼ ê±°ì˜ ë™ì¼í•œ êµ¬ì¡°ì˜ ì˜¤ë¸Œì íŠ¸ë¡œ ì§ì ‘ ë§¤ì¹­í•´ì¤Œ
- DOMì€ XML ì •ë³´ë¥¼ ë§ˆì¹˜ ìë°”ì˜ ë¦¬í”Œë ‰ì…˜ APIë¥¼ ì‚¬ìš©í•´ ì¡°ì‘ í•˜ëŠ”ê²ƒ ì²˜ëŸ¼ **ê°„ì ‘ì **ìœ¼ë¡œ ì ‘ê·¼í•´ì•¼ í•¨
- JAXBëŠ” XMLì˜ ì •ë³´ë¥´ ê·¸ëŒ€ë¡œ ë‹´ê³  ìˆëŠ”ì˜¤ë¸Œì íŠ¸ íŠ¸ë¦¬ë¥¼ ë§Œë“¤ì–´ì£¼ê¸° ë•Œë¬¸ì—, XML ì •ë³´ë¥¼ ì˜¤ë¸Œì íŠ¸ ì²˜ëŸ¼ **ì§ì ‘ì **ìœ¼ë¡œ ë‹¤ë£° ìˆ˜ ìˆì–´ í¸ë¦¬í•¨
- JAXBëŠ” XML ë¬¸ì„œì˜ êµ¬ì¡°ë¥¼ ì •ì˜í•œ ìŠ¤í‚¤ë§ˆë¥¼ ì´ìš©í•´ì„œ ë§¤í•‘í•  ì˜¤ë¸Œì íŠ¸ì˜ í´ë˜ìŠ¤ë¥¼ ìë™ìœ¼ë¡œ ë§Œë“¤ì–´ì£¼ëŠ” **ì»´íŒŒì¼ëŸ¬**ë„ ì œê³µí•¨
- **ìŠ¤í‚¤ë§ˆ ì»´íŒŒì¼ëŸ¬**ë¥¼ í†µí•´ ìë™ìƒì„± ëœ ì˜¤ë¸Œì íŠ¸ì—ëŠ” ë§¤í•‘ì •ë³´ê°€ **ì• ë…¸í…Œì´ì…˜**ìœ¼ë¡œ ë‹´ê²¨ ìˆìŒ
- JAXB APIëŠ” ì• ë…¸í…Œì´ì…˜ì— ë‹´ê¸´ ì •ë³´ë¥¼ ì´ìš©í•´ XMLê³¼ ë§¤í•‘ê´¸ ì˜¤ë¸Œì íŠ¸ íŠ¸ë¦¬ ì‚¬ì´ì˜ ìë™ë³€í™˜ ì‘ì—…ì„ ìˆ˜í–‰í•¨

![https://dhsim86.github.io/static/assets/img/blog/web/2017-10-10-toby_spring_07_core_apply/00.png](https://dhsim86.github.io/static/assets/img/blog/web/2017-10-10-toby_spring_07_core_apply/00.png)

7.2.2 SQL ë§µì„ ìœ„í•œ ìŠ¤í‚¤ë§ˆ ì‘ì„±ê³¼ ì»´íŒŒì¼

- <sqlmap>, <sql> êµ¬ì¡°ë¥¼ ì •ì˜í•˜ëŠ” ìŠ¤í‚¤ë§ˆ ìƒì„±
- ìŠ¤í‚¤ë§ˆ ì´ë¦„ì€ sqlmap.xsd

```groovy
// https://mvnrepository.com/artifact/javax.xml.bind/jaxb-api
implementation group: 'javax.xml.bind', name: 'jaxb-api', version: '2.3.1'
```

```xml
<?xml version="1.0" encoding="UTF-8" ?>
<schema xmlns="http://www.w3.org/2001/XMLSchema"
        targetNamespace="http://www.epril.com/sqlmap"
        xmlns:tns="http://www.epril.com/sqlmap" elementFormDefault="qualified">

    <element name="sqlmap">
        <complexType>
            <sequence>
                <!--unbounded : í•„ìš”í•œ ê°œìˆ˜ë§Œí¼ <sql>ì„ í¬í•¨í•  ìˆ˜ ìˆê²Œ í•¨-->
                <element name="sql" maxOccurs="unbounded" type="tns:sqlType"/>
            </sequence>
        </complexType>
    </element>
    
    <!--<sql>ì— ëŒ€í•œ ì •ì˜ ì‹œì‘-->
    <complexType name="sqlType">
        <simpleContent>
            <!--SQL ë¬¸ì¥ì„ ë„£ì„ ìŠ¤íŠ¸ë§ íƒ€ì… ì§€ì •-->
            <extension base="string">
                <!--ê²€ìƒ‰ì„ ìœ„í•œ í‚¤ ê°’ì€ <sql>ì˜ key ì• íŠ¸ë¦¬ë·°íŠ¸ì— ë„£ìŒ. í•„ìˆ˜ê°’ì„-->
                <attribute name="key" use="required" type="string"/>
            </extension>
        </simpleContent>
    </complexType>
    
</schema>
```

- **ì…¸** ë˜ëŠ” **ë„ìŠ¤** ì°½ì—ì„œ í”„ë¡œì íŠ¸ ë£¨íŠ¸ í´ë”ë¡œ ì´ë™í•œ ë’¤ ë‹¤ìŒ ëª…ë ¹ì–´ ì‚¬ìš©í•´ ì»´íŒŒì¼

```bash
xjc -p {íŒ¨í‚¤ì§€ì´ë¦„} {ë³€í™˜í•  ìŠ¤í‚¤ë§ˆ íŒŒì¼} -d {ìƒì„±ëœ íŒŒì¼ì´ ì €ì¥ë  ìœ„ì¹˜}

xjc -p com.ksb.spring.jaxb sqlmap.xsd -d src
```

<aside>
ğŸ’¡ í˜„ì¬ ëª…ë ¹ì–´ ì‹¤í–‰ ë¶ˆê°€!!

</aside>

7.2.3 ì±… ë‚´ìš©ì˜ ë¬¸ì œì  ë° ëŒ€ì•ˆë°©ë²•

- í† ë¹„ì˜ ìŠ¤í”„ë§ ì±…ì´ ë°œê°„ëœì§€ ì˜¤ë˜ëìŒ ë•Œë¬¸ì— ë ˆê±°ì‹œ ë¬¸ì œê°€ ìˆìŒ
- ë˜í•œ, ê³¼ê±°ì—ëŠ” ì§€ì› í–ˆìœ¼ë‚˜ í˜„ì¬ëŠ” ì§€ì›í•˜ì§€ ì•ŠëŠ” ê¸°ëŠ¥ë“¤ì´ ì¡´ì¬í•¨
- JAXBê°€ ëŒ€í‘œì ì¸ ì˜ˆì‹œì„
- ê¸°ì¡´ JDKì— ì¡´ì¬í•˜ëŠ” JABX ìŠ¤í‚¤ë§ˆ ì»´íŒŒì¼ëŸ¬ê°€ JDK 11ë¶€í„° ì‚¬ë¼ì¡ŒìŒ
- ë•Œë¬¸ì—, ì±…ì—ì„œ ë‚˜ì˜¨ ëª…ë ¹ì–´ë¥¼ í†µí•œ [JABX ì»´íŒŒì¼ëŸ¬ ì‹¤í–‰](https://han-jinkyu.tistory.com/14)ì€ ë”°ë¡œ JAXB ìŠ¤í‚¤ë§ˆ ì»´íŒŒì¼ëŸ¬ë¥¼ ë°›ì•„ ì‹¤í–‰ì‹œí‚¤ì§€ ì•ŠëŠ” ì´ìƒ ë¶ˆê°€ëŠ¥í•¨
    
    <aside>
    ğŸ’¡ ë³„ë„ë¡œ JAXB ìŠ¤í‚¤ë§ˆ ì»´íŒŒì¼ëŸ¬ë¥¼ ë°›ì•„ì„œ ì‹œë„ í•´ ë´¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŒ
    
    </aside>
    
- [ëŒ€ì•ˆë°©ë²•](https://www.jetbrains.com/help/idea/generating-java-code-from-xml-schema.html)ì€ ì¡´ì¬í•¨(IntellJ Ultimate ì‚¬ìš©ìë§Œ ê°€ëŠ¥!)
    1. ë³€í™˜í•˜ê³ ì í•˜ëŠ” xsd íŒŒì¼ë¡œ ì´ë™
    2. IntelliJì—ì„œ Ctrl+ALT+A ë¥¼ ë™ì‹œì— ëˆ„ë¥´ê¸°
    3. JAXB ê²€ìƒ‰
    4. Generate Java Code From XML Schema Using XMLBeans ì„ íƒ
    5. ì›í•˜ëŠ” í•­ëª© ì±„ì›Œë„£ê³  ì—”í„° ëˆ„ë¥´ë©´ íŒŒì¼ì´ ìƒê¹€
- sqlmap.xsdì—ì„œ ì‹¤í–‰ì‹œ Sqlmap, SqlType í´ë˜ìŠ¤ ìƒì„±

```java
//ë³€í™˜ ì‘ì—…ì—ì„œ ì°¸ê³ í•  ì •ë³´ë¥¼ ì• ë…¸í…Œì´ì…˜ìœ¼ë¡œ ê°–ê³ ìˆìŒ
@XmlAccessorType(XmlAccessType.FIELD)
@XmlType(name = "", propOrder = {
    "sql"
})
@XmlRootElement(name = "sqlmap", namespace = "http://www.epril.com/sqlmap")
public class Sqlmap {
    @XmlElement(namespace = "http://www.epril.com/sqlmap", required = true)
    protected List<SqlType> sql
    public List<SqlType> getSql() {
        if (sql == null) {
            sql = new ArrayList<SqlType>();
        }
        return this.sql;
    }

}

@XmlAccessorType(XmlAccessType.FIELD)
@XmlType(name = "sqlType", namespace = "http://www.epril.com/sqlmap", propOrder = {
    "value"
})
public class SqlType { // <sql> íƒœê·¸ í•œ ê°œë‹¹ SqlType ì˜¤ë¸Œì íŠ¸ í•˜ë‚˜ ì”© ìƒì„±
    @XmlValue
    protected String value; //SQL ê°’ì„ ì €ì¥í•  ìŠ¤íŠ¸ë§ íƒ€ì… í•„ë“œ
    @XmlAttribute(name = "key", required = true)
    protected String key; //ê²€ìƒ‰ìš© í‚¤ ê°’
    public String getValue() {
        return value;
    }
    public void setValue(String value) {
        this.value = value;
    }
    public String getKey() {
        return key;
    }
    public void setKey(String value) {
        this.key = value;
    }
}
```

7.2.4 ì–¸ë§ˆìƒ¬ë§ ë° í•™ìŠµ í…ŒìŠ¤íŠ¸

- XML ë¬¸ì„œë¥¼ ì½ì–´ì„œ ìë°”ì˜ ì˜¤ë¸Œì íŠ¸ë¡œ ë³€í™˜í•˜ëŠ” ì‘ì—…ì„ JAXBì—ì„œëŠ” **ì–¸ë§ˆìƒ¬ë§(Unmarshalling)**ì´ë¼ í•¨
- ì´ì™€ ëŒ€ì¡°ì ìœ¼ë¡œ, ë°”ì¸ë”© ì˜¤ë¸Œì íŠ¸ë¥¼ XML ë¬¸ì„œë¡œ ë³€í™˜í•˜ëŠ” ê²ƒì„ **ë§ˆìƒ¬ë§(Marshalling)**ì´ë¼ í•¨
- JABX APIë¥¼ ì´ìš©í•´ ì–¸ë§ˆìƒ¬ë§ì´ ë˜ëŠ”ì§€ í…ŒìŠ¤íŠ¸ í•  ê²ƒì„
- í…ŒìŠ¤íŠ¸ìš© SQL ë§µ XML ë¬¸ì„œ ì´ë¦„ sqlmap.xml

```xml
<?xml version="1.0" encoding="UTF-8" ?>
<sqlmap xmlns="http://www.epril.com/sqlmap"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="http://www.epril.com/sqlmap  ./sqlmap.xsd">
    <sql key="add">insert</sql>
    <sql key="get">select</sql>
    <sql key="delete">delete</sql>
</sqlmap>
```

```java
import com.ksb.spring.jaxb.SqlType;
import com.ksb.spring.jaxb.Sqlmap;
...

public class JaxbTest {
    @Test
    public void readSqlmap() throws JAXBException, IOException {
        //ë°”ì¸ë”©ìš© í´ë˜ìŠ¤ë“¤ ìœ„ì¹˜ë¥¼ ê°€ì§€ê³  JAXB ì»¨í…ìŠ¤íŠ¸ë¥¼ ë§Œë“¦
        String contextPath = Sqlmap.class.getPackage().getName();
        JAXBContext context = JAXBContext.newInstance(contextPath);
        
        //ì–¸ë§ˆìƒ¬ëŸ¬ ìƒì„±. xml -> ìë°” ì˜¤ë¸Œì íŠ¸
        Unmarshaller unmarshaller = context.createUnmarshaller();

        //ì–¸ë§ˆìƒ¬ì„ í•˜ë©´ ë§¤í•‘ëœ ì˜¤ë¸Œì íŠ¸ íŠ¸ë¦¬ì˜ ë£¨íŠ¸ì¸ Sqlmapì„ ë°˜í™˜
        Sqlmap sqlmap = (Sqlmap) unmarshaller.unmarshal(
                getClass().getResourceAsStream("sqlmap.xml")
        );

        //Listì— ë‹´ê²¨ ìˆëŠ” Sql ì˜¤ë¸Œì íŠ¸ë¥¼ ê°€ì ¸ì™€ XML ë¬¸ì„œì™€ ê°™ì€ ì •ë³´ë¥¼ ê°–ëŠ”ì§€ í™•ì¸
        List<SqlType> sqlList = sqlmap.getSql();

        assertThat(sqlList.size() ,is(3));
        assertThat(sqlList.get(0).getKey(), is("add"));
        assertThat(sqlList.get(0).getValue(), is("insert"));
        assertThat(sqlList.get(1).getKey(), is("get"));
        assertThat(sqlList.get(1).getValue(), is("select"));
        assertThat(sqlList.get(2).getKey(), is("delete"));
        assertThat(sqlList.get(2).getValue(), is("delete"));
    }
}
```

7.2.5 SQL ë§µ XML íŒŒì¼

- UserDaoJdbcì— ì‚¬ìš©í•  SQLì´ ë‹´ê¸´ XML ë¬¸ì„œ ìƒì„± í•  ê²ƒì„
- ìŠ¤í”„ë§ ì„¤ì •ì˜ <map>, <entry>ì— ë‹´ì•„ë’€ì„ ë•Œ ë³´ë‹¤ ì˜ë¯¸ê°€ ëª…í™•í•¨
- SQLì€ DAOì˜ ë¡œì§ ì¼ë¶€ì´ê¸° ë•Œë¬¸ì— ê°™ì€ íŒ¨í‚¤ì§€ì— ë‘ëŠ”ê²ƒì´ ì¢‹ìŒ
- ìœ„ì—ì„œ ë§Œë“  sqlmap.xmlì„ ìˆ˜ì •

```xml
<?xml version="1.0" encoding="UTF-8" ?>
<sqlmap xmlns="http://www.epril.com/sqlmap"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="http://www.epril.com/sqlmap  ./sqlmap.xsd">
    <sql key="userAdd">insert into users(id, name, password, level, login, recommend) value (?,?,?,?,?,?)</sql>
    <sql key="userGet">select * from users where id = ?</sql>
    <sql key="userGetAll">select * from users order by id</sql>
    <sql key="userDeleteAll">delete from users</sql>
    <sql key="userGetCount">select count(*) from users</sql>
    <sql key="userUpdate">update users set name=?, password=?, level=?, login=?, recommend=? where id=?</sql>
</sqlmap>
```

7.2.6 XML SQL ì„œë¹„ìŠ¤

- sqlmap.xmlì— ìˆëŠ” SQLì„ ê°€ì ¸ì™€ DAOì— ì œê³µí•˜ëŠ” SqlService ì¸í„°í˜ì´ìŠ¤ì˜ êµ¬í˜„ í´ë˜ìŠ¤ë¥¼ ë§Œë“¤ ê²ƒì„
- ì–¸ì œ JAXBë¥¼ ì´ìš©í•´ XML ë¬¸ì„œë¥¼ ê°€ì ¸ì˜¬ì§€ ìƒê°í•´ë´ì•¼ í•¨
- DAOê°€ SQL ìš”ì²­ í•  ë•Œë§ˆë‹¤ ë§¤ë²ˆ XML íŒŒì¼ì„ ì½ëŠ” ê²ƒì€ ë¹„íš¨ìœ¨ì ì„
- íŠ¹ë³„í•œ ì´ìœ ê°€ ì—†ëŠ” í•œ, XML íŒŒì¼ì€ í•œ ë²ˆë§Œ ì½ë„ë¡ í•´ì•¼ í•¨
- XML íŒŒì¼ë¡œ ë¶€í„° ì½ì€ ë‚´ìš©ì€ ì–´ë”˜ê°€ì— ì €ì¥í•´ë‘ê³  DAOì— ìš”ì²­ì´ ì˜¬ ë•Œ ì‚¬ìš©ë˜ì•¼ í•¨
- ì²˜ìŒ SQLì„ì½ëŠ” ê±´ ì–´ë””ì„œ í•´ì•¼ í•˜ëŠ”ì§€ì— ëŒ€í•´ì„œë„ ê³ ë¯¼í•´ì•¼ í•¨
- SqlServiceë¥¼ êµ¬í˜„í•œ í´ë˜ìŠ¤ëŠ” ë¹ˆì— ë“±ë¡ì´ ë  ê²ƒì´ê³ , ì–¸ì œ ì–´ë–»ê²Œ ë¹ˆ ì˜¤ë¸Œì íŠ¸ë¥¼ ìƒì„±í•  ì§€ ì•Œ ìˆ˜ ì—†ìœ¼ë‹ˆ ì¼ë‹¨ ìƒì„±ìì—ì„œ SQLì„ ì¼ê±°ì™€ ë‚´ë¶€ì— ì €ì¥í•˜ëŠ” ì´ˆê¸° ì‘ì—…ì„ í•  ê²ƒì„
- ì´í›„ì— ë¦¬íŒ©í† ë§ í•˜ë©´ì„œ ì½”ë“œë¥¼ ê°œì„ í•  ê²ƒìŒ
- JAXBë¡œ XML ë¬¸ì„œë¥¼ ì–¸ë§ˆìƒ¬ë§í•˜ë©´ SQL ë¬¸ì¥ í•˜ë‚˜ëŠ” Sql í´ë˜ìŠ¤ ì˜¤ë¸Œì íŠ¸ì— í•˜ë‚˜ì”© ë‹´ê¸¸ ê²ƒì„
- Map íƒ€ì… ì˜¤ë¸Œì íŠ¸ì— ì €ì¥ í•˜ëŠ”ê²ƒì´ ì¢‹ìŒ
- UserDaoTestë¥¼ í†µí•´ í…ŒìŠ¤íŠ¸ ì„±ê³µ

```java
public class XmlSqlService implements SqlService{
    private Map<String, String> sqlMap = new HashMap<>();

    public XmlSqlService(){
        String contextPath = Sqlmap.class.getPackage().getName();

        try{
            //JAXB APIë¥¼ ì´ìš©í•´ XML ë¬¸ì„œë¥¼ ì˜¤ë¸Œì íŠ¸ íŠ¸ë¦¬ë¡œ ì½ì–´ì˜´
            JAXBContext context = JAXBContext.newInstance(contextPath);
            Unmarshaller unmarshaller = context.createUnmarshaller();
            //SqlTypeì™€ ê°™ì€ í´ë˜ìŠ¤ íŒ¨ìŠ¤ì˜ sqlmap.xml íŒŒì¼ ë³€í™˜
            /*
              í”„ë¡œì íŠ¸ ìœ„ì¹˜ì— ìŠ¬ë˜ì‹œ(/) ê¼­ ë„£ì–´ ì¤˜ì•¼ í•¨.
              ì´ê±° ë•Œë¬¸ì— 5ì¼ê°„ ê°œê³ ìƒ;;
            */
            InputStream is = getClass().getResourceAsStream("/sqlmap.xml");
            Sqlmap sqlmap = (Sqlmap) unmarshaller.unmarshal(is);

            //ì½ì–´ì˜¨ SQLì„ ë§µìœ¼ë¡œ ì €ì¥
            for(SqlType sql : sqlmap.getSql())
                sqlMap.put(sql.getKey(), sql.getValue());

        } catch (JAXBException e){
            throw new RuntimeException(e);
        }
    }

    @Override
    public String getSql(String key) throws SqlRetrievalFailException {
        String sql = sqlMap.get(key);
        if(sql == null)
            throw new SqlRetrievalFailException(key+"ì— ëŒ€í•œ SQLì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
        else
            return sql;
    }
}
```

```java
<beans
		...
>
		<bean id="sqlService" class="com.ksb.spring.XmlSqlService">
    </bean>
</beans>
```

7.2.7 ë¹ˆì˜ ì´ˆê¸°í™” ì‘ì—…

- ìƒì„±ìì—ì„œ ì˜ˆì™¸ê°€ ë°œìƒí•  ìˆ˜ ìˆëŠ” ë³µì¡í•œ ì´ˆê¸°í™” ì‘ì—…ì„ ë‹¤ë£¨ëŠ” ê²ƒì€ ì¢‹ì§€ ì•ŠìŒ
- ë˜í•œ, ì½ì–´ë“¤ì¼ íŒŒì¼ì˜ ìœ„ì¹˜ì™€ ì´ë¦„ì´ ì½”ë“œì— ê³ ì •ë˜ëŠ” ê²ƒì€ ì¢‹ì§€ ì•ŠìŒ
- íŒŒì¼ ìœ„ì¹˜ë¥¼ DI ë°›ê²Œ ìˆ˜ì •
    
    ```java
    public class XmlSqlService implements SqlService{
        ...
        private String sampleFile;
        
        public void setSampleFile(String sampleFile){
            this.sampleFile = sampleFile;
        }
    
        public void XmlSqlService(){
            ...
    
            try{
                ...
                InputStream is = UserDao.class.getResourceAsStream(sampleFile);
                ...
            } catch (JAXBException e){
                throw new RuntimeException(e);
            }
        }
    		...
    }
    ```
    
    ```xml
    	<bean id="sqlService" class="com.ksb.spring.XmlSqlService">
        <property name="sampleFile" value="/sqlmap.xml"/>
    </bean>
    ```
    
- ìƒì„±ìê°€ ì•„ë‹Œ ì¼ë°˜ ë©”ì†Œë“œì—ì„œ ë³µì¡í•œ ì´ˆê¸°í™” ì‘ì—…ì„ í•  ìˆ˜ ìˆë„ë¡ í•˜ëŠ” ìŠ¤í”„ë§ì˜ **ë¹ˆ í›„ì²˜ë¦¬ê¸°**ê°€ ì¡´ì¬í•¨
- íŠ¹ì • ì• ë…¸í…Œì´ì…˜ë“¤ì„ ì§€ì›í•˜ëŠ” ë¹ˆ í›„ì²˜ë¦¬ê¸°ë¥¼ ì‚¬ìš©í•  ê²ƒì„
- í•´ë‹¹ ë¹ˆ í›„ì²˜ë¦¬ê¸°ë¥¼ ì‚¬ìš©í•˜ê¸° ìœ„í•´ì„œëŠ” xmlì— <context:annotation-config>ë¥¼ ì¶”ê°€í•´ì•¼ í•¨
    
    ```xml
    <beans
    			 ...
    			 xmlns:context="http://www.springframework.org/schema/context"
           xsi:schemaLocation="...
                                http://www.springframework.org/schema/context 
                                http://www.springframework.org/schema/context/spring-context-3.0.xsd">
    
    			<!--@Transactionalì´ ë¶™ì€ íƒ€ì…ê³¼ ë©”ì†Œë“œì— íŠ¸ëœì­ì…˜ ì¶”ê°€ í›„ì²˜ë¦¬ê¸° ë“±ë¡-->
    			<tx:annotation-driven/>
    
    			<!--íŠ¹ì • ì• ë…¸í…Œì´ì…˜ì„ ì‚¬ìš©í•´ ë¹ˆ ì„¤ì • ë˜ëŠ” ì´ˆê¸°í™” ì‘ì—…ì„ í•˜ëŠ ë¹ˆ í›„ì²˜ë¦¬ê¸° ë“±ë¡-->
    			<context:annotation-config/>
    </beans>
    ```
    
- ìƒì„±ìë¥¼ ì¼ë°˜ ë©”ì†Œë“œì¸ loadSql()ë¡œ ë³€ê²½í•œ ë’¤ì—, @PostConstruct ì¶”ê°€
    
    ```java
    public class XmlSqlService implements SqlService{
    		...
        @PostConstruct
        public void loadSql(){
    		...
    }
    ```
    
- @PostConstructê°€ ë¶™ì€ ë©”ì†Œë“œëŠ” ë¹ˆ ì˜¤ë¸Œì íŠ¸ê°€ ìƒì„±ë˜ê³  DI ì‘ì—…ì´ ë‹¤ ëë‚œ ë’¤ì— í˜¸ì¶œë¨
    
    ![https://gunju-ko.github.io//assets/img/posts/toby-spring/PostConstruct.png](https://gunju-ko.github.io//assets/img/posts/toby-spring/PostConstruct.png)
    

7.2.8 ì±…ì„ì— ë”°ë¥¸ ì¸í„°í˜ì´ìŠ¤ ì •ì˜

- í˜„ì¬ `XmlSqlService`ëŠ” íŠ¹ì • í¬ë§·ì˜ XMLì—ì„œ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ê³ , ì´ë¥¼ `HashMap` íƒ€ì…ì˜ ë§µ ì˜¤ë¸Œì íŠ¸ì— ì €ì¥í•¨
- JAXBë¥¼ ì´ìš©í•œ XMLì´ ì•„ë‹Œ, **ë‹¤ë¥¸ í¬ë§·**ì—ì„œ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ë ¤ë©´ ì½”ë“œë¥¼ ì™„ì „íˆ ìˆ˜ì •í•´ì•¼ í•¨
- ê´€ì‹¬ì‚¬ì˜ ë¶„ë¦¬ë¥¼ í†µí•´ ìœ ì—°í•˜ê²Œ í™•ì¥í•˜ë„ë¡ í•  ê²ƒì„
- ë‘ ê°€ì§€ ì±…ì„ìœ¼ë¡œ ë¶„ë¦¬í•  ìˆ˜ ìˆìŒ
    1. SQL ì •ë³´ë¥¼ ì™¸ë¶€ì˜ ë¦¬ì†ŒìŠ¤ë¡œë¶€í„° ë°ì´í„° ì „ì²´ë¥¼ ì½ì–´ì˜¤ëŠ” ê²ƒ - `SqlReader`
    2. ì½ì–´ì˜¨ SQLì„ ë³´ê´€(`HashMap`)í•´ë‘ê³  ìˆë‹¤ê°€ í•„ìš”í•  ë•Œ ì œê³µ - `SqlRegister`ì˜ getSql()
        
        <aside>
        ğŸ’¡ ì‚¬ìš©ì¤‘ì¸  SQLì„ í•„ìš”ì— ë”°ë¼ ìˆ˜ì •í•  ìˆ˜ ìˆëŠ” ë¶€ê°€ì  ì±…ì„ë„ ìƒê°í•  ìˆ˜ ìˆìŒ
        
        </aside>
        
- ë‘ ê°€ì§€ ì±…ì„ì„ ë¶„ë¦¬í•´ì„œ ë™ì‘í•˜ë„ë¡ **ì „ëµ íŒ¨í„´**ì„ ì´ìš©í•  ìˆ˜ ìˆìŒ
- DAO ê´€ì ì—ì„œëŠ” `SqlService`ë¼ëŠ” ì¸í„°í˜ì´ìŠ¤ë¥¼ êµ¬í˜„í•œ ì˜¤ë¸Œì íŠ¸ì—ë§Œ ì˜ì¡´í•˜ëŠ” ê²ƒì´ë¯€ë¡œ ë‹¬ë¼ì§ˆê²Œ ì—†ìŒ
- í•˜ì§€ë§Œ, `SqlService`ì˜ **êµ¬í˜„ í´ë˜ìŠ¤**ê°€ ë³€ê²½ ê°€ëŠ¥í•œ ì±…ì„ì„ ê°€ì§„ `SqlReader`ì™€ `SqlRegister` **ë‘ ê°€ì§€** íƒ€ì…ì˜ ì˜¤ë¸Œì íŠ¸ë¥¼ **ì‚¬ìš©**í•˜ë„ë¡ í•¨
- `SqlReader`ì™€ `SqlRegister`ì€ **ì „ëµ íŒ¨í„´**ìœ¼ë¡œ DIë¥¼ í†µí•´ ì˜ì¡´ ì˜¤ë¸Œì íŠ¸ë¥¼ ì œê³µë°›ë„ë¡ í•¨
- ì¶”ê°€ì ìœ¼ë¡œ, SqlRegisterì˜ ì¼ë¶€ ì¸í„°í˜ì´ìŠ¤ëŠ” `SqlService`ê°€ ì•„ë‹Œ ë‹¤ë¥¸ ì˜¤ë¸Œì íŠ¸(`SqlUpdater`)ê°€ ì‚¬ìš©í•  ìˆ˜ ìˆìŒ
    
    <aside>
    ğŸ’¡ ëŒ€í‘œì ìœ¼ë¡œ, SQLì„ í•„ìš”ì— ë”°ë¼ SQLì„ ìˆ˜ì •í•˜ì—¬ SQLì˜ ë°ì´í„°ë¥¼ ë°”ê¿” ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ì¬ì‹œì‘í•˜ì§€ ì•Šê³  SQLì„ ê¸´ê¸‰íˆ ë³€ê²½í•  ìˆ˜ ìˆê²Œ í•¨
    
    </aside>
    
    ![https://gunju-ko.github.io//assets/img/posts/toby-spring/SqlService.png](https://gunju-ko.github.io//assets/img/posts/toby-spring/SqlService.png)
    
- `SqlReader`ê°€ ì½ì–´ì˜¤ê³ , í•´ë‹¹ ì½ì–´ì˜¨ ë°ì´í„°ë¥¼ `SqlRegister`ì— ì €ì¥í•´ì„œ ì‚¬ìš©í•˜ëŠ” êµ¬ì¡°ì„
- ì •í™•íˆ `SqlReader`ì—ì„œ ì½ì–´ì˜¨ ë°ì´í„°ë¥¼ Map íƒ€ì…ì˜ í˜•ì‹ìœ¼ë¡œ ë¦¬í„´í•´ì„œ, `SqlRegister`ë¡œ ì „ë‹¬í•˜ëŠ” êµ¬ì¡°ì„
- ë§Œì•½ `SqlRegister`ê°€ Map íƒ€ì…ì´ ì•„ë‹Œ 2ì°¨ì› ë°°ì—´ êµ¬ì¡°ë¥¼ ì‚¬ìš©í•˜ë©´, Mapì„ 2ì°¨ìš°ë„ˆ ë°°ì—´ êµ¬ì¡°ë¡œ ë³€í™˜í•˜ëŠ” ì‘ì—…ì´ í•„ìš”í•¨
- í•˜ì§€ë§Œ, SqlServiceì˜ êµ¬í˜„ í´ë˜ìŠ¤ê°€ ê¼­ `SqlReader`ë¥¼ ì½ì–´ ë°ì´í„°ë¥¼ `SqlRegister`ë¡œ ì „ë‹¬í•  í•„ìš”ê°€ ì—†ìŒ
- `SqlReader`ì—ê²Œ `SqlRegister` ì „ëµì„ ì œê³µí•˜ì—¬ `SqlRegister`ì— SQL ì •ë³´ë¥¼ ì €ì¥í•˜ë¼ê³  ìš”ì²­í•˜ëŠ” êµ¬ì¡°ê°€ ë”ìš± ì¢‹ìŒ
    
    ![https://gunju-ko.github.io//assets/img/posts/toby-spring/SqlService2.png](https://gunju-ko.github.io//assets/img/posts/toby-spring/SqlService2.png)
    

7.2.9 SqlRegister ì¸í„°í˜ì´ìŠ¤

- SQLì„ **ë“±ë¡**í•˜ê³  **ê²€ìƒ‰**í•˜ëŠ” ë‘ ê°€ì§€ ê¸°ëŠ¥ì„ ë©”ì†Œë“œë¡œ ì •ì˜
- ê²€ìƒ‰ ë„ì¤‘ ì˜ˆì™¸ ë°œìƒì˜ ê²½ìš°, ë³µêµ¬ ê°€ëŠ¥ì„±ì´ ë‚®ê¸° ë•Œë¬¸ì— ëŸ°íƒ€ì„ ì˜ˆì™¸ë¡œ í¬ì¥
- ì—¬ëŸ¬ê°œì˜ ë ˆì§€ìŠ¤íŠ¸ë¦¬ê°€ ìˆì„ ê²½ìš° í•œ ë ˆì§€ìŠ¤íŠ¸ë¦¬ì—ì„œ ê²€ìƒ‰ ë„ì¤‘ ì˜ˆì™¸ ë°œìƒ ì‹œ, ë‹¤ë¥¸ ë ˆì§€ìŠ¤íŠ¸ë¦¬ì— ê²€ìƒ‰ ì‹œë„ë¥¼ í•˜ë©´ ë³µêµ¬ ê°€ëŠ¥ì„±ì´ ë†’ì•„ ì§

```java
public interface SqlRegistry {
    void registrySql(String key, String sql); //sqlì„ ê²€ìƒ‰í•  ìˆ˜ ìˆë„ë¡ keyì™€ í•¨ê»˜ ë“±ë¡
    
    String findSql(String key) throws SqlRetrievalFailException;
}
```

7.2.10 SqlReader ì¸í„°í˜ì´ìŠ¤

- SqlRegistry ì˜¤ë¸Œì íŠ¸ë¥´ ë©”ì†Œë“œ íŒŒë¼ë¯¸í„°ë¡œ DI ë°›ì•„ì„œ ì½ì–´ë“¤ì¸ SQLì„ ë“±ë¡í•˜ë„ë¡ í•´ì•¼ í•¨

```java
public interface SqlReader {
    //ì˜ˆì™¸ ë°œìƒ ì‹œ ëŒ€ë¶€ë¶„ ë³µêµ¬ê°€ ë¶ˆê°€ëŠ¥ í•˜ë¯€ë¡œ êµ³ì´ ì˜ˆì™¸ ì„ ì–¸X
    void read(SqlRegistry sqlRegistry);
}
```

7.2.11 ë‹¤ì¤‘ ì¸í„°í˜ì´ìŠ¤ êµ¬í˜„ê³¼ ê°„ì ‘ ì°¸ì¡°

- SqlServiceì˜ êµ¬í˜„ í´ë˜ìŠ¤ëŠ” SqlReaderì™€ SqlRegister ë‘ ê°œì˜ í”„ë¡œí¼í‹°ë¥¼ DI ë°›ì•„ì•¼ í•¨
    
    ![https://gunju-ko.github.io//assets/img/posts/toby-spring/SqlService3.png](https://gunju-ko.github.io//assets/img/posts/toby-spring/SqlService3.png)
    
- í•œ í´ë˜ìŠ¤ì—ì„œ ì—¬ëŸ¬ ê°œì˜ ì¸í„°í˜ì´ìŠ¤ë¥¼ êµ¬í˜„í•  ìˆ˜ ìˆìŒ
- XmlSqlServiceëŠ” ì¸í„°í˜ì´ìŠ¤ë§Œ êµ¬í˜„í•˜ê¸° ë•Œë¬¸ì— ì„¸ ê°œì˜ ì¸í¼í…Œì´ìŠ¤ë¥¼ í•œ ë²ˆì— êµ¬í˜„í•  ìˆ˜ ìˆìŒ
- êµ¬í˜„í•œ ì¸í„°í˜ì´ìŠ¤ ì„œë¡œ ì±…ì„ì´ ë‹¤ë¦„
- XmlSqlServiceì—ì„œ ì±…ì„ì´ ë‹¤ë¥¸ ì½”ë“œë¥¼ ì§ì ‘ ì ‘ê·¼í•˜ì§€ ì•Šê³ , ì¸í„°í˜ì´ìŠ¤ë¥¼ í†µí•´ ê°„ì ‘ì ìœ¼ë¡œ ì‚¬ìš©í•˜ëŠ” ì½”ë“œë¡œ ë¶„ë¦¬í•  ê²ƒì„

7.2.12 ì¸í„°í˜ì´ìŠ¤ë¥¼ í†µí•œ ë¶„ë¦¬

- XmlSqlServiceëŠ” SqlReaderì™€ SqlRegister ê°ê° êµ¬í˜„í•œ ì˜¤ë¸Œì íŠ¸ë¥¼ DI ë°›ì•„ì•¼ í•¨
- XmlSqlService ì½”ë“œ êµ¬í˜„ ìˆœì„œ
    1. ì˜¤ë¸Œì íŠ¸ DI
        
        ```java
        public class XmlSqlService implements {
            private SqlReader sqlReader;
            private SqlRegistry sqlRegistry;
        
            public void setSqlReader(SqlReader sqlReader) {
                this.sqlReader = sqlReader;
            }
        
            public void setSqlRegistry(SqlRegistry sqlRegistry) {
                this.sqlRegistry = sqlRegistry;
            }
        
            public void setSqlmapFile(String sqlmapFile) {
                this.sqlmapFile = sqlmapFile;
            }
        }
        ```
        
    2. SqlRegistry
        
        ```java
        public class XmlSqlService implements SqlRegistry {
        		//sqlMapì€ SqlRegistry êµ¬í˜„ì˜ ì¼ë¶€ê°€ ë˜ì—ˆìœ¼ë¯€ë¡œ, 
            // ì±…ì„ì´ ë‹¤ë¥¸ ê³³ì—ì„œ ì§ì ‘ ì ‘ê·¼í•˜ë©´ ì•ˆë¨
            private Map<String, String> sqlMap = new HashMap<>();
        		...
        
            @Override
            public void registrySql(String key, String sql) {
                sqlMap.put(key, sql);
            }
        
            @Override
            public String findSql(String key) throws SqlRetrievalFailException {
                String sql = sqlMap.get(key);
                if (sql == null)
                    throw new SqlRetrievalFailException(key + "ì— ëŒ€í•œ SQLì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
                else
                    return sql;
            }
        }
        ```
        
    3. SqlReader
        
        ```java
        public class XmlSqlService implements SqlRegistry, SqlReader {
            private String sqlmapFile;
            public void setSqlmapFile(String sqlmapFile) {
                this.sqlmapFile = sqlmapFile;
            }
        		...
        
            @Override
            public void read(SqlRegistry sqlRegistry) {
                String contextPath = Sqlmap.class.getPackage().getName();
        
                try {
                    JAXBContext context = JAXBContext.newInstance(contextPath);
                    Unmarshaller unmarshaller = context.createUnmarshaller();
                    InputStream is = UserDao.class.getResourceAsStream(sqlmapFile);
                    Sqlmap sqlmap = (Sqlmap) unmarshaller.unmarshal(is);
                    for (SqlType sql : sqlmap.getSql()) {
                        //sqlMap ì§ì ‘í•˜ìš©í•˜ì§€ ì•Šê³ , ê°„ì ‘ì  ì‚¬ìš©
                        sqlRegistry.registrySql(sql.getKey(), sql.getValue());
                    }
        
                } catch (JAXBException e) {
                    throw new RuntimeException(e);
                }
            }
        }
        ```
        
    4. SqlService
        
        ```java
        public class XmlSqlService implements SqlService, SqlRegistry, SqlReader {
        		...
            @PostConstruct
            public void loadSql() {
                this.sqlReader.read(this.sqlRegistry);
            }
        
            @Override
            public String getSql(String key) throws SqlRetrievalFailException {
                try{
                    return this.sqlRegistry.findSql(key);
                }catch (SqlRetrievalFailException e){
                    throw new RuntimeException(e);
                }
            }
        }
        ```
        

7.2.13 ìê¸°ì°¸ì¡° ë¹ˆ ì„¤ì •

- XmlSqlService í´ë˜ìŠ¤ ë‚´ë¶€ì— ì„¸ ê°€ì§€ ì¸í„°í˜ì´ìŠ¤ êµ¬í˜„ì´ ìˆì§€ë§Œ, **ê°„ì ‘ì  ì‚¬ìš©**ì„ í†µí•´ ì„œë¡œ ê¹”ë”í•˜ê²Œ ë¶„ë¦¬ ë˜ì—ˆìŒ
- ê°™ì€ ì½”ë“œì— ìˆì§€ë§Œ, ë¹ˆ ì„¤ì •ì„ í†µí•´ ì‹¤ì œ DIê°€ ë°œìƒí•˜ë„ë¡ í•´ì•¼ í•¨
- ì¦‰, ë§ˆì¹˜ ì„¸ ê°œì˜ ë¹ˆì´ ë“±ë¡ëœ ê²ƒì²˜ëŸ¼ SqlService ë¹ˆì´ SqlRegistryì™€ SqlReaderë¥¼ ì£¼ì…ë°›ë„ë¡ í•´ì•¼ í•¨
- ë¹ˆì€ sqlService í•˜ë‚˜ë§Œ ì„ ì–¸ í–ˆìœ¼ë¯€ë¡œ ì‹¤ì œ ë¹ˆì€ í•˜ë‚˜ë§Œ ë§Œë“¤ì–´ì§
- í•˜ì§€ë§Œ, ref í•­ëª©ì— ìê¸° ìì‹ ì„ ë„£ì–´ ìê¸° ìì‹  ë©”ì†Œë“œì— ì ‘ê·¼í•  ìˆ˜ ìˆê²Œ í•¨
- ì´ ë¹ˆì„ **ìê¸°ì°¸ì¡° ë¹ˆ**ì´ë¼ í•¨
- ì˜ ì‚¬ìš©ë˜ì§€ëŠ” ì•Šì§€ë§Œ, ì±…ì„ê³¼ ê´€ì‹¬ì‚¬ê°€ ë³µì¡í•˜ê²Œ ì–½íŒ êµ¬ì¡°ë¥¼ ìœ ì—°í•œ êµ¬ì¡°ë¡œ ë§Œë“¤ ë•Œ ì²˜ìŒ ì‹œë„í•´ ë³¼ ìˆ˜ ìˆìŒ

```xml
<bean id="sqlService" class="com.ksb.spring.XmlSqlService">
    <property name="sqlmapFile" value="/sqlmap.xml"/>
		<!--ìê¸°ì°¸ì¡° ë¹ˆ-->
    <property name="sqlReader" ref="sqlService"/>
    <property name="sqlRegistry" ref="sqlService"/>
</bean>
```

7.2.14 í™•ì¥ ê°€ëŠ¥í•œ ê¸°ë°˜ í´ë˜ìŠ¤

- SqlRegistryì™€ SqlReaderë¥¼ ì´ìš©í•œ ê°€ì¥ ê°„ë‹¨í•œ SqlService **êµ¬í˜„ í´ë˜ìŠ¤**ë¥¼ ë§Œë“¤ ê²ƒì„
- XmlSqlService ì²˜ëŸ¼ ì„¸ ê°œì˜ ì¸í„°í˜ì´ìŠ¤ë¥¼ í•˜ë‚˜ì˜ í´ë˜ìŠ¤ì—ì„œ êµ¬í˜„í•˜ì§€ ì•Šê³ , ê°ê°ì˜ í´ë˜ìŠ¤ë¡œ ë¶„ë¦¬
- SqlService **êµ¬í˜„ í´ë˜ìŠ¤** ì´ë¦„ì€ BaseSqlService
    
    ```java
    public class BaseSqlService implements SqlService{
    		//ìƒì†ì„ í†µí•œ í™•ì¥ì„ ìœ„í•´ protectedë¡œ ì„ ì–¸
        protected SqlReader sqlReader;
        protected SqlRegistry sqlRegistry;
    
        public void setSqlReader(SqlReader sqlReader) {
            this.sqlReader = sqlReader;
        }
    
        public void setSqlRegistry(SqlRegistry sqlRegistry) {
            this.sqlRegistry = sqlRegistry;
        }
        
        @PostConstruct
        public void loadSql() {
            this.sqlReader.read(this.sqlRegistry);
        }
    
        @Override
        public String getSql(String key) throws SqlRetrievalFailException {
            try{
                return this.sqlRegistry.findSql(key);
            }catch (SqlRetrievalFailException e){
                throw new RuntimeException(e);
            }
        }
    }
    ```
    
- SqlRegister êµ¬í˜„ í´ë˜ìŠ¤
    
    ```java
    public class HashMapSqlRegistry implements SqlRegistry{
        private Map<String, String> sqlMap = new HashMap<>();
    
        @Override
        public void registrySql(String key, String sql) {
            sqlMap.put(key, sql);
        }
    
        @Override
        public String findSql(String key) throws SqlRetrievalFailException {
            String sql = sqlMap.get(key);
            if (sql == null)
                throw new SqlRetrievalFailException(key + "ì— ëŒ€í•œ SQLì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
            else
                return sql;
        }
    }
    ```
    
- SqlReader êµ¬í˜„ í´ë˜ìŠ¤
    
    ```java
    public class JaxbXmlSqlReader implements SqlReader{
        private String sqlmapFile;
    
        public void setSqlmapFile(String sqlmapFile) {
            this.sqlmapFile = sqlmapFile;
        }
    
        @Override
        public void read(SqlRegistry sqlRegistry) {
            String contextPath = Sqlmap.class.getPackage().getName();
    
            try {
                JAXBContext context = JAXBContext.newInstance(contextPath);
                Unmarshaller unmarshaller = context.createUnmarshaller();
                InputStream is = UserDao.class.getResourceAsStream(sqlmapFile);
                Sqlmap sqlmap = (Sqlmap) unmarshaller.unmarshal(is);
                for (SqlType sql : sqlmap.getSql()) {
                    //sqlMap ì§ì ‘í•˜ìš©í•˜ì§€ ì•Šê³ , ê°„ì ‘ì  ì‚¬ìš©
                    sqlRegistry.registrySql(sql.getKey(), sql.getValue());
                }
    
            } catch (JAXBException e) {
                throw new RuntimeException(e);
            }
        }
    }
    ```
    
- ë¹ˆ ì„¤ì •
    
    ```xml
    <beans>
    </bean>
        <bean id="sqlService" class="com.ksb.spring.BaseSqlService">
            <property name="sqlReader" ref="sqlReader"/>
            <property name="sqlRegistry" ref="sqlRegistry"/>
        </bean>
    
        <bean id="sqlReader" class="com.ksb.spring.JaxbXmlSqlReader">
            <property name="sqlmapFile" value="/sqlmap.xml"/>
        </bean>
    
        <bean id="sqlRegistry" class="com.ksb.spring.HashMapSqlRegistry">
        </bean>
    </beans>
    ```
    

7.2.15 ë””í´íŠ¸ ì˜ì¡´ê´€ê³„ë¥¼ ê°–ëŠ” ë¹ˆ ë§Œë“¤ê¸°

- BaseSqlServiceëŠ” SqlReaderì™€ SqlRegistry í”„ë¡œí¼í‹°ì˜ DIë¥¼ ë°›ì•„ ê¸°ëŠ¥ì„ í™•ì¥í•  ìˆ˜ ìˆìŒ
- í•˜ì§€ë§Œ, ì„¸ ê°œì˜ ë¹ˆì„ ë“±ë¡í•´ì•¼ í•˜ëŠ” ë¶ˆí¸í•¨ ì¡´ì¬
- DI ë°›ëŠ” ë¹ˆì˜ í´ë˜ìŠ¤ê°€ ë³€ê²½ë  ê°€ëŠ¥ì„±ì´ ì ì–´ **ë””í´íŠ¸**ë¼ê³  í•´ë„ ì¢‹ì„ ë§Œí¼ ê¸°ë³¸ì ìœ¼ë¡œ ì‚¬ìš©ë  ê°€ëŠ¥ì„±ì´ ìˆë‹¤ë©´, ë””í´íŠ¸ ì˜ì¡´ê´€ê³„ë¥¼ ê°–ëŠ” ë¹ˆì„ ë§Œë“œëŠ” ê²ƒì„ ê³ ë ¤í•  ìˆ˜ ìˆìŒ
- ë””í´íŠ¸ ì˜ì¡´ê´€ê³„ë€, ì™¸ë¶€ì—ì„œ DI ë°›ì§€ ì•ŠëŠ” ê²½ìš° ìë™ ì ìš©ë˜ëŠ” ì˜ì¡´ ê´€ê³„ë¥¼ ëœ»í•¨
    
    ```java
    public class DefaultSqlService extends BaseSqlService{
        public DefaultSqlService(){
            //ìƒì„±ìì—ì„œ ë””í´íŠ¸ ì˜ì¡´ ê´€ê³„ë¥¼ ìˆ˜ë™ DI
            setSqlReader(new JaxbXmlSqlReader());
            setSqlRegistry(new HashMapSqlRegistry());
        }
    }
    ```
    
    ```xml
    <bean id="sqlService" class="com.ksb.spring.DefaultSqlService"/>
    ```
    
- ìœ„ ì½”ë“œì˜ í…ŒìŠ¤íŠ¸ëŠ” ì‹¤íŒ¨í•¨
- ì´ìœ ëŠ”, `sqlmapFile`ì„ ì½ëŠ” íŒŒì¼ ì´ë¦„ì„ ë„£ì„ ìˆ˜ ì—†ê¸° ë•Œë¬¸ì„
- ì´ë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´, ê¸°ë³¸ì ìœ¼ë¡œ ë””í´íŠ¸ íŒŒì¼ ì´ë¦„ì„ ì½”ë“œì—ì„œ í• ë‹¹í•˜ë©´ ë¨
    
    ```java
    public class JaxbXmlSqlReader implements SqlReader{
        private static final String DEFAULT_SQLMAP_FILE = "/sqlmap.xml";
    
        private String sqlmapFile = DEFAULT_SQLMAP_FILE;
    
        public void setSqlmapFile(String sqlmapFile) {
            this.sqlmapFile = sqlmapFile;
        }
    		...
    }
    ```
    
- DefaultSqlServiceëŠ” SqlServiceë¥¼ ë°”ë¡œ êµ¬í˜„í•˜ì§€ ì•Šê³ , BaseSqlServiceì„ ìƒì†í•œ ì´ìœ ê°€ ìˆìŒ
- BaseSqlServiceì€ SqlReaderì™€ SqlRegistry í”„ë¡œí¼í‹°ë¥¼ ê°–ê³  ìˆìŒ
- ë§Œì•½ ë””í´íŠ¸ ëŒ€ì‹ ì— ì‚¬ìš©í•  ë¹ˆì´ ìˆì„ ê²½ìš° ë¹ˆì—ì„œ í”„ë¡œí¼í‹°ë¥¼ ë„£ìœ¼ë©´ ë¨
    
    ```xml
    <bean id="sqlService" class="com.ksb.spring.DefaultSqlService">
    <property name="sqlRegistry" ref="anotherSqlRegistry" />
    <bean>
    ```
    

7.2.16 ë””í´íŠ¸ ì˜ì¡´ ì˜¤ë¸Œì íŠ¸ ì‚¬ìš©

- ë””í´íŠ¸ ì˜ì¡´ ì˜¤ë¸Œì íŠ¸ëŠ”, ì„¤ì •ì„ í†µí•´ ë‹¤ë¥¸ êµ¬í˜„ ì˜¤ë¸Œì íŠ¸ë¥¼ ì‚¬ìš©í•´ë„ ìƒì„±ìì—ì„œ ì¼ë‹¨ ë””í´íŠ¸ ì˜ì¡´ ì˜¤ë¸Œì íŠ¸ë¥¼ **ì „ë¶€** ë§Œë“ ë‹¤ëŠ” **ë‹¨ì **ì´ ìˆìŒ
- ì‚¬ìš©ë˜ì§€ ì•ŠëŠ” ì˜¤ë¸Œì íŠ¸ê°€ ìƒì„±ë  ìˆ˜ ìˆìŒ
- í•˜ì§€ë§Œ, ë””í´íŠ¸ ì˜ì¡´ ì˜¤ë¸Œì íŠ¸ì˜ ì¥ì ì´ í¬ê¸° ë•Œë¬¸ì— ì˜¤ë¸Œì íŠ¸ í•˜ë‚˜ì¯¤ ë” ë§Œë“¤ì–´ì§€ëŠ” ë¶€ë‹´ì€ ë¬´ì‹œí•  ìˆ˜ ìˆìŒ