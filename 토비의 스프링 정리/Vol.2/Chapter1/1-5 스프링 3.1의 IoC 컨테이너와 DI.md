# 1.5 μ¤ν”„λ§ 3.1μ IoC μ»¨ν…μ΄λ„μ™€ DI

1.5.1 λΉμ μΆ…λ¥

- λΉμ€ ν¬κ² **μ„Έ κ°€μ§€**λ΅ κµ¬λ¶„ν•  μ μμ
    1. μ• ν”λ¦¬μΌ€μ΄μ… λ΅μ§ λΉ
        - μΌλ°μ μΌλ΅ μ• ν”λ¦¬μΌ€μ΄μ…μ λ΅μ§μ„ λ‹΄κ³  μλ” μ£Όμ” ν΄λμ¤μ μ¤λΈμ νΈκ°€ λΉμΌλ΅ μ§€μ •λ¨
        - DAO, λΉ„μ¦λ‹μ¤ λ΅μ§, κΈ°λ° μ„λΉ„μ¤, μ›Ή λ΅μ§λ“±μ΄ ν•΄λ‹Ή λ¨
    2. μ• ν”λ¦¬μΌ€μ΄μ… μΈν”„λΌ λΉ
        - μ£Όλ΅ μ• ν”λ¦¬μΌ€μ΄μ… λ΅μ§ λΉκ³Ό **κ΄€κ³„**λ¥Ό λ§Ίκ³  μ‚¬μ©λλ” λΉ
        - μμ‹λ΅ `DataSource`μ™€ `DataSourceTransactionManager`κ°€ μμ
        - `DataSource`μ™€ `DataSourceTransactionManager`λ” μ• ν”λ¦¬μΌ€μ΄μ… λ΅μ§ λΉκ³Ό κ΄€κ³„λ¥Ό λ§Ίμ–΄ μ‚¬μ©λ¨
        - μ»¨ν…μ΄λ„μ— λ“±λ΅λλ” λΉμ΄κΈ΄ ν•λ‚ μ• ν”λ¦¬μΌ€μ΄μ… λ΅μ§ λΉκ³Ό μ„±κ²©μ΄ λ‹¤λ¦„
        - μ• ν”λ¦¬μΌ€μ΄μ…μ λ΅μ§ λΉμ„ μ§€μ›ν•κ³  λ¶€κ°€κΈ°λ¥μ„ μ κ³µν•¨
        - **μ• ν”λ¦¬μΌ€μ΄μ… κΈ°λ° λΉ** λλ” **μ• ν”λ¦¬μΌ€μ΄μ… μΈν”„λΌμ¤νΈλ­μ² λΉ**μ΄λΌ λ¶λ ¤ κ°„λ‹¨ν **μ• ν”λ¦¬μΌ€μ΄μ… μΈν”„λΌ λΉ**μ΄λΌ ν•¨
    3. μ»¨ν…μ΄λ„ μΈν”„λΌ λΉ
        - μ¤ν”„λ§ μ»¨ν…μ΄λ„μ κΈ°λ¥μ— κ΄€μ—¬ν•λ” λΉμ„
        - μ¤ν”„λ§ μ»¨ν…μ΄λ„κ°€ λΉμ„ μƒμ„±ν•  λ• ν”„λ΅μ‹ μƒμ„± κ°™μ€ νΉλ³„ν• μ‘μ—…μ„ ν•λ„λ΅ μ§€μ›ν•¨
        - μ¤ν”„λ§ μ»¨ν…μ΄λ„λ” `BeanPostProcessor`λ‚ `BeanFactoryPostProcessor` κ°™μ€ **ν™•μ¥ ν¬μΈνΈ**λ¥Ό μ κ³µν•¨
        - μ΄λ° μΈν„°νμ΄μ¤λ¥Ό κµ¬ν„ν• ν΄λμ¤κ°€ λΉμΌλ΅ λ“±λ΅ λμ–΄ μμΌλ©΄ **μ¤ν”„λ§ μ»¨ν…μ΄λ„**λ” μ¤μ¤λ΅ **ν™•μ¥**ν•λ” λ° μ΄λ¥Ό μ‚¬μ©ν•¨
        - μ΄λ ‡κ² μ¤ν”„λ§ μ»¨ν…μ΄λ„μ κΈ°λ¥μ„ ν™•μ¥ν•΄μ„ λΉμ λ“±λ΅, μƒμ„±, κ΄€κ³„ μ„¤μ •, μ΄κΈ°ν™” λ“±μ μ‘μ—…μ— μ°Έμ—¬ν•λ” λΉμ„ **μ»¨ν…μ΄λ„ μΈν”„λΌμ¤νΈλ­μ² λΉ**μ΄λΌ ν•¨
        - μ¤„μ—¬μ„ **μ»¨ν…μ΄λ„ μΈν”„λΌ λΉ**μ΄λΌ ν•¨
        

1.5.2 μ»¨ν…μ΄λ„ μΈν”„λΌ λΉκ³Ό μ „μ© νƒκ·Έ

- <bean>μ„ μ΄μ©ν•΄ μ§μ ‘ λΉμ„ λ“±λ΅ν•  μ μμ
- ν•μ§€λ§, μ „μ© νƒκ·Έλ¥Ό μ‚¬μ©ν•λ” λ°©λ²•μ΄ λ” λ§μ΄ μ“°μ„
- μλ™μΈμ‹μ„ μ΄μ©ν• λΉ λ“±λ΅μ„ μ‚¬μ©ν•λ ¤λ©΄ XMLμ μ „μ© νƒκ·ΈμΈ <context:component-scan> νƒκ·Έλ¥Ό λ„£μ–΄μ•Ό ν•¨
- @Configurationμ€ μμ‹ μ΄ λΉμΌλ΅ λ“±λ΅λλ” λ™μ‹μ— @Beanμ΄ λ¶™μ€ λ©”μ†λ“μ λ¦¬ν„΄ μ¤λΈμ νΈλ¥Ό λΉμΌλ΅ λ“±λ΅ν•¨
    
    ```java
    @Configuration
    public class SimpleConfig{
        @Autowired Hello hello;
        @Bean Hello hello() return new Hello();
    }
    
    public class Hello{
        @PostConstruct
        public void init(){
            System.out.println("Init");
        }
        public void satHello() {...}
    }
    ```
    
    ```xml
    <bean class="...SimpleConfig">
    ```
    
- λ”°λΌμ„ `SimpleConfig`κ°€ λΉμΌλ΅ λ“±λ΅λκ³  `Hello` ν΄λμ¤λ„ λΉμΌλ΅ λ“±λ΅λ¨
    
    <aside>
    π’΅ DIλ¥Ό ν•κΈ° μ„ν•΄ Helloλ„ λΉμΌλ΅ λ“±λ΅ν•¨
    
    </aside>
    
- μ¦‰, λ‘ κ°μ λΉμ΄ λ“±λ΅λ  κ²ƒ κ°™μ
- ν•μ§€λ§, `SimpleConfig` ν•λ‚λ§ λ“±λ΅λ¨
- μ¤ν”„λ§μ€ κΈ°λ³Έμ μΌλ΅ @Configuration/@Beanμ„ μ΄μ©ν•΄ μƒλ΅μ΄ λΉμ„ λ“±λ΅ν•λ” κΈ°λ¥μ„ μ κ³µν•μ§€ μ•μ
- μ΄λ¬ν• μ΄μ λ΅ **μ»¨ν„°μ΄λ„**λ¥Ό **ν™•μ¥**ν•λ” **μ»¨ν…μ΄λ„ μΈν”„λΌ λΉ**μ„ μ¶”κ°€ν•΄μ•Ό ν•¨
    
    ```xml
    <context:annotataion-config />
    ```
    
- **μ»¨ν…μ΄λ„ μΈν”„λΌ λΉ**μ„ ν†µν•΄ **νΉμ • λΉ**μ„ **λ“±λ΅**ν•μ—¬, ν•΄λ‹Ή **λΉ**λ“¤μ΄ μ»¨ν…μ΄λ„λ¥Ό ν™•μ¥ν•΄μ„ λΉμ λ“±λ΅, κ΄€κ³„ μ„¤μ •, ν›„μ²λ¦¬ λ“±μ— μƒλ΅μ΄ κΈ°λ¥μ„ λ¶€μ—¬ν•¨
- μ¤ν”„λ§ 3.1μ—μ„ <context:annotataion-config />λ” **μ—¬μ„― κ°**μ λΉμ΄ μ¶”κ°€λ΅ λ“±λ΅λ¨
    1. `ConfigurationClassPostProcessor$ImportAwareBeanProcessor`
    2. `ConfigurationClassPostProcessor`
        - @Configurationκ³Ό @Beanμ„ μ΄μ©ν•΄ μƒλ΅μ΄ λΉμ„ λ“±λ΅ν•λ” μ—­ν• 
    3. `AutowiredAnnotationBeanPostProcessor`
        - @Autowiredκ°€ λ¶™μ€ ν•„λ“λ¥Ό μ°Ύμ•„μ„ λΉ μμ΅΄κ΄€κ³„λ¥Ό μ„¤μ •ν•¨
    4. `RequiredAnnotationBeanPostProcessor`
    5. `PersistenceAnnotationBeanPostProcessor`
    6. `CommonAnnotationBeanProcessor`
        - @PostConstructκ°€ λ¶™μ€ λ©”μ†λ“λ¥Ό λΉμ΄ μ΄κΈ°ν™” λ λ’¤μ— νΈμ¶ν•λ κΈ°λ¥μ„ μ κ³µ ν•¨
- μ»¨ν…μ΄λ„ μΈν”„λΌ λΉμ€ μ¤ν”„λ§ μ»¨ν…μ΄λ„μ κΈ°λ³Έ κΈ°λ¥μ„ ν™•μ¥ν•λ” λ° μ‚¬μ©λκ³ , μ£Όλ΅ μ „μ© νƒκ·Έλ¥Ό ν†µν•΄ κ°„μ ‘μ μΌλ΅ λ“±λ΅λ¨
- μ „μ© νƒκ·Έ μ‚¬μ©μ„ κ¶μ¥ν•κ³ , κµ³μ΄ μ „μ© νƒκ·Έκ°€ μ–΄λ–¤ λΉμ„ λ“±λ΅ν•λ”μ§€ μ• ν•„μ”λ” μ—†μ
- ν•μ§€λ§, κ°€λ”μ€ μ „μ© νƒκ·Έμ— μν•΄ μ–΄λ–¤ λΉμ΄ λ“±λ΅λλ”μ§€ μ‚΄ν΄λ΄μ•Ό ν•¨

1.5.3 λΉμ μ—­ν• 

- μ¤ν”„λ§μ λΉμ„ μ—­ν• μ— λ”°λΌ **μ„Έ κ°€μ§€**λ΅ λ‚λ μ μμ
    1. ROLE_APPLICATION = 0
        - **μ• ν”λ¦¬μΌ€μ΄μ… μΈν”„λΌ λΉ** μ²λΌ μ• ν”λ¦¬μΌ€μ΄μ…μ΄ λ™μ‘ν•λ” μ¤‘μ— μ‚¬μ©λλ” λΉ
    2. ROLE_SUPPORT = 1
        - λ³µμ΅ν• κµ¬μ΅°μ λΉμ„ μ •μν•  λ• λ³΄μ΅°μ μΌλ΅ μ‚¬μ©λλ” λΉ
        - κ±°μ μ‚¬μ©λμ§€ μ•μ
    3. ROLE_INFRASTRUCTUR = 2
        - μ „μ© νƒκ·Έμ— μν•΄ λ“±λ΅λλ” **μ»¨ν…μ΄λ„ μΈν”„λΌ λΉ**
- μ¤ν”„λ§ 3.0κΉμ§€λ” λΉμ μ—­ν•  μ†μ„±μ΄ μ¤ν”„λ§ μ»¨ν…μ΄λ„ λ‚΄λ¶€ κµ¬ν„μ—μ„λ§ μ‚¬μ©λμ
- ν•μ§€λ§ μ¤ν”„λ§ 3.1λ¶€ν„°λ” κ°λ°μκ°€ λΉμ„ μ •μν•  λ• μ΄ **μ—­ν• ** κ°’μ„ **μ§μ ‘ μ§€μ •**ν•  μ μλ„λ΅ @Role μ• λ…Έν…μ΄μ…μ΄ λ„μ…λμ
- λΉμ μ—­ν• κ³Ό μ„±κ²©μ— λ”°λΌ **μ• ν”λ¦¬μΌ€μ΄μ… λΉ**κ³Ό **μ»¨ν…μ΄λ„ μΈν”„λΌ λΉ**μΌλ΅ λ‚λ μ μμ
- λ‹¤μ‹ μ• ν”λ¦¬μΌ€μ΄μ… λΉμ„ κµ¬λ¶„ν•λ©΄ **μ• ν”λ¦¬μΌ€μ΄μ… λ΅μ§ λΉ**κ³Ό **μ• ν”λ¦¬μΌ€μ΄μ… μΈν”„λΌ λΉ**μΌλ΅ λ‚λ μ μμ

1.5.4 IoC/DI μ„¤μ • λ°©λ²•μ λ°μ „

- ν‘
    
    
    | λ²„μ „ | μ• ν”λ¦¬μΌ€μ΄μ… λ΅μ§ λΉ | μ• ν”λ¦¬μΌ€μ΄μ… μΈν”„λΌ λΉ | μ»¨ν…μ΄λ„ μΈν”„λΌ λΉ |
    | --- | --- | --- | --- |
    | μ¤ν”„λ§ 1.x | <bean> | <bean> | <bean> |
    | μ¤ν”„λ§ 2.0 | <bean> | <bean> | μ „μ© νƒκ·Έ |
    | μ¤ν”„λ§ 2.5 | <bean> | <bean> | μ „μ© νƒκ·Έ |
    | μ¤ν”„λ§ 3.0 | <bean>, λΉ μ¤μΊ”, μλ°” μ½”λ“ | <bean>, μλ°” μ½”λ“ | μ „μ© νƒκ·Έ |
    | μ¤ν”„λ§ 4.0 | <bean>, λΉ μ¤μΊ”, μλ°” μ½”λ“ | <bean>, μλ°” μ½”λ“ | μ „μ© νƒκ·Έ, μλ°” μ½”λ“ |

1.5.5 μλ°” μ½”λ“λ¥Ό μ΄μ©ν• μ»¨ν…μ΄λ„ μΈν”„λΌ λΉ λ“±λ΅

- μλ°” μ½”λ“μ—μ„ μ• λ…Έν…μ΄μ…μ΄ ν•λ‚μ νƒκ·Έμ— λ€μ‘λκ³ , μ• λ…Έν…μ΄μ… μ—λ¦¬λ¨ΌνΈκ°€ XML νƒκ·Έμ μ• νΈλ¦¬λ·°νΈλ΅ μ§€μ •ν–λ μµμ… κ°’μ„
- μ»¨ν…μ΄λ„ μΈν”„λΌ λΉμ„ μλ°” μ½”λ“λ΅ λ“±λ΅ν•  μ μλ” λ°©λ²•μ€ ν¬κ² **λ„¤ κ°€μ§€**κ°€ μμ
    1. @ComponentScan
        - <context:component>λ¥Ό μ‚¬μ©ν• κ²ƒμ²λΌ μ¤ν…λ μ¤νƒ€μ… μ• λ…Έν…μ΄μ…μ΄ λ¶™μ€ λΉμ„ μλ™μΌλ΅ μ¤μΊ”ν•΄μ„ λ“±λ΅ν•¨
            
            ```java
            @Configuration
            @ComponentScan("com.ksb.scanner")
            public class AppConfig{...}
            ```
            
        - @ComponentScanμ κΈ°λ³Έ μ—λ¦¬λ¨ΌνΈ κ°’μ€ λΉμ„ μ¤μΊ”ν•  **κΈ°λ°(Base) ν¨ν‚¤μ§€**μ„
        - κΈ°λ° ν¨ν‚¤μ§€ ν•μ„μ νμΌμ„ μ¤μΊ”ν•¨
        - @Component κ°™μ€ μ¤ν…λ μ¤νƒ€μ… μ• λ…Έν…μ΄μ…μ΄ λ¶™μ€ ν΄λμ¤λ¥Ό λ¨λ‘ μ°Ύμ•„μ„ λΉμΌλ΅ λ“±λ΅ν•¨
        - ν¨ν‚¤μ§€ λ€μ‹  **λ§μ»¤(Marker) ν΄λμ¤**λ‚ **μΈν„°νμ΄μ¤**λ¥Ό μ‚¬μ©ν•  μλ„ μμ
            
            ```java
            public interface ServiceMarker{}
            
            @Configuration
            @ComponentScan(basePackageClasses=ServiceMarker.class)
            public class AppConfig{}
            ```
            
        - λ§μ»¤ ν΄λμ¤λ‚ μΈν„°νμ΄μ¤λ¥Ό μ‚¬μ©ν•λ©΄, ν¨ν‚¤μ§€μ™€ λ‹¬λ¦¬ μ¤νƒ€λ΅ λ°μƒν•λ” ν•΄κ²°ν•  μ μμ
        - @Configurationμ—μ„ @ComponentScanμ„ μ΄μ©ν•΄ λΉ μ¤μΊ”μ„ μ§€μ •ν•λ”λ°, μκΈ° μμ‹ μ΄ λ‹¤μ‹ μ¤μΊ”λΌμ„ λ“±λ΅λλ©΄ μ•λ¨
        - κ·Έλμ„ μ΄λ΄ λ• @Configurationμ΄ λ¶™μ€ ν΄λμ¤λ” μ¤μΊ” λ€μƒμ—μ„ μ μ™Έ μ‹μΌμ•Ό ν•¨
        - excludeFilters μ—λ¦¬λ¨ΌνΈμ— @Filter μ• λ…Έν…μ΄μ…μ„ μ‚¬μ©ν•λ©΄ μ¤μΊ” λ€μƒμ„ μ μ™Έν•  μ μμ
            
            ```java
            @Configuration
            @ComponentScan(basePackage="myproject", excludeFilters=@Filter(Configuration.class))
            public class AppConfig{}
            ```
            
        - Filterμ νƒ€μ… μ—λ¦¬λ¨ΌνΈλ¥Ό μ‚¬μ©ν•΄ νΉμ ‡γ…‡ ν΄λμ¤λ¥Ό μ§μ ‘ μ μ™Έ λ€μƒμΌλ΅ λ§λ“¤ μ μμ
            
            ```java
            @Configuration
            @ComponentScan(basePackage="myproject", excludeFilter=
                     @Filter(type=FilterType.ASSIGNABLE_TYPE, value=AppConfig.class))
            public class AppConfig{}
            ```
            
    2. @Import
        - λ‹¤λ¥Έ @Configuration ν΄λμ¤λ¥Ό λΉ λ©”νƒ€μ •λ³΄μ— μ¶”κ°€ν•  λ• μ‚¬μ©ν•¨
            
            ```java
            @Configuration
            @Import(DataConfig.class)
            public class AppConfig{}
            
            @Configuration
            public class DataConfig{}
            ```
            
        - λΉ μ„¤μ • νμΌμ„ μ—¬λ¬ κ°μ νμΌλ΅ λ¶„λ¦¬ν•΄μ„ κ΄€λ¦¬ν•  λ• μ‚¬μ© λ¨
        - @Importλ” @Enableλ΅ μ‹μ‘ν•λ”, μ»¨ν…μ΄λ„ μΈν”„λΌ λΉμ„ μ„ν• μ „μ© μ• λ…Έν…μ΄μ…μ„ λ§λ“¤ λ• λ” λ§μ΄ μ‚¬μ©λ¨
    3. @ImportResource
        - λ³„λ„μ λΉ μ„¤μ • νμΌμ„ λ¶λ¬μ¬ λ• μ‚¬μ©λ¨
            
            ```java
            @Configuration
            @ImportResource("/app/applicationContext.xml")
            public class AppConfig{}
            ```
            
    4. @EnableTransactionManagement
        - <tx:annotation-driven />κ³Ό λ™μΌν• κΈ°λ¥μ„ μν–‰ ν•¨
        - νΈλμ­μ… μ†μ„±μ„ μ§€μ •ν•  μ μκ² ν•΄μ£Όλ” AOP κ΄€λ ¨ λΉμ„ λ“±λ΅ν•΄μ¤

- μ΄ μ™Έμ—λ„ μ „μ© νƒκ·Έλ¥Ό λ€μ²΄ν•  μ μλ” λ§μ€ μ• λ…Έν…μ΄μ…μ„ μ κ³µν•κ³  μμ

1.5.6 μ›Ή μ• ν”λ¦¬μΌ€μ΄μ…μ μƒλ΅μ΄ IoC  μ»¨ν…μ΄λ„ κµ¬μ„±

- μ›Ή ν™κ²½μ—μ„λ” λ³΄ν†µ **λ£¨νΈ μ• ν”λ¦¬μΌ€μ΄μ… μ»¨ν…μ¤νΈ**μ™€ **μ„λΈ”λ¦Ώ μ• ν”λ¦¬μΌ€μ΄μ… μ»¨ν…μ¤νΈ**μ λ‘ λ‹¨κ³„λ΅ λ¶„λ¦¬ν•΄μ„ μ‚¬μ©ν•λ” κ²½μ°κ°€ μΌλ°μ μ„
- λ£¨νΈ μ»¨ν…μ¤νΈμ™€ μ„λΈ”λ¦Ώ μ»¨ν…μ¤νΈλ” κ°κ° web.xmlμ <listener>μ™€ <servlet>μ— μ»¨ν…μ¤νΈμ μ„¤μ • κ΄€λ ¨ μ •λ³΄λ¥Ό λ„£μ–΄ μ›Ή μ• ν”λ¦¬μΌ€μ΄μ…μ΄ μ‹μ‘λ  λ• μλ™μΌλ΅ μƒμ„±λκ² λ§λ“¦
- contextConfigurationLocation νλΌλ―Έν„°λ¥Ό μ΄μ©ν•΄ XML νμΌ μ„μΉλ¥Ό μ§€μ •ν•κ±°λ‚, λ””ν΄νΈμΈ /WEB-INF/applicationContext.xmlμ„ μ‚¬μ©ν•¨
- λ£¨νΈ μ• ν”λ¦¬μΌ€μ΄μ… μ»¨ν…μ¤νΈ λ“±λ΅
    
    ```xml
    <!--λ””ν΄νΈ λ“±λ΅-->
    <listener>
        <listener-class>org.springframework.web.context.ContextLoaderListener</listener-class>
    </listener>
    ```
    
    ```xml
    <!--AnnotationConfigWebApplicationContext μ‚¬μ©ν•΄μ„ λ“±λ΅-->
    <context-param>
        <param-name>contextClass</param-name>
        <param-value>org.springframework.web.context.support.AnnotationConfigWebApplicationContext<param-value>
    </context-param>
    ```
    
- μ„λΈ”λ¦Ώ μ• ν”λ¦¬μΌ€μ΄μ… μ»¨ν…μ¤νΈ λ“±λ΅
    
    ```xml
    <!--DispatcherServletμ΄ λ“±λ΅λλ©΄ μ„λΈ”λ¦Ώ μ»¨ν…μ¤νΈκ°€ λ§λ“¤μ–΄μ§-->
    <servlet>
        <servlet-name>spring</servlet-name>
        <servlet-class>org.springframework.web.servlet.DispatcherServlet</servlet-class>
        <init-param>
            <param-name>contextClass</param-name>
            <param-value>org.springframework.web.context.support.AnnotationConfigWebApplicationContext<param-value>
        </init-param>
        <init-param>
            <param-name>contextConfigLocation</param-name>
            <param-value>com.ksb.WebConfig<param-value>
        </init-param>
    </servlet>
    ```
    
- `AnnotationConfigWebApplicationContext`λ¥Ό μ»¨ν…μ΄λ„ μΈν”„λΌ λΉμ— μλ™ λ“±λ΅ν•λ ¤λ©΄ μ „μ© νƒκ·Έκ°€ ν•„μ”ν•¨
    
    ```xml
    <context:annotation-config>
    <bean class="com.ksb.SimpleConfig" />
    ```
    
- μ• λ…Έν…μ΄μ…μ„ μ΄μ©ν•λ” κ²½μ° @ComponentScan κΈ°λ¥μ„ κ°€μ§„ @configuration ν΄λμ¤λ¥Ό μ •μν•κ³  contextConfigLocation νλΌλ―Έν„°λ΅ λ“±λ΅ν•λ©΄ λ¨
    
    ```java
    @Configuration
    @ComponentScan("myproject")
    public class Appconfig{}
    ```