# 6.3 ë‹¤ì´ë‚´ë¯¹ í”„ë¡ì‹œì™€ íŒ©í† ë¦¬ ë¹ˆ

6.3.1 í”„ë¡ì‹œ

1. ì „ëµ íŒ¨í„´ ì ìš©ì„ í†µí•œ ë¶€ê°€ê¸°ëŠ¥ êµ¬í˜„ì˜ ë¶„ë¦¬
    - ë¶€ê°€ì  ê¸°ëŠ¥ì„ **ìœ„ì„**ì„ í†µí•´ ë¶„ë¦¬
    - ê¸°ëŠ¥ì„ ì‚¬ìš©í•˜ëŠ” ì½”ë“œëŠ” í•µì‹¬ ì½”ë“œì™€ í•¨ê»˜ ë‚¨ì•„ ìˆìŒ
    
    ![https://leejaedoo.github.io/assets/img/strategy_pattern.jpeg](https://leejaedoo.github.io/assets/img/strategy_pattern.jpeg)
    
2. ë¶€ê°€ê¸°ëŠ¥ê³¼ í•µì‹¬ê¸°ëŠ¥ì˜ ë¶„ë¦¬
    - íŠ¸ëœì­ì…˜ì€ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ê³¼ ì„±ê²©ì´ ë‹¤ë¥´ê¸° ë•Œë¬¸ì— ë¶„ë¦¬ ê°€ëŠ¥
    - íŠ¸ëœì­ì…˜ì„ UserServiceTxë¡œ ë¶„ë¦¬í•˜ì—¬ UserServiceImplì—ëŠ” ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ë§Œ ë‚¨ìŒ
    
    ![https://leejaedoo.github.io/assets/img/%EB%B6%80%EA%B0%80%EA%B8%B0%EB%8A%A5%EA%B3%BC%ED%95%B5%EC%8B%AC%EA%B8%B0%EB%8A%A5%EC%9D%98%EB%B6%84%EB%A6%AC.jpeg](https://leejaedoo.github.io/assets/img/%EB%B6%80%EA%B0%80%EA%B8%B0%EB%8A%A5%EA%B3%BC%ED%95%B5%EC%8B%AC%EA%B8%B0%EB%8A%A5%EC%9D%98%EB%B6%84%EB%A6%AC.jpeg)
    
3. í•µì‹¬ê¸°ëŠ¥ ì¸í„°í˜ì´ìŠ¤ ì ìš©
    - ë¶€ê°€ê¸°ëŠ¥ê³¼ í•µì‹¬ê¸°ëŠ¥ì„ **ê°™ì€ ì¸í„°í˜ì´ìŠ¤**ë¥¼ êµ¬í˜„í•˜ê²Œ ë§Œë“¦
    - í´ë¼ì´ì–¸íŠ¸ëŠ” ì¸í„°í˜ì´ìŠ¤ë¥¼ í†µí•´ì„œë§Œ í•µì‹¬ê¸°ëŠ¥ ì‚¬ìš©
    - ë¶€ê°€ê¸°ëŠ¥ ì½”ë“œë¥¼ ë¨¼ì € ê±°ì³ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ë¶€ë¶„ì„ í•µì‹¬ê¸°ëŠ¥ì— **ìœ„ì„**í•¨
    - ì‹¤ì œ ëŒ€ìƒì¸ ê²ƒì²˜ëŸ¼ **ìœ„ì¥**í•´ì„œ í´ë¼ì´ì–¸íŠ¸ì˜ ìš”ì²­ì„ ë°›ê¸° ë•Œë¬¸ì— **í”„ë¡ì‹œ(Proxy)**ë¼ë„ ë¶€ë¦„
    
    ![https://leejaedoo.github.io/assets/img/%ED%95%B5%EC%8B%AC%EA%B8%B0%EB%8A%A5_%EC%9D%B8%ED%84%B0%ED%8E%98%EC%9D%B4%EC%8A%A4%EC%9D%98%EC%A0%81%EC%9A%A9.jpeg](https://leejaedoo.github.io/assets/img/%ED%95%B5%EC%8B%AC%EA%B8%B0%EB%8A%A5_%EC%9D%B8%ED%84%B0%ED%8E%98%EC%9D%B4%EC%8A%A4%EC%9D%98%EC%A0%81%EC%9A%A9.jpeg)
    

6.3.2 í”„ë¡ì‹œ íŒ¨í„´ ì„¤ëª…

- ë¶€ê°€ê¸°ëŠ¥ê³¼ í•µì‹¬ê¸°ëŠ¥ì€ ê°™ì€ ì¸í„°í˜ì´ìŠ¤ë¥¼ êµ¬í˜„
- í”„ë¡ì‹œë¥¼ í†µí•´ ìµœì¢…ì ìœ¼ë¡œ ìš”ì²­ì„ ìœ„ì„ë°›ì•„ ì²˜ë¦¬í•˜ëŠ” ì˜¤ë¸Œì íŠ¸ë¥¼ **íƒ€ê¹ƒ(Target)** or **ì‹¤ì²´(Real Subject)**ë¼ê³  í•¨
- í”„ë¡ì‹œ ì‚¬ìš© ëª©ì  ë‘ ê°€ì§€
    1. í´ë¼ì´ì–¸íŠ¸ê°€ íƒ€ê¹ƒì— **ì ‘ê·¼ ë°©ë²•** ì œì–´
    2. íƒ€ê¹ƒì— **ë¶€ê°€ê¸°ëŠ¥** ë¶€ì—¬

![https://leejaedoo.github.io/assets/img/%ED%94%84%EB%A1%9D%EC%8B%9C%EC%99%80_%ED%83%80%EA%B9%83.jpeg](https://leejaedoo.github.io/assets/img/%ED%94%84%EB%A1%9D%EC%8B%9C%EC%99%80_%ED%83%80%EA%B9%83.jpeg)

6.3.3 ë°ì½”ë ˆì´í„° íŒ¨í„´ ì„¤ëª…

- íƒ€ê¹ƒì— **ë¶€ê°€ ê¸°ëŠ¥**ì„ **ëŸ°íƒ€ì„ì‹œ**ì— ë‹¤ì´ë‚´ë¯¹í•˜ê²Œ ë¶€ì—¬í•˜ê¸° ìœ„í•´ **í”„ë¡ì‹œë¥¼ ì‚¬ìš©í•˜ëŠ” íŒ¨í„´**
- ì½”ë“œìƒì— ì–´ë–¤ ë°©ë²•ê³¼ ìˆœì„œë¡œ í”„ë¡ì‹œì™€ íƒ€ê¹ƒì´ ì—°ê²°ë˜ì–´ ì‚¬ìš©ë˜ëŠ”ì§€ ì •í•´ì§€ì§€ ì•ŠìŒ
- ìƒˆë¡œìš´ ê¸°ëŠ¥ì„ ì¶”ê°€í•  ë•Œ ìœ ìš©í•¨
- ë°ì½”ë ˆì´í„° íŒ¨í„´ì€ í”„ë¡ì‹œì˜ ê°œìˆ˜ë¥¼ ì œí•œë°›ì§€ ì•ŠìŒ
- ë”°ë¼ì„œ, ì—¬ëŸ¬ ë¶€ê°€ ê¸°ëŠ¥ì„ ë¶€ì—¬í•  ìˆ˜ ìˆìŒ
- ë°ì½”ë ˆì´í„°ëŠ” ìœ„ì„í•˜ëŠ” ëŒ€ìƒì—ë„ ì¸í„°í˜ì´ìŠ¤ë¡œ ì ‘ê·¼í•˜ê¸° ë•Œë¬¸ì— ëŸ°íƒ€ì„ì‹œ ì£¼ì…ë°›ì„ ìˆ˜ ìˆìŒ

![https://leejaedoo.github.io/assets/img/%EB%8D%B0%EC%BD%94%EB%A0%88%EC%9D%B4%ED%84%B0_%ED%8C%A8%ED%84%B4.jpeg](https://leejaedoo.github.io/assets/img/%EB%8D%B0%EC%BD%94%EB%A0%88%EC%9D%B4%ED%84%B0_%ED%8C%A8%ED%84%B4.jpeg)

- InputStream êµ¬í˜„ í´ë˜ìŠ¤ëŠ” ë°ì½”ë ˆì´í„° íŒ¨í„´ì´ ì‚¬ìš©ëœ ëŒ€í‘œì ì¸ ì˜ˆì‹œì„
- InputStreamì„ êµ¬í˜„í•˜ëŠ” FileInputStreamì— ë²„í¼ ì½ê¸° ê¸°ëŠ¥ì„ ì œê³µí•˜ëŠ” BufferedInputStreamì´ë¼ëŠ” ë°ì½”ë ˆì´í„°ë¥¼ ì ìš©í•œ ì˜ˆì‹œì„
    
    ```java
    //InputStream : ì¸í„°í˜ì´ìŠ¤ 
    //FileInputStream : íƒ€ê¹ƒ
    //BufferedInputStream : ë°ì½”ë ˆì´í„°
    InputStream is = new BufferedInputStream(new FileInputStream("a.txt"));
    ```
    
- ì¸í„°í˜ì´ìŠ¤ë¥¼ í†µí•œ ë°ì½”í…Œì´í„° ì •ì˜ì™€ ì£¼ì…ì€ ìŠ¤í”„ë§ì˜ DI ë°©ì‹ì„ ì´ìš©í•˜ë©´ í¸ë¦¬í•¨
- UserServiceTx í´ë˜ìŠ¤ë¡œ ì„ ì–¸ ëœ UserService ë¹ˆì€ ë°ì½”ë ˆì´í„°ì„
- UserServiceTxëŠ” UserService íƒ€ì…ì˜ ì˜¤ë¸Œì íŠ¸ë¥¼ DI ë°›ì•„ ë¹„ì¦ˆë‹ˆìŠ¤ ê¸°ëŠ¥ì€ ìœ„ì„í•˜ì§€ë§Œ, ê·¸ ê³¼ì •ì—ì„œ íŠ¸ëœì­ì…˜ ê²½ê³„ì„¤ì • ê¸°ëŠ¥ì„ ë¶€ì—¬í•¨
    
    ```xml
    <beans 
    		.../>
    		<!--ë°ì½”ë ˆì´í„°-->
        <bean id="userService" class="com.ksb.spring.UserServiceTx">
            <property name="transactionManager" ref="transactionManager"/>
            <property name="userService" ref="userServiceImpl"/>
        </bean>
    		
    		<!--íƒ€ê¹ƒ-->
        <bean id="userServiceImpl" class="com.ksb.spring.UserServiceImpl">
            <property name="userDao" ref="userDao"/>
            <property name="mailSender" ref="mailSender"/>
        </bean>
    <beans/>
    ```
    

6.3.4 í”„ë¡ì‹œ íŒ¨í„´

- ì¼ë°˜ì ìœ¼ë¡œ ì‚¬ìš©í•˜ëŠ” **í”„ë¡ì‹œ**ì™€ **í”„ë¡ì‹œ íŒ¨í„´**ì€ êµ¬ë¶„í•  í•„ìš”ê°€ ìˆìŒ
- ì¼ë°˜ì  í”„ë¡ì‹œëŠ” í´ë¼ì´ì–¸íŠ¸ì™€ ì‚¬ìš©ì ì‚¬ì´ì˜ ëŒ€ë¦¬ì¸ ì—­í• 
- í”„ë¡ì‹œ íŒ¨í„´ì€ íƒ€ê¹ƒì— ëŒ€í•œ **ì ‘ê·¼ ë°©ë²•**ì„ ì œì–´
- íƒ€ê¹ƒì˜ ê¸°ëŠ¥ì„ í™•ì¥ ë° ì¶”ê°€ë¥¼ í•˜ì§€ ì•Šì§€ë§Œ, í´ë¼ì´ì–¸íŠ¸ê°€ íƒ€ê¹ƒì— ì ‘ê·¼í•˜ëŠ” ë°©ì‹ì„ ë³€ê²½í•¨
- í´ë¼ì´ì–¸íŠ¸ê°€ íƒ€ê¹ƒì„ ì‚¬ìš©í•  ë•Œ, í”„ë¡ì‹œê°€ íƒ€ê¹ƒ ì˜¤ë¸Œì íŠ¸ë¥¼ ìƒì„±í•˜ê³  ìš”ì²­ì„ ìœ„ì„í•¨
- ë‹¤ë¥¸ ì„œë²„ì˜ ì˜¤ë¸Œì íŠ¸ë¥¼ ì‚¬ìš©í•  ë•Œ í”„ë¡ì‹œ íŒ¨í„´ ì‚¬ìš©
- ì›ê²© ì˜¤ë¸Œì íŠ¸ì— ëŒ€í•œ í”„ë¡ì‹œë¥¼ ë§Œë“¤ì–´ë‘ê³ , í´ë¼ì´ì–¸íŠ¸ëŠ” ë§ˆì¹˜ ë¡œì»¬ì— ì¡´ì¬í•˜ëŠ” ì˜¤ë¸Œì íŠ¸ë¥¼ ì“°ëŠ” ê²ƒ ì²˜ëŸ¼ í”„ë¡ì‹œë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆìŒ
    
    <aside>
    ğŸ’¡ ì´ìœ ëŠ” í”„ë¡ì‹œì™€ ì›ê²© ì˜¤ë¸Œì íŠ¸ëŠ” ê°™ì€ ì¸í„°í˜ì´ìŠ¤ë¥¼ êµ¬í˜„í•˜ê¸° ë•Œë¬¸ì„
    
    </aside>
    
- ë˜ëŠ”, íŠ¹ë³„í•œ ìƒí™©ì—ì„œ íƒ€í‚·ì— ëŒ€í•œ ì ‘ê·¼ê¶Œí•œì„ ì œì–´í•˜ê¸° ìš°í•´ í”„ë¡ì‹œ íŒ¨í„´ ì‚¬ìš©
- í”„ë¡ì‹œë¥¼ ê±°ì¹˜ê²Œ í•˜ì—¬ íŠ¹ì • ë©”ì†Œë“œë¥¼ ì‚¬ìš©í•˜ë ¤ê³  í•  ë•Œ, ì˜ˆì™¸ë¥¼ ë˜ì ¸ ë§‰ì„ ìˆ˜ ìˆìŒ
- êµ¬ì¡°ì ìœ¼ë¡œ í”„ë¡ì‹œì™€ ë°ì½”ë ˆì´í„°ëŠ” ìœ ì‚¬í•¨
- ë‹¤ë§Œ, í”„ë¡ì‹œëŠ” ì½”ë“œì—ì„œ ìì‹ ì´ ë§Œë“¤ê±°ë‚˜ ì ‘ê·¼í•  íƒ€ê¹ƒ í´ë˜ìŠ¤ì˜ ì •ë³´ë¥¼ ì•„ëŠ” ê²½ìš°ê°€ ë§ìŒ. í•˜ì§€ë§Œ, í”„ë¡ì‹œ íŒ¨í„´ì´ë¼ë„ ì¸í„°í˜ì´ìŠ¤ë¥¼ í†µí•´ ìœ„ì„í•˜ê²Œ í•  ìˆ˜ ìˆìŒ

![https://leejaedoo.github.io/assets/img/proxy_decorator.jpeg](https://leejaedoo.github.io/assets/img/proxy_decorator.jpeg)

- ì•ìœ¼ë¡œ íƒ€ê¹ƒê³¼ **ë™ì¼í•œ ì¸í„°í˜ì´ìŠ¤ë¥¼ êµ¬í˜„**í•˜ê³ , í´ë¼ì´ì–¸íŠ¸ì™€ íƒ€ê¹ƒ **ì‚¬ì´ì— ì¡´ì¬**í•˜ë©°, **ë¶€ê°€ ë˜ëŠ” ì ‘ê·¼ ì œì–´ë¥¼ ë‹´ë‹¹**í•˜ëŠ” ì˜¤ë¸Œì íŠ¸ë¥¼ ëª¨ë‘ **í”„ë¡ì‹œ**ë¼ í•˜ê² ìŒ

6.3.5 í”„ë¡ì‹œ íŒ¨í„´ì˜ ë¬¸ì œì 

- í”„ë¡ì‹œëŠ” ê¸°ì¡´ ì½”ë“œì— ì˜í–¥ì„ ì£¼ì§€ ì•Šê³ , íƒ€ê¹ƒì˜ ê¸°ëŠ¥ í™•ì¥ ë˜ëŠ” ì ‘ê·¼ ë°©ë²•ì„ ì œì–´í•  ìˆ˜ ìˆëŠ” ìœ ìš©í•œ ë°©ë²•ì„
- í•˜ì§€ë§Œ, ë§¤ë²ˆ ìƒˆë¡œìš´ í´ë˜ìŠ¤ë¥¼ ì •ì˜í•´ì•¼ í•¨
- ë˜í•œ, ì¸í„°í˜ì´ìŠ¤ì— êµ¬í˜„í•´ì•¼ í•˜ëŠ” ë©”ì†Œë“œê°€ ë§ì„ ê²½ìš° ì¼ì¼ì´ ëª¨ë“  ë©”ì†Œë“œë¥¼ êµ¬í˜„í•´ì•¼ í•¨
- UserServiceTxì—ì„œ íŠ¸ëœì­ì…˜ì´ë¼ëŠ” ë¶€ê°€ê¸°ëŠ¥ì„ ìˆ˜í–‰í•˜ê³ , ë¹„ì¦ˆë‹ˆìŠ¤ë¡œì§ì€ UserServiceImplì— ìœ„ì„í•¨
- ë¶€ê°€ê¸°ëŠ¥ ì‚¬ì´ì— ìœ„ì„í•˜ëŠ” ë¶€ë¶„ì´ ì¡´ì¬í•˜ê¸° ë•Œë¬¸ì—, ë¶€ê°€ê¸°ëŠ¥ì„ ì¬í™œìš©í•˜ëŠ” ê²ƒì´ ì–´ë ¤ì›€
- ë•Œë¬¸ì—, ë‹¤ë¥¸ ë©”ì†Œë“œì—ì„œ ë™ì¼í•œ íŠ¸ëœì­ì…˜ ë¶€ê°€ê¸°ëŠ¥ì„ í•„ìš”í•˜ë©´ ë˜‘ê°™ì´ êµ¬í˜„í•´ì•¼ í•´ì„œ ì½”ë“œ ì¤‘ë³µì´ ë°œìƒí•¨
- ëª© í”„ë ˆì„ì›Œí¬ ì²˜ëŸ¼ `java.lang.reflect` íŒ¨í‚¤ì§€ ì•ˆì— í”„ë¡ì‹œë¥¼ ì‰½ê²Œ ë§Œë“¤ë„ë¡ í•˜ëŠ” í´ë˜ìŠ¤ë“¤ì´ ìˆìŒ

6.3.6 ë¦¬í”Œë ‰ì…˜

- **ë‹¤ì´ë‚´ë¯¹ í”„ë¡ì‹œ**ëŠ” ë¦¬í”Œë ‰ì…˜ ê¸°ëŠ¥ì„ ì´ìš©í•´ì„œ í”„ë¡ì‹œë¥¼ ë§Œë“¤ì–´ì¤Œ
- ë¦¬í”Œë ‰ì…˜ì€ ìë°”ì˜ ì½”ë“œ ìì²´ë¥¼ ì¶”ìƒí™”í•´ì„œ ì ‘ê·¼í•˜ë„ë¡ ë§Œë“ ê²ƒì„
- ìë°”ì˜ ëª¨ë“  í´ë˜ìŠ¤ëŠ” í´ë˜ìŠ¤ ìì²´ì— êµ¬ì„±ì •ë³´ë¥¼ ë‹´ì€ Class íƒ€ì…ì˜ ì˜¤ë¸Œì íŠ¸ë¥¼ í•˜ë‚˜ì”© ê°€ì§€ê³  ìˆìŒ
- â€œí´ë˜ìŠ¤ì´ë¦„.classâ€ ë˜ëŠ” getClass()ë¥¼ í†µí•´ Class íƒ€ì…ì˜ ì˜¤ë¸Œì íŠ¸ë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ìˆìŒ
- í´ë˜ìŠ¤ ì˜¤ë¸Œì íŠ¸ë¥¼ ì´ìš©í•˜ë©´ í´ë˜ìŠ¤ ì½”ë“œì— ëŒ€í•œ **ë©”íƒ€ì •ë³´**ë¥¼ ê°€ì ¸ì˜¤ê±°ë‚˜ ì˜¤ë¸Œì íŠ¸ë¥¼ **ì¡°ì‘**í•  ìˆ˜ ìˆìŒ
- í´ë˜ìŠ¤ ì´ë¦„, ìƒì†í•œ í´ë˜ìŠ¤, íƒ€ì…, í•„ë“œ ë“±ì˜ ì •ë³´ë¥¼ ì•Œ ìˆ˜ ìˆìŒ
- ë¦¬í”Œë ‰ì…˜ API ì¤‘ì—ì„œ **ë©”ì†Œë“œ**ì— ëŒ€í•œ ì •ì˜ë¥¼ ë‹´ì€ **Method ì¸í„°í˜ì´ìŠ¤**ë¥¼ ì´ìš©í•˜ë©´ ë©”ì†Œë“œë¥¼ í˜¸ì¶œí•  ìˆ˜ ìˆìŒ

6.3.7 Method ì¸í„°í˜ì´ìŠ¤

- ë©”ì†Œë“œì— ëŒ€í•œ ìì„¸í•œ ì •ë³´ë¥¼ ë‹´ê³  ìˆìŒ
- ìŠ¤íŠ¸ë§ì´ ê°€ì§„ ë©”ì†Œë“œ ì¤‘ì—ì„œ  â€œlengthâ€ë¼ëŠ” ì´ë¦„ì„ ê°–ê³  ìˆê³ , íŒŒë¼ë¯¸í„°ê°€ ì—†ëŠ” ë©”ì†Œë“œ ì •ë³´ë¥¼ ê°€ì ¸ì˜¤ëŠ” ì½”ë“œëŠ” ë‹¤ìŒê³¼ ê°™ìŒ
    
    ```java
    Method lengthMethod = String.class.getMethod("length");
    ```
    
- íŠ¹ì • ì˜¤ë¸Œì íŠ¸ì˜ ë©”ì†Œë“œë¥¼ ì‹¤í–‰í•  ìˆ˜ ìˆìŒ
- Method ì¸í„°í˜ì´ìŠ¤ì— ì •ì˜ëœ invoke()ë¥¼ ì‚¬ìš©í•˜ë©´ ë¨
- invoke()ëŠ” ë©”ì†Œë“œë¥¼ ì‹¤í–‰ì‹œí‚¬ ëŒ€ìƒ ì˜¤ë¸Œì íŠ¸(obj)ì™€ íŒŒë¼ë¯¸í„° ëª©ë¡(args)ë¥¼ ë°›ì•„ ë©”ì†Œë“œë¥¼ í˜¸ì¶œí•œ ë’¤ì— ê·¸ ê²°ê³¼ë¥¼ Object íƒ€ì…ìœ¼ë¡œ ëŒë ¤ì¤Œ
    
    ```java
    public Object invoke(Object obj, Object... args)
    
    int length = lengthMethod.invoke(name) // int length = name.length();
    ```
    

```java
public class ReflectionTest {
    @Test
    public void invokeMethod() throws Exception {
        String name = "Spring";

        //length()
        assertThat(name.length(), is(6));

        Method lengthMethod = String.class.getMethod("length");
        assertThat((Integer)lengthMethod.invoke(name), is(6));

        //charAt()
        assertThat(name.charAt(0), is('S'));

        Method charAtMethod = String.class.getMethod("charAt", int.class);
        assertThat((Character)charAtMethod.invoke(name, 0), is('S'));
    }
}
```

6.3.8 í”„ë¡ì‹œ í´ë˜ìŠ¤

- í”„ë¡ì‹œë¥¼ ì ìš©í•  ê°„ë‹¨í•œ íƒ€í‚· í´ë˜ìŠ¤ì™€ ì¸í„°í˜ì´ìŠ¤ë¥¼ ë§Œë“¤ê²ƒì„
- í•´ë‹¹ ì½”ë“œëŠ” ì¸í„°í˜ì´ìŠ¤ì˜ ëª¨ë“  ë©”ì†Œë“œ êµ¬í˜„ ë° ìœ„ì„ê³¼, ë¶€ê°€ê¸°ëŠ¥ì´ ëª¨ë“  ë©”ì†Œë“œì— ì¤‘ë³µë¼ì„œ ë‚˜íƒ€ë‚¨
- ì¦‰, í”„ë¡ì‹œ ì ìš©ì˜ ì¼ë°˜ì ì¸ ë‘ ê°€ì§€ì˜ ë¬¸ì œì  ëª¨ë‘ ë³´ìœ 

```java
public interface Hello {
    String sayHello(String name);
    String sayHi(String name);
    String sayThankYou(String name);
}

public class HelloTarget implements Hello{
    @Override
    public String sayHello(String name) {
        return "Hello "+name;
    }

    @Override
    public String sayHi(String name) {
        return "Hi "+name;
    }

    @Override
    public String sayThankYou(String name) {
        return "Thank You "+name;
    }
}

public class HelloUppercase implements Hello {
    Hello hello;

    public HelloUppercase(Hello hello) {
        this.hello = hello;
    }

    //toUpperCase()ê°€ ëª¨ë“  ë©”ì†Œë“œì—ì„œ ì¤‘ë³µ. ì¦‰, ë¶€ê°€ê¸°ëŠ¥ì´ ì¤‘ë³µë¨
    @Override
    public String sayHello(String name) {
        return this.hello.sayHello(name).toUpperCase();
    }

    @Override
    public String sayHi(String name) {
        return this.hello.sayHi(name).toUpperCase();
    }

    @Override
    public String sayThankYou(String name) {
        return this.hello.sayThankYou(name).toUpperCase();
    }
}

public class ReflectionTest {
		...
		@Test
    public void simpleProxy(){
        Hello hello = new HelloTarget();
        assertThat(hello.sayHello("Toby"), is("Hello Toby"));
        assertThat(hello.sayHi("Toby"), is("Hi Toby"));
        assertThat(hello.sayThankYou("Toby"), is("Thank You Toby"));
			
				//í”„ë¡ì‹œë¥¼ í†µí•œ íƒ€ê¹ƒ ì ‘ê·¼
        Hello proxiedHello = new HelloUppercase(new HelloTarget());
        assertThat(proxiedHello.sayHello("Toby"), is("HELLO TOBY"));
        assertThat(proxiedHello.sayHi("Toby"), is("HI TOBY"));
        assertThat(proxiedHello.sayThankYou("Toby"), is("THANK YOU TOBY"));

    }
}
```

6.3.9 ë‹¤ì´ë‚´ë¯¹ í”„ë¡ì‹œ

- ë‹¤ì´ë‚´ë¯¹ í”„ë¡ì‹œëŠ” **í”„ë¡ì‹œ íŒ©í† ë¦¬**ì— ì˜í•´ ëŸ°íƒ€ì„ ì‹œ ë‹¤ì´ë‚´ë¯¹í•˜ê²Œ ë§Œë“¤ì–´ì§€ëŠ” **ì˜¤ë¸Œì íŠ¸**
- ë‹¤ì´ë‚´ë¯¹ í”„ë¡ì‹œëŠ” ê¸°ì¡´ì˜ í”„ë¡ì‹œì²˜ëŸ¼ íƒ€ê¹ƒì˜ ì¸í„°í˜ì´ìŠ¤ì™€ **ë™ì¼í•œ ì¸í„°í˜ì´ìŠ¤ êµ¬í˜„**
- í”„ë¡ì‹œ íŒ©í† ë¦¬ì—ê²Œ ì¸í„°í˜ì´ìŠ¤ ì •ë³´ë§Œ ì œê³µí•˜ë©´ í•´ë‹¹ ì¸í„°í˜ì´ìŠ¤ë¥¼ êµ¬í˜„í•œ í´ë˜ìŠ¤ì˜ ì˜¤ë¸Œì íŠ¸ ìë™ ìƒì„±í•¨
    
    ![https://leejaedoo.github.io/assets/img/dynamic_proxy.jpeg](https://leejaedoo.github.io/assets/img/dynamic_proxy.jpeg)
    
- ë¶€ê°€ê¸°ëŠ¥ì€ `InvocationHandler`ë¥¼ êµ¬í˜„í•œ ì˜¤ë¸Œì íŠ¸ì—ì„œ ì§ì ‘ ì‘ì„±í•¨
- `InvocationHandler`ëŠ” invoke() ë©”ì†Œë“œë§Œ ê°€ì§€ëŠ” ì¸í„°í˜ì´ìŠ¤ì„
- invoke()ëŠ” ë¦¬í”Œë ‰ì…˜ì˜ Method ì¸í„°í˜ì´ìŠ¤ë¥¼ **íŒŒë¼ë¯¸í„°**ë¡œ ë°›ìŒ
- ë‹¤ì´ë‚´ë¯¹ í”„ë¡ì‹œ ì˜¤ë¸Œì íŠ¸ëŠ” í´ë¼ì´ì–¸íŠ¸ì˜ **ëª¨ë“  ìš”ì²­**ì„ ë¦¬í”Œë ‰ì…˜ ì •ë³´ë¡œ **ë³€í™˜**í•´ì„œ invoke() ë©”ì†Œë“œì— ì „ë‹¬
- ëª¨ë“  ìš”ì²­ì´ invoke()ë¡œ ì§‘ì¤‘ë˜ê¸° ë•Œë¬¸ì— **ì¤‘ë³µë˜ëŠ” ê¸°ëŠ¥ íš¨ê³¼ì  ì œê³µ**ê°€ëŠ¥
    
    ![https://leejaedoo.github.io/assets/img/invocationHandler.jpeg](https://leejaedoo.github.io/assets/img/invocationHandler.jpeg)
    
- ë¦¬í”Œë™ì…˜ì€ Methodì™€ íŒŒë¼ë¯¸í„° ì •ë³´ê°€ ìˆìœ¼ë©´ ë©”ì†Œë“œë¥¼ í˜¸ì¶œí•  ìˆ˜ ìˆìŒ
    
    ```java
    Method charAtMethod = String.class.getMethod("charAt", int.class);
    assertThat((Character)charAtMethod.invoke(name, 0), is('S'));
    ```
    
- ë¦¬í”Œë ‰ì…˜ì—ëŠ” ë©”ì†Œë“œì™€ íŒŒë¼ë¯¸í„° ì •ë³´(ë©”íƒ€ì •ë³´)ë¥¼ ëª¨ë‘ ê°–ê¸°ìˆê¸° ë•Œë¬¸ì— íƒ€ê¹ƒ ì˜¤ë¸Œì íŠ¸ì´ ë©”ì†Œë“œ í˜¸ì¶œ ê°€ëŠ¥
- ì¦‰, `InvocationHandler`êµ¬í˜„ ì˜¤ë¸Œì íŠ¸ê°€ íƒ€ê¹ƒ ì˜¤ë¸Œì íŠ¸ ë ˆí¼ëŸ°ìŠ¤ë¥¼ ê°€ì§€ê³  ìˆìœ¼ë©´ ë¦¬í”Œë ‰ì…˜ìœ¼ë¡œ ê°„ë‹¨íˆ ìœ„ì„ ì½”ë“œë¥¼ ë§Œë“¤ìˆ˜ ìˆìŒ

6.3.10 ë‹¤ì´ë‚´ë¯¹ í”„ë¡ì‹œ ì ìš©

- ë‹¤ì´ë‚´ë¯¹ í”„ë¡ì‹œë¡œë¶€í„° ìš”ì²­ì„ ì „ë‹¬ë°›ìœ¼ë ¤ë©´ `InvocationHandler`ë¥¼ êµ¬í˜„ í•´ì•¼í•¨
- ë©”ì†Œë“œëŠ” invoke() í•˜ë‚˜ ë¿ì„
- í”„ë¡ì‹œê°€ ì œê³µí•˜ë ¤ëŠ” ë¶€ê°€ê¸°ëŠ¥ì¸ ë¦¬í„´ ê°’ì„ ëŒ€ë¬¸ì ë³€ê²½
- ë‹¤ì´ë‚´ë¯¹ í”„ë¡ì‹œ ìƒì„±ì€ Proxy í´ë˜ìŠ¤ì˜ newProxyInstance() ìŠ¤íƒœí”½ íŒ©í† ë¦¬ ë©”ì†Œë“œë¥¼ ì‚¬ìš©í•˜ë©´ ë¨
    - ì²« ë²ˆì§¸ íŒŒë¼ë¯¸í„°ëŠ” í´ë˜ìŠ¤ ë¡œë” ì œê³µ
    - ë‘ ë²ˆì§¸ íŒŒë¼ë¯¸í„°ëŠ” í”„ë¡ì‹œê°€ êµ¬í˜„í•´ì•¼ í•  ì¸í„°í˜ì´ìŠ¤. ë‹¤ì´ë‚´ë¯¹ í”„ë¡ì‹œëŠ” í•œ ë²ˆì— í•˜ë‚˜ ì´ìƒì˜ ì¸í„°í˜ì´ìŠ¤ë¥¼ êµ¬í˜„í•  ìˆ˜ ìˆì–´ ë°°ì—´ ì‚¬ìš©
    - ì„¸ ë²ˆì§¸ íŒŒë¼ë¯¸í„°ëŠ” `InvocationHandler` êµ¬í˜„ ì˜¤ë¸Œì íŠ¸

```java
public class UppercaseHandler implements InvocationHandler {
    Hello target;

    public UppercaseHandler(Hello target) {
        this.target = target;
    }

    @Override
    public Object invoke(Object proxy, Method method, Object[] args)
            throws Throwable {
        String ret = (String)method.invoke(target, args);
        return ret.toUpperCase(); //ë¶€ê°€ê¸°ëŠ¥
    }
}

public class ReflectionTest {
		@Test
    public void simpleProxy(){
        ...
        //í”„ë¡ì‹œë¥¼ í†µí•œ íƒ€ê¹ƒ ì ‘ê·¼
        Hello proxiedHello = (Hello) Proxy.newProxyInstance(
                getClass().getClassLoader(),
                new Class[] {Hello.class},
                new UppercaseHandler(new HelloTarget())
        );
        assertThat(proxiedHello.sayHello("Toby"), is("HELLO TOBY"));
        assertThat(proxiedHello.sayHi("Toby"), is("HI TOBY"));
        assertThat(proxiedHello.sayThankYou("Toby"), is("THANK YOU TOBY"));
    }
}
```

6.3.11 ë‹¤ì´ë‚´ë¯¹ í”„ë¡ì‹œì˜ í™•ì¥

- ë‹¤ì´ë‚´ë¯¹ í”„ë¡ì‹œë¥¼ ì‚¬ìš©í•¨ìœ¼ë¡œì¨ ì¸í„°í˜ì´ìŠ¤ì˜ ëª¨ë“  ë©”ì†Œë“œë¥¼ êµ¬í˜„ì•ˆí•´ë„ ë¨
- ë‹¤ì´ë‚´ë¯¹ í”„ë¡ì‹œê°€ ë§Œë“¤ì–´ì§ˆ ë•Œ ì¸í„°í˜ì´ìŠ¤ì˜ ë©”ì†Œë“œê°€ ìë™ì ìœ¼ë¡œ ì¶”ê°€ë˜ê³ , ë¶€ê°€ê¸°ëŠ¥ì€ invoke()ì—ì„œ ì²˜ë¦¬ë¨
- `UppercaseHandler`ëŠ” ëª¨ë“  ë©”ì†Œë“œì˜ ë¦¬í„´ íƒ€ì…ì´ ìŠ¤íŠ¸ë§ì´ë¼ ê°€ì •í•˜ê³  ìˆìŒ
- ë§Œì•½ ìŠ¤íŠ¸ë§ì´ ì•„ë‹Œ ë¦¬í„´íƒ€ì…ì„ ê°–ëŠ” ë©”ì†Œë“œê°€ ì¶”ê°€ë˜ë©´ ëŸ°íƒ€ì„ ì‹œ ìºìŠ¤íŒ… ì˜¤ë¥˜ê°€ ë°œìƒ
- ë¦¬í”Œë ‰ì…˜ì€ ë§¤ìš° ìœ ì—°í•˜ê³  ë§‰ê°•í•´ ì£¼ì˜ ê¹Šê²Œ ì‚¬ìš©í•´ì•¼ í•¨
- ë”°ë¼ì„œ, Methodë¥¼ ì´ìš©í•œ íƒ€ê¹ƒ ì˜¤ë¸Œì íŠ¸ì˜ ë©”ì†Œë“œ í˜¸ì¶œí›„ ë¦¬í„´íƒ€ì…ì„ í™•ì¸í•˜ëŠ” ì‘ì—… í•„ìš”
- ë˜í•œ, `InvocationHandler` ëŠ” íƒ€ê¹ƒì˜ ì¢…ë¥˜ ìƒê´€ì—†ì´ ì ìš© ê°€ëŠ¥í•¨
- ì–´ì©Œí”¼ ë¦¬í”Œë ‰ì…˜ì˜ Method ì¸í„°í˜ì´ìŠ¤ë¥¼ ì´ìš©í•´ íƒ€ê¹ƒ ë©”ì†Œë“œë¥¼ í˜¸ì¶œí•˜ê¸° ë•Œë¬¸ì„
- ì¦‰, íƒ€ê¹ƒì˜ íƒ€ì…ì„ Helloê°€ ì•„ë‹Œ Objectë¡œ ì§€ì •í•´ë„ ë¨

```java
public class UppercaseHandler implements InvocationHandler {
    Object target;

    public UppercaseHandler(Object target) {
        this.target = target;
    }

    @Override
    public Object invoke(Object proxy, Method method, Object[] args)
            throws Throwable {
        Object ret = method.invoke(target, args);
        if(ret instanceof String)
            return (String)((String) ret).toUpperCase();
        else
            return ret;
    }
}
```

- ë¦¬í„´ íƒ€ì… ë¿ë§Œì´ ì•„ë‹ˆë¼, ë©”ì†Œë“œ ì´ë¦„ìœ¼ë¡œ ì¡°ê±´ì„ ê±¸ ìˆ˜ ìˆìŒ
- Method íŒŒë¼ë¯¸í„°ì—ì„œ ë©”ì†Œë“œ ì´ë¦„ì„ ê°€ì ¸ì™€ í™•ì¸í•˜ë©´ ë¨

```java
public class UppercaseHandler implements InvocationHandler {
    ...
    @Override
    public Object invoke(Object proxy, Method method, Object[] args)
            throws Throwable {
        Object ret = method.invoke(target, args);
        if(ret instanceof String && 
                method.getName().startsWith("say"))
            return (String)((String) ret).toUpperCase();
        else
            return ret;
    }
}
```

6.3.12 ë‹¤ì´ë‚´ë¯¹ í”„ë¡ì‹œë¥¼ ì´ìš©í•œ íŠ¸ëœì­ì…˜ ë¶€ê°€ê¸°ëŠ¥

- ê¸°ì¡´ì˜ UserServiceTxëŠ” ì¸í„°í˜ì´ìŠ¤ì˜ ë©”ì†Œë“œë¥¼ ëª¨ë‘ êµ¬í˜•í•´ì•¼ í•¨
- ë˜í•œ, íŠ¸ë Œì­ì…˜ì´ í•„ìš”í•œ ë©”ì†Œë“œë§ˆë‹¤ íŠ¸ëœì­ì…˜ ë¶€ê°€ê¸°ëŠ¥ ì½”ë“œê°€ ì¤‘ë³µë˜ì„œ ë‚˜íƒ€ë‚¨
- ë‹¤ì´ë‚´ë¯¹ í”„ë¡ì‹œë¥¼ ì‚¬ìš©í•˜ì—¬ ìœ„ ë‘ ê°€ì§€ ë¬¸ì œë¥¼ í•´ê²°
- `InvocationHandler`ë¥¼ êµ¬í˜„í•œ `TransactionHandler`ëŠ” ìš”ì²­ì„ ìœ„ì„í•  íƒ€ê¹ƒì„ Object íƒ€ì…ìœ¼ë¡œ DIë¡œ ì œê³µë°›ìŒ
- ë”°ë¼ì„œ `UserServiceImpl` ì™¸ì— íŠ¸ëœì­ì…˜ì´ í•„ìš”í•œ ê³³ì„ íƒ€ê¹ƒìœ¼ë¡œ í•  ìˆ˜ ìˆìŒ
- pattern ë³€ìˆ˜ë¥¼ í†µí•´ í•´ë‹¹ íŒ¨í„´ìœ¼ë¡œ ì‹œì‘í•˜ëŠ” ì¡°ê±´ì„ ê±¸ ìˆ˜ ìˆìŒ
- ë¦¬í”Œë ‰ì…˜ì—ì„œ ë°œìƒí•˜ëŠ” ì˜ˆì™¸ê°€ ë°œìƒí•˜ë©´ `InvocationTargetException`ë¡œ í¬ì¥ë˜ì„œ ë˜ì ¸ì§€ê¸° ë•Œë¬¸ì— í•´ë‹¹ ì˜ˆì™¸ë¥¼ ë°›ì€ í›„ getTargetException() ìœ¼ë¡œ ì˜ˆì™¸ë¥¼ ê°€ì ¸ì™€ì•¼ í•¨

```java
public class TransactionHandler implements InvocationHandler {
    private Object target;
    private PlatformTransactionManager transactionManager;
    private String pattern;

    public void setTarget(Object target){
        this.target = target;
    }

    public void setTransactionManager(
            PlatformTransactionManager transactionManager){
        this.transactionManager = transactionManager;
    }

    public void setPattern(String pattern){
        this.pattern = pattern;
    }

    @Override
    public Object invoke(Object proxy, Method method, Object[] args)
            throws Throwable {
        if(method.getName().startsWith(pattern)){
            return invokeTransaction(method, args);
        }else{
            return method.invoke(target, args);
        }
    }

    private Object invokeTransaction(Method method, Object[] args)
            throws Throwable{
        TransactionStatus status =
                this.transactionManager.getTransaction(
                        new DefaultTransactionDefinition());
        try{
            Object ret = method.invoke(target, args);
            this.transactionManager.commit(status);
            return ret;
        }catch (InvocationTargetException e){
            this.transactionManager.rollback(status);
            throw e.getTargetException();
        }
    }
}

public class UserServiceTest {
			...
		@Test
    public void upgradeAllOrNothing() {
        UserServiceImpl.TestUserService testUserService =
                new UserServiceImpl.TestUserService(users.get(3).getId());
        testUserService.setUserDao(this.userDao);
        testUserService.setMailSender(this.mailSender);
        
        TransactionHandler txHandler = new TransactionHandler();
        txHandler.setTarget(testUserService);
        txHandler.setTransactionManager(transactionManager);
        txHandler.setPattern("upgradeLevels");
        UserService txUserService = (UserService) Proxy.newProxyInstance(
                getClass().getClassLoader(),
                new Class[] {UserService.class},
                txHandler
        );

        userDao.deleteAll();
        for (User user : users) userDao.add(user);

        try {
            txUserService.upgradeLevels(); //txHandlerë¥¼ í†µí•œ upgradeLevels()ì‹¤í–‰
            fail("TestUserServiceException expected");
        } catch (UserServiceImpl.TestUserServiceException e) {
        }

        checkLevelUpgraded(users.get(0), false);
    }
}
```

6.3.13 ë‹¤ì´ë‚´ë¯¹ í”„ë¡ì‹œë¥¼ ìœ„í•œ íŒ©í† ë¦¬ ë¹ˆ

- `TransactionHandler`ì™€ **ë‹¤ì´ë‚´ë¯¹ í”„ë¡ì‹œ**ë¥¼ ìŠ¤í”„ë§ DIë¥¼ í†µí•´ ì‚¬ìš©í•  ìˆ˜ ìˆê²Œ í•´ì•¼í•¨
- ìŠ¤í”„ë§ ë¹ˆì€ ì¼ë°˜ì ìœ¼ë¡œ í´ë˜ìŠ¤ ì´ë¦„ê³¼ í”„ë¡œí¼í‹°ë¡œ ì •ì˜ë¨
- ìŠ¤í”„ë§ì€ ì§€ì •ëœ í´ë˜ìŠ¤ ì´ë¦„ì„ ê°€ì§€ê³  ë¦¬í”Œë ‰ì…˜ì„ ì´ìš©í•´ì„œ í•´ë‹¹ í´ë˜ìŠ¤ì˜ ì˜¤ë¸Œì íŠ¸ë¥¼ ë§Œë“¦
- Classì˜ newInstance()ëŠ” í´ë˜ìŠ¤ì˜ íŒŒë¼ë¯¸í„°ê°€ ì—†ëŠ” ìƒì„±ìë¥¼ í˜¸ì¶œí•˜ê³ , ê·¸ ê²°ê³¼ ìƒì„±ë˜ëŠ” ì˜¤ë¸Œì íŠ¸ë¥¼ ëŒë ¤ì£¼ëŠ” ë¦¬í”Œë ‰ì…˜ APIì„
    
    ```java
    Date now = (Date) Class.forName("java.util.Date").newInstance();
    ```
    
- ìŠ¤í”„ë§ì€ ë‚´ë¶€ì ìœ¼ë¡œ ë¦¬í”Œë ‰ì…˜ APIë¥¼ ì´ìš©í•´ì„œ ë¹ˆ ì •ì˜ì— ë‚˜ì˜¤ëŠ” í´ë˜ìŠ¤ ì´ë¦„ì„ ê°€ì§€ê³  ë¹ˆ ì˜¤ë¸Œì íŠ¸ë¥¼ ìƒì„±í•¨
- ë‹¤ì´ë‚´ë¯¹ í”„ë¡ì‹œëŠ” ìœ„ ë°©ë²•ìœ¼ë¡œ í”„ë¡ì‹œ ì˜¤ë¸Œì íŠ¸ê°€ ìƒì„±ë˜ì§€ ì•ŠìŒ
- í´ë˜ìŠ¤ ìì²´ë„ ë‚´ë¶€ì ìœ¼ë¡œ ë‹¤ì´ë‚´ë¯¹í•˜ê²Œ ìƒˆë¡œ ì •ì˜í•´ì„œ ì‚¬ìš©í•´ ë‹¤ì´ë‚´ë¯¹ í”„ë¡ì‹œ ì˜¤ë¸Œì íŠ¸ì˜ í´ë˜ìŠ¤ê°€ ì–´ë–¤ í´ë˜ìŠ¤ì¸ì§€ ì•Œì§€ ëª»í•¨
- ë•Œë¬¸ì—, ì¼ë°˜ì ì¸ ë°©ë²•ìœ¼ë¡œ ë‹¤ì´ë‚´ë¯¹ í”„ë¡ì‹œëŠ” ìŠ¤í”„ë§ ë¹ˆì— ë“±ë¡í•  ë°©ë²•ì´ ì—†ìŒ
- ë‹¤ì´ë‚´ë¯¹ í”„ë¡ì‹œëŠ” Proxy í´ë˜ìŠ¤ì˜ ìŠ¤íƒœí‹± ë©”ì†Œë“œì¸ newProxyInstance()ë§Œ ì‚¬ìš©í•´ ë§Œë“¤ ìˆ˜ ìˆìŒ

6.3.14 íŒ©í† ë¦¬ ë¹ˆ

- ì‚¬ì‹¤ ìŠ¤í”„ë§ì€ í´ë˜ìŠ¤ì˜ ì •ë³´ë¥¼ ê°€ì§€ê³  ë¹ˆì„ ë§Œë“¤ ìˆ˜ ìˆëŠ” ì—¬ëŸ¬ê°€ì§€ ë°©ë²•ì„ ì œê³µí•˜ê³  ìˆìŒ
- ì´ì—ëŒ€í•œ ëŒ€í‘œì ì¸ ì˜ˆì‹œê°€ **íŒ©í† ë¦¬ ë¹ˆ**ì„
- íŒ©í† ë¦¬ ë¹ˆì´ë€, ìŠ¤í”„ë§ì„ ëŒ€ì‹ í•´ì„œ ì˜¤ë¸Œì íŠ¸ì˜ ìƒì„±ë¡œì§ì„ ë‹´ë‹¹í•˜ëŠ” íŠ¹ë³„í•œ **ë¹ˆ**ì„
- íŒ©í† ë¦¬ ë¹ˆì„ ë§Œë“œëŠ” ë°©ë²•ì€ ì—¬ëŸ¬ê°€ì§€ê°€ ìˆì§€ë§Œ, ê°€ì¥ ê°„ë‹¨í•œ ë°©ë²•ì€ `FactoryBean`ì´ë¼ëŠ” ì¸í„°í˜ì´ìŠ¤ë¥¼ êµ¬í˜„í•˜ëŠ” ê²ƒì„
- `FactoryBean`ë¥¼ êµ¬í˜„í•œ í´ë˜ìŠ¤ë¥¼ **ìŠ¤í”„ë§ ë¹ˆìœ¼ë¡œ ë“±ë¡**í•˜ë©´ **íŒ©í† ë¦¬ ë¹ˆ**ìœ¼ë¡œ ë™ì‘í•¨

```java
//ìŠ¤í”„ë§ ë‚´ë¶€ì— ì¡´ì¬í•˜ê¸° ë•Œë¬¸ì— êµ¬í˜„X
package org.springframework.beans.factory;

public Interface FactoryBean<T>{
	T getObject() throws Exception; //ë¹ˆ ì˜¤ë¸Œì íŠ¸ë¥¼ ìƒì„±í•´ì„œ ëŒë ¤ì¤Œ
	Class<? extends T> getObjectType(); //ìƒì„±ë˜ëŠ” ì˜¤ë¸Œì íŠ¸ì˜ íƒ€ì…ì„ ì•Œë ¤ì¤Œ
	boolean isSingleton(); //getObject()ê°€ ì‹±ê¸€í†¤ì¸ì§€ ì•Œë ¤ì¤Œ
}
```

6.3.15 ë‹¤ì´ë‚´ë¯¹ í”„ë¡ì‹œë¥¼ ë§Œë“¤ì–´ì£¼ëŠ” íŒ©í† ë¦¬ ë¹ˆ

- ë‹¤ì´ë‚´ë¯¹ í”„ë¡ì‹œ ë¹ˆì€ Proxyì˜ newProxyInstance()ë¥¼ í†µí•´ì„œë§Œ ìƒì„±ì´ ê°€ëŠ¥
- ë•Œë¬¸ì—, ë‹¤ì´ë‚´ë¯¹ í”„ë¡ì‹œ ì˜¤ë¸Œì íŠ¸ëŠ” ì¼ë°˜ì ìœ¼ë¡œ ìŠ¤í”„ë§ì— ë“±ë¡ ë¶ˆê°€
- ëŒ€ì‹ , íŒ©í† ë¦¬ ë¹ˆì„ ì‚¬ìš©í•˜ë©´ ë‹¤ì´ë‚´ë¯¹ í”„ë¡ì‹œ ì˜¤ë¸Œì œê·¸ë¥¼ ìŠ¤í”„ë§ë¹ˆì— ë“±ë¡ ê°€ëŠ¥
- getObject()ì— í”„ë¡ì‹œ ì˜¤ë¸Œì íŠ¸ë¥¼ ë§Œë“¤ì–´ì£¼ëŠ” ì½”ë“œë¥¼ ë„£ìœ¼ë©´ ë¨
- ìŠ¤í”„ë§ ë¹ˆì— **íŒ©í† ë¦¬ ë¹ˆ**ê³¼ UserServiceImplë§Œ ë“±ë¡
- íŒ©í† ë¦¬ ë¹ˆì— ë‹¤ì´ë‚´ë°‹ í”„ë¡ì‹œê°€ ìœ„ì„í•  íƒ€ê¹ƒì¸ UserServiceImplì˜ ë ˆí¼ëŸ°ìŠ¤ë¥¼ í”„ë¡œí¼í‹°ë¥¼ í†µí•´ DI ë°›ì•„ì•¼ í•¨
- ë‹¤ì´ë‚´ë¯¹ í”„ë¡ì‹œì™€ í•¨ê»˜ ìƒì„±í•  TransactionHandlerì—ê²Œ íƒ€ê¹ƒ ì˜¤ë¸Œì ¯íŠ¸ë¥¼ ì „ë‹¬í•´ì•¼í•˜ê¸° ë•Œë¬¸ì„

![https://leejaedoo.github.io/assets/img/factorybean_dynamic_proxy.jpeg](https://leejaedoo.github.io/assets/img/factorybean_dynamic_proxy.jpeg)

6.3.16 íŠ¸ëœì­ì…˜ í”„ë¡ì‹œ íŒ©í† ë¦¬ ë¹ˆ

- ë²”ìš©ì ìœ¼ë¡œ ì‚¬ìš©í•˜ê¸° ìœ„í•´ FactoryBeanì˜ íƒ€ì…ì„ Objectë¡œ í• ë‹¹
- ë‹¤ì´ë‚´ë¯¹ í”„ë¡ì‹œë¥¼ ìƒì„±í•  ë•Œ êµ¬í˜„í•˜ëŠ” ì¸í„°í˜ì´ìŠ¤ë¥¼ serviceInterface ë³€ìˆ˜ë¡œ ë‘ê³ , Class<?>ë¥¼ í†µí•´ UserService ì™¸ì˜ ì¸í„°í˜ì´ìŠ¤ë¥¼ ê°€ì§„ íƒ€ê¹ƒì—ë„ ì ìš©í•  ìˆ˜ ìˆê²Œ í•¨
- xmlì—ì„œ Class<?> íƒ€ì…ì€ valueë¡œ ë„£ìœ¼ë©´ ë¨
- ê·¸ëŸ¬ë©´ ìŠ¤í”„ë§ì´ Class ì˜¤ë¸Œì íŠ¸ë¡œ ìë™ ë³€í™˜í•˜

```java
public class TxProxyFactoryBean implements FactoryBean<Object> {
    Object target;
    PlatformTransactionManager transactionManager;
    String pattern;
    Class<?> serviceInterface;

    public void setTarget(Object target){
        this.target = target;
    }

    public void setTransactionManager(
            PlatformTransactionManager transactionManager){
        this.transactionManager = transactionManager;
    }

    public void setPattern(String pattern){
        this.pattern = pattern;
    }

    public void setServiceInterface(Class<?> serviceInterface) {
        this.serviceInterface = serviceInterface;
    }

    @Override
    public Object getObject() throws Exception {
        TransactionHandler txHandler = new TransactionHandler();
        txHandler.setTarget(target);
        txHandler.setTransactionManager(transactionManager);
        txHandler.setPattern(pattern);
        return Proxy.newProxyInstance(
                getClass().getClassLoader(),
                new Class[] {serviceInterface},
                txHandler
        );
    }

    @Override
    public Class<?> getObjectType() {
        return serviceInterface;
    }

    @Override
    public boolean isSingleton() {
        return false;
    }
}
```

```xml
<beans
		...>
    <bean id="userService" class="com.ksb.spring.TxProxyFactoryBean">
        <property name="target" ref="userServiceImpl"/>
        <property name="transactionManager" ref="transactionManager"/>
        <property name="pattern" value="upgradeLevels"/>
        <property name="serviceInterface" value="com.ksb.spring.UserService"/>
    </bean>
</beans>
```

6.3.17 íŠ¸ëœì­ì…˜ í”„ë¡ì‹œ íŒ©í† ë¦¬ ë¹ˆ í…ŒìŠ¤íŠ¸

- ì¶”í›„ì— ë‚´ìš© ë³´ê°•

```java
public class UserServiceTest {
   
    @Autowired
    ApplicationContext context;

		@Test
    @DirtiesContext
    public void upgradeAllOrNothing() throws Exception {
        UserServiceImpl.TestUserService testUserService =
                new UserServiceImpl.TestUserService(users.get(3).getId());
        testUserService.setUserDao(this.userDao);
        testUserService.setMailSender(this.mailSender);

        //ë¹ˆ ìì²´ë¥¼ ê°€ì ¸ì˜¬ ë•Œ &ì‚¬ìš©
        TxProxyFactoryBean txProxyFactoryBean =
                context.getBean("&userService", TxProxyFactoryBean.class);
        txProxyFactoryBean.setTarget(testUserService);

        //ë³€ê²½ëœ íƒ€ê¹ƒ ì„¤ì •ì„ ì´ìš©í•´ ë‹¤ì´ë‚´ë¯¹ í”„ë¡ì‹œ ì˜¤ë¸Œì íŠ¸ ë‹¤ì‹œ ìƒì„±
        UserService txUserService = (UserService) txProxyFactoryBean.getObject();

        userDao.deleteAll();
        for (User user : users) userDao.add(user);

        try {
            txUserService.upgradeLevels(); 
            fail("TestUserServiceException expected");
        } catch (UserServiceImpl.TestUserServiceException e) {
        }

        checkLevelUpgraded(users.get(0), false);
    }
}
```

6.3.18 ì„¤ì • ë³€ê²½ì„ í†µí•œ íŠ¸ëœì­ì…˜ ê¸°ëŠ¥ ë¶€ê°€

- TransactionHandlerë¥¼ ì´ìš©í•˜ëŠ” ë‹¤ì´ë‚´ë¯¹ í”„ë¡ì‹œë¥¼ ìƒì„±í•´ì£¼ëŠ” TxProxyFactoryBeanì€ ì½”ë“œì˜ ìˆ˜ì • ì—†ì´ë„ ë‹¤ì–‘í•œ í´ë˜ìŠ¤ì— ì ìš©í•  ìˆ˜ ìˆìŒ
- íƒ€ê¹ƒ ì˜¤ë¸Œì íŠ¸ì— ë§ëŠ” í”„ë¡œí¼í‹° ì •ë³´ë¥¼ ì„¤ì •í•´ì„œ ë¹ˆìœ¼ë¡œ ë“±ë¡í•´ì£¼ê¸°ë§Œ í•˜ë©´ ë¨
- í•˜ë‚˜ ì´ìƒì˜ TxProxyFactoryBeanì„ ë™ì‹œì— ë¹ˆìœ¼ë¡œ ë“±ë¡í•´ë„ ìƒê´€ì—†ìŒ

![https://leejaedoo.github.io/assets/img/%EC%84%A4%EC%A0%95%EB%B3%80%EA%B2%BD%EC%9D%84%ED%86%B5%ED%95%9C_%ED%8A%B8%EB%9E%9C%EC%9E%AD%EC%85%98%EA%B8%B0%EB%8A%A5%EB%B6%80%EA%B0%80.jpeg](https://leejaedoo.github.io/assets/img/%EC%84%A4%EC%A0%95%EB%B3%80%EA%B2%BD%EC%9D%84%ED%86%B5%ED%95%9C_%ED%8A%B8%EB%9E%9C%EC%9E%AD%EC%85%98%EA%B8%B0%EB%8A%A5%EB%B6%80%EA%B0%80.jpeg)

6.3.19 í”„ë¡ì‹œ íŒ©í† ë¦¬ ë¹ˆ ë°©ì‹ì˜ ì¥ì ê³¼ í•œê³„

- ì¥ì 
    - íƒ€ê¹ƒ ì¸í„°í˜ì´ìŠ¤ë¥¼ êµ¬í˜„í•˜ëŠ” í´ë˜ìŠ¤ë¥¼ ì¼ì¼ì´ ë§Œë“¤ì§€ ì•Šì•„ë„ ë¨
    - ë¶€ê°€ê¸°ëŠ¥ ì½”ë“œ ì¤‘ë³µ ì œê±°
- í•œê³„
    - ë¶€ê°€ê¸°ëŠ¥ì€ ë©”ì†Œë“œ ë‹¨ìœ„ë¡œë§Œ ë™ì‘í•˜ê¸° ë•Œë¬¸ì— ì—¬ëŸ¬ í´ë˜ìŠ¤ì— ê³µí†µì ì¸ ë¶€ê°€ê¸°ëŠ¥ì„ ì œê³µí•˜ëŠ” ë°©ë²•ì€ ë¶ˆê°€ëŠ¥í•˜ì—¬ í”„ë¡ì‹œ íŒ©í† ë¦¬ ë¹ˆì˜ ì„¤ì •ì´ ì¤‘ë³µë  ê°€ëŠ¥ì„±ì´ ë†’ìŒ
    - TransactionHandler ì˜¤ë¸Œì íŠ¸ê°€ í”„ë¡ì‹œ íŒ©í† ë¦¬ ë¹ˆ ê°œìˆ˜ë§Œí¼ ë§Œë“¤ì–´ì§